<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Guvenen (2009): Asset Pricing with Heterogeneous IES &mdash; GDSGE Homepage</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Bianchi (2011): Sudden Stops in Open Economies" href="../Bianchi2011/Bianchi2011.html" />
    <link rel="prev" title="Heaton and Lucas (1996): Incomplete Markets with Portfolio Choices" href="../HL1996/HL1996.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> GDSGE
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../lectures.html">Lectures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rbc/rbc.html">Getting Started - A Simple RBC Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../simple_zlb/simple_zlb.html">Comparison with OccBin: A Simple Model with an Occasionally Binding Interest Rate ZLB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rbc/rbcIrr.html">An RBC Model with Irreversible Investment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../HL1996/HL1996.html">Heaton and Lucas (1996): Incomplete Markets with Portfolio Choices</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Guvenen (2009): Asset Pricing with Heterogeneous IES</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#the-model">The Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-gmod-file">The gmod File</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-s-next">What’s Next?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Bianchi2011/Bianchi2011.html">Bianchi (2011): Sudden Stops in Open Economies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../safe_assets/safe_assets.html">Barro et al. (2017): Safe Assets with Rare Disasters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pandemic/GLSW2020.html">Guerrieri et al. (2020): Negative Supply Shocks That Cause Demand Shortages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../multi_country_rbc/multi_country_rbc.html">A Multi-country Business Cycle Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ZLB/zlb.html">A New-Keynesian Model with an Occasionally Binding Interest Rate Zero Lower Bound</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/functions.html">Toolbox API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AdditionalExamples.html">Additional Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ContributedExamples.html">Contributed Examples</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">GDSGE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Guvenen (2009): Asset Pricing with Heterogeneous IES</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="guvenen-2009-asset-pricing-with-heterogeneous-ies">
<h1>Guvenen (2009): Asset Pricing with Heterogeneous IES<a class="headerlink" href="#guvenen-2009-asset-pricing-with-heterogeneous-ies" title="Permalink to this heading"></a></h1>
<p><a class="reference external" href="https://onlinelibrary.wiley.com/doi/abs/10.3982/ECTA6658">Guvenen (2009)</a> constructs a two-agent model to account for several
salient features of asset pricing moments, such as high risk premium,
low and relatively smooth interest rate, and countercyclical movements
in risk premium and Sharpe ratio. The two key ingredients of his model
are limited stock market participation and heterogeneity in the elasticity
of inter-temporal substitution in consumption (EIS).</p>
<p>When all endogenous states are pre-determined, such as capital and bond share in the current example, the expectation of future
variables can be parameterized and integrated before solving the system of equilibrium equations, which greatly speeds up the computation.
We illustrate how to use parameterized expectation with the toolbox in this example.</p>
<section id="the-model">
<h2>The Model<a class="headerlink" href="#the-model" title="Permalink to this heading"></a></h2>
<p>There are two types of infinitely-lived agents: stockholders
(<span class="math notranslate nohighlight">\(h\)</span>) with measure <span class="math notranslate nohighlight">\(\mu\)</span>, and non-stockholders (<span class="math notranslate nohighlight">\(n\)</span>) with
measure <span class="math notranslate nohighlight">\(1-\mu\)</span>. Agents have Epstein-Zin utility functions</p>
<div class="math notranslate nohighlight">
\[U_{i,t}=\left\{ \left(1-\beta\right)c_{i,t}^{1-\rho^{i}}+\beta\left[\mathbb{E}_{t}\left(U_{i,t+1}^{1-\alpha}\right)\right]^{\frac{1-\rho^{i}}{1-\alpha}}\right\} ^{1/\left(1-\rho^{i}\right)}.\label{eq:utility Guv}\]</div>
<p>for <span class="math notranslate nohighlight">\(i=h,n\)</span>. Most importantly, <span class="math notranslate nohighlight">\(\rho^{h}&lt;\rho^{n}\)</span>, i.e., the non-stockholders
have lower EIS which is inversely proportional to <span class="math notranslate nohighlight">\(\rho^{i}\)</span>, and
thus they have higher desire for consumption smoothness over time. Each agent
has one unit of labor endowment.</p>
<p>Stockholders can trade stock <span class="math notranslate nohighlight">\(s_{t}\)</span> and bond <span class="math notranslate nohighlight">\(b_{h,t}\)</span> at prices
<span class="math notranslate nohighlight">\(P_{t}^{s}\)</span> and <span class="math notranslate nohighlight">\(P_{t}^{f}\)</span> respectively. Their budget constraint
is</p>
<div class="math notranslate nohighlight">
\[c_{h,t}+P_{t}^{f}b_{h,t+1}+P_{t}^{s}s_{t+1}\leq b_{h,t}+s_{t}\left(P_{t}^{s}+D_{t}\right)+W_{t},\]</div>
<p>where <span class="math notranslate nohighlight">\(W_t\)</span> is the labor income and borrowing constraint is</p>
<div class="math notranslate nohighlight">
\[b_{h,t+1}\geq-\underline{B},\]</div>
<p>and in calibration <span class="math notranslate nohighlight">\(\underline{B}\)</span> is set to six times of the average
monthly wage rate. The non-stockholders have the same constraints.
In addition, they are restricted from trading stocks.</p>
<p>A representative firm produces the consumption good using capital
<span class="math notranslate nohighlight">\(K_{t}\)</span> and labor <span class="math notranslate nohighlight">\(L_{t}\)</span> based on a Cobb-Douglas production function:</p>
<div class="math notranslate nohighlight">
\[Y_{t}=Z_{t}K_{t}^{\theta}L_{t}^{1-\theta},\]</div>
<p>and the technology evolves according to an AR(1) process:</p>
<div class="math notranslate nohighlight">
\[\ln Z_{t+1}=\phi\ln Z_{t}+\varepsilon_{t+1},\text{ }\varepsilon\overset{i.i.d.}{\sim}N\left(0,\sigma_{\varepsilon}^{2}\right).\]</div>
<p>The firm maximizes its value <span class="math notranslate nohighlight">\(P_{t}^{s}\)</span> expressed as the sum of
its future dividends <span class="math notranslate nohighlight">\(\left\{ D_{t+j}\right\} _{j=1}^{\infty}\)</span> discounted
by the shareholders’ marginal rate of substitution process:</p>
<div class="math notranslate nohighlight">
\[P_{t}^{s}=\max_{\left\{ I_{t+j},L_{t+j}\right\} }\mathbb{E}_{t}\left[\sum_{j=1}^{\infty}\beta^{j}\frac{\Lambda_{h,t+j}}{\Lambda_{h,t}}D_{t+j}\right].\]</div>
<p>The firm accumulates capital subject to a concave adjustment cost
function in investment:</p>
<div class="math notranslate nohighlight">
\[K_{t+1}=\left(1-\delta\right)K_{t}+\varPhi\left(\frac{I_{t}}{K_{t}}\right)K_{t}.\]</div>
<p>Each period, the firm sells one-period bonds at price <span class="math notranslate nohighlight">\(P_{t}^{f}\)</span>.
The bond supply is constant and equals to <span class="math notranslate nohighlight">\(\chi\)</span> fraction of its
average capital stock <span class="math notranslate nohighlight">\(\bar{K}\)</span>. Thus dividend <span class="math notranslate nohighlight">\(D_{t}\)</span> can be written
as</p>
<div class="math notranslate nohighlight">
\[D_{t}=Z_{t}K_{t}^{\theta}L_{t}^{1-\theta}-W_{t}L_{t}-I_{t}-\left(1-P_{t}^{f}\right)\chi\bar{K}.\]</div>
<p>A sequential competitive equilibrium is given by sequences of allocations
<span class="math notranslate nohighlight">\(\{c_{i,t},b_{i,t+1},s_{t+1},I_{t},K_{t+1},L_{t}\}\)</span>
<span class="math notranslate nohighlight">\(i=h,n\)</span> and prices <span class="math notranslate nohighlight">\(\left\{ P_{t}^{s},P_{t}^{f},W_{t}\right\}\)</span>
such that (i) given the price sequences, <span class="math notranslate nohighlight">\(\left\{ c_{i,t},b_{i,t+1},s_{t+1}\right\}\)</span>
<span class="math notranslate nohighlight">\(i=h,n\)</span> solve the stockholders’ and non-stockholders’ optimization
problems; (ii) Given the wage sequence <span class="math notranslate nohighlight">\(\left\{ W_{t}\right\}\)</span> and
the law of motion for capital, <span class="math notranslate nohighlight">\(\left\{L_{t},I_{t}\right\}\)</span>
are optimal for the representative firm; (iii) all markets clear:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\mu b_{h,t+1}+\left(1-\mu\right)b_{n,t+1} &amp; =\chi\bar{K},\label{eq:MC bond Guv}\\
\mu s_{t+1} &amp; =1,\label{eq:MC stock Guv}\\
L_{t} &amp; =1,\nonumber \\
\mu c_{h,t}+\left(1-\mu\right)c_{n,t}+I_{t} &amp; =Y_{t}.\nonumber\end{split}\]</div>
<p>We compute a recursive equilibrium using <span class="math notranslate nohighlight">\(\left\{ K_{t},B_{t}^{n},Z_{t}\right\}\)</span>
as the aggregate state variables, where <span class="math notranslate nohighlight">\(B_{t}^{n}=\left(1-\mu\right)b_{n,t}\)</span>
is total bond holding by the non-stockholders. We have <span class="math notranslate nohighlight">\(8\)</span> unknowns:
{<span class="math notranslate nohighlight">\(c_{h,t}\)</span>, <span class="math notranslate nohighlight">\(c_{n,t}\)</span>, <span class="math notranslate nohighlight">\(I_{t}\)</span>, <span class="math notranslate nohighlight">\(B_{t+1}^{n}\)</span>, <span class="math notranslate nohighlight">\(\lambda_{h,t}\)</span>, <span class="math notranslate nohighlight">\(\lambda_{n,t}\)</span>, <span class="math notranslate nohighlight">\(P_{t}^{s}\)</span>, <span class="math notranslate nohighlight">\(P_{t}^{f}\)</span>},
and the <span class="math notranslate nohighlight">\(8\)</span> equations used to solve them are:</p>
<ul class="simple">
<li><p>Euler equations for bond holding:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[P_{t}^{f}=\beta\left(1+\lambda_{i,t}\right)\mathbb{E}_{t}\left(\frac{\Lambda_{i,t+1}}{\Lambda_{i,t}}\right),\text{ }\forall i=h,n.\]</div>
<ul class="simple">
<li><p>Euler equations for the stockholders’ demand of equity:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[P_{t}^{s} =\beta\mathbb{E}_{t}\left[\frac{\Lambda_{h,t+1}}{\Lambda_{h,t}}\left(P_{t+1}^{s}+D_{t+1}\right)\right].\]</div>
<ul class="simple">
<li><p>Slackness condition of borrowing limit:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\lambda_{i,t}\left(b_{i,t+1}+\underline{B}\right)=0,\text{ }\forall i=h,n.\]</div>
<ul class="simple">
<li><p>The budget constraints (imposing <span class="math notranslate nohighlight">\(s_{t+1}=1/\mu\)</span>):</p></li>
</ul>
<div class="math notranslate nohighlight">
\[c_{h,t}+P_{t}^{f}b_{h,t+1}+\frac{P_{t}^{s}}{\mu}=P_{t}^{s}+D_{t}+\frac{\chi\bar{K}-B_{t}^{n}}{\mu}+W_{t},\]</div>
<div class="math notranslate nohighlight">
\[c_{n,t}+P_{t}^{f}b_{n,t+1}=\frac{B_{t}^{n}}{1-\mu}+W_{t}.\]</div>
<ul class="simple">
<li><p>Firm’s optimal capital accumulation <span class="math notranslate nohighlight">\(K_{t+1}\)</span>:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[q_{t} =\beta\mathbb{E}_{t}\left\{ \frac{\Lambda_{h,t+1}}{\Lambda_{h,t}}\left[\theta Z_{t}K_{t}^{\theta-1}-\frac{I_{t+1}}{K_{t+1}}+q_{t+1}\left(1-\delta+\varPhi\left(\frac{I_{t+1}}{K_{t+1}}\right)\right)\right]\right\} ,\label{eq:capital price Guv}\]</div>
<p>in which capital price <span class="math notranslate nohighlight">\(q_{t}\)</span> is the Lagrangian multiplier on the
capital formation equation and satisfies</p>
<div class="math notranslate nohighlight">
\[q_{t}\varPhi^{\prime}\left(\frac{I_{t}}{K_{t}}\right)=1.\label{eq:optimal inv Guv}\]</div>
<p>The auxiliary variables can be determined by the utility function, market clearing conditions, and the following two equations:</p>
<div class="math notranslate nohighlight">
\[W_{t}= \left(1-\theta\right)Z_{t}\left(\frac{K_{t}}{L_{t}}\right)^{\theta},\]</div>
<div class="math notranslate nohighlight">
\[\beta\frac{\Lambda_{i,t+1}}{\Lambda_{i,t}} =\beta^{\frac{1-\alpha}{1-\rho^{i}}}\left(\frac{c_{i,t+1}}{c_{i,t}}\right)^{-\rho^{i}}\left[\frac{\frac{U_{i,t+1}}{c_{i,t}}}{\left[\left(\frac{U_{i,t}}{c_{i,t}}\right)^{1-\rho^{i}}-(1-\beta)\right]^{1/\left(1-\rho^{i}\right)}}\right]^{\rho^{i}-\alpha}.\]</div>
<p>In period <span class="math notranslate nohighlight">\(t\)</span>, the 6 future variables in use: <span class="math notranslate nohighlight">\(c_{h,t+1}\)</span>, <span class="math notranslate nohighlight">\(c_{n,t+1}\)</span>, <span class="math notranslate nohighlight">\(P_{t+1}^{s}+D_{t+1}\)</span>,
<span class="math notranslate nohighlight">\(I_{t+1}/K_{t+1}\)</span>, <span class="math notranslate nohighlight">\(U_{h,t+1}\)</span> and <span class="math notranslate nohighlight">\(U_{n,t+1}\)</span> are functions of
<span class="math notranslate nohighlight">\(\left\{ K_{t+1},B_{t+1}^{n},Z_{t+1}\right\}\)</span> and are solved from
the previous iteration. Similar to <a class="reference external" href="https://onlinelibrary.wiley.com/doi/abs/10.3982/ECTA6658">Guvenen (2009)</a>, the initial
guesses for these functions are obtained by solving a version of the model with no leverage.</p>
</section>
<section id="the-gmod-file">
<h2>The gmod File<a class="headerlink" href="#the-gmod-file" title="Permalink to this heading"></a></h2>
<p>The model can be solved with the following <a class="reference download internal" download="" href="../../_downloads/2baddcec33ff6678429f1b0bd4d3caa4/guvenen2009.gmod"><code class="xref download docutils literal notranslate"><span class="pre">guvenen2009.gmod</span></code></a> file</p>
<div class="highlight-GDSGE notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="c">% Parameters</span>
<span class="linenos">  2</span><span class="k">parameters</span> beta alpha rhoh rhon theta delta mu xsi chi a1 a2 Kss Bbar bn_shr_lb bn_shr_ub varianceScale;
<span class="linenos">  3</span>
<span class="linenos">  4</span>beta = 0.9966;      <span class="c">% discount factor</span>
<span class="linenos">  5</span>alpha = 6;          <span class="c">% risk aversion</span>
<span class="linenos">  6</span>rhoh = 1/.3;        <span class="c">% inv IES for stockholders</span>
<span class="linenos">  7</span>rhon = 1/.1;        <span class="c">% inv IES for non-stockholders</span>
<span class="linenos">  8</span>theta = .3;         <span class="c">% capital share</span>
<span class="linenos">  9</span>delta = .0066;      <span class="c">% depreciation rate</span>
<span class="linenos"> 10</span>mu = .2;            <span class="c">% participation rate</span>
<span class="linenos"> 11</span>xsi = .4;           <span class="c">% adjustment cost coefficient</span>
<span class="linenos"> 12</span>chi = .005;         <span class="c">% leverage ratio</span>
<span class="linenos"> 13</span>a1 = (((delta^(1/xsi))*xsi)/(xsi-1));
<span class="linenos"> 14</span>a2 = (delta/(1-xsi));
<span class="linenos"> 15</span>Kss = ((1/beta-1+delta)/theta)^(1/(theta-1));
<span class="linenos"> 16</span>Bbar = -0.1*(1-theta)*Kss^theta; %borrowing <span class="k">const</span>raint
<span class="linenos"> 17</span>varianceScale = 1e4;
<span class="linenos"> 18</span>
<span class="linenos"> 19</span>TolEq = 1e-4;
<span class="linenos"> 20</span>INTERP_ORDER = 4; EXTRAP_ORDER = 4;
<span class="linenos"> 21</span>PrintFreq = 100;
<span class="linenos"> 22</span>SaveFreq = inf;
<span class="linenos"> 23</span>
<span class="linenos"> 24</span><span class="c">% Shocks</span>
<span class="linenos"> 25</span><span class="k">var_shock</span> Z;
<span class="linenos"> 26</span><span class="k">shock_num</span> = 15;
<span class="linenos"> 27</span>phi_z = 0.984;  <span class="c">% productivity AR(1)</span>
<span class="linenos"> 28</span>mu_z = 0;
<span class="linenos"> 29</span>sigma_e = 0.015/(1+phi_z^2+phi_z^4).^0.5;
<span class="linenos"> 30</span>[z,shock_trans,~]=tauchen(<span class="k">shock_num</span>,mu_z,phi_z,sigma_e,2);
<span class="linenos"> 31</span>Z = exp(z);
<span class="linenos"> 32</span>
<span class="linenos"> 33</span><span class="c">% States</span>
<span class="linenos"> 34</span><span class="k">var_state</span> K bn_shr;
<span class="linenos"> 35</span>K_pts = 10;
<span class="linenos"> 36</span>K = exp(linspace(log(.84*Kss),log(1.2*Kss),K_pts));
<span class="linenos"> 37</span>
<span class="linenos"> 38</span>bn_shr_lb = (1-mu)*Bbar/(chi*Kss);
<span class="linenos"> 39</span>bn_shr_ub = (chi*Kss - mu*Bbar)/(chi*Kss);
<span class="linenos"> 40</span>b_pts = 30;
<span class="linenos"> 41</span>bn_shr = linspace(bn_shr_lb,bn_shr_ub,b_pts);
<span class="linenos"> 42</span>
<span class="linenos"> 43</span><span class="c">% Last period</span>
<span class="linenos"> 44</span><span class="k">var_policy</span>_init c_h c_n;
<span class="linenos"> 45</span>
<span class="linenos"> 46</span><span class="k">inbound</span>_init c_h 1e-6 100;
<span class="linenos"> 47</span><span class="k">inbound</span>_init c_n 1e-6 100;
<span class="linenos"> 48</span>
<span class="linenos"> 49</span><span class="k">var_aux</span>_init Y W vh vn vhpow vnpow Ps Pf Div Eulerstock Eulerbondh Eulerbondn Inv dIdK Eulerf;
<span class="linenos"> 50</span>
<span class="linenos"> 51</span><span class="k">model_init;</span>  
<span class="linenos"> 52</span>  Y = Z*(K^theta);
<span class="linenos"> 53</span>  W = (1-theta)*Z*(K^theta);
<span class="linenos"> 54</span>  resid1 = 1 - (W + (bn_shr*chi*Kss/(1-mu)))/c_n; <span class="c">% c_n: individual consumption</span>
<span class="linenos"> 55</span>  resid2 = 1 - (W + (Div/mu) + ((1-bn_shr)*chi*Kss/mu))/c_h; <span class="c">% c_h: individual consumption  </span>
<span class="linenos"> 56</span>  vh = ((1-beta)*(c_h^(1-rhoh)))^(1/(1-rhoh));
<span class="linenos"> 57</span>  vn = ((1-beta)*(c_n^(1-rhon)))^(1/(1-rhon));
<span class="linenos"> 58</span>  vhpow = vh^(1-alpha);
<span class="linenos"> 59</span>  vnpow = vn^(1-alpha);
<span class="linenos"> 60</span>  Pf = 0;
<span class="linenos"> 61</span>  Ps = 0;
<span class="linenos"> 62</span>  Div = Y - W - (1-Pf)*chi*Kss;  <span class="c">% investment is zero          </span>
<span class="linenos"> 63</span>
<span class="linenos"> 64</span>  Eulerstock = (vh^(rhoh-alpha))*(c_h^-rhoh)*(Ps + Div);
<span class="linenos"> 65</span>  Eulerbondh = (vh^(rhoh-alpha))*(c_h^-rhoh);
<span class="linenos"> 66</span>  Eulerbondn = (vn^(rhon-alpha))*(c_n^-rhon);
<span class="linenos"> 67</span>
<span class="linenos"> 68</span>  Inv = 0;     
<span class="linenos"> 69</span>  Knext = 0;                                             
<span class="linenos"> 70</span>  dIdK = (Inv/K) - (1/a1)*(xsi/(xsi-1))*(Inv/(K*((1/a1)*((Knext/K)-(1-delta)-a2))))*(Knext/K);
<span class="linenos"> 71</span>  Eulerf = (vh^(rhoh-alpha))*(c_h^-rhoh)*(theta*Z*(K^(theta-1)) - dIdK);
<span class="linenos"> 72</span>  
<span class="linenos"> 73</span>  <span class="k">equations;</span>
<span class="linenos"> 74</span>     resid1;
<span class="linenos"> 75</span>     resid2;
<span class="linenos"> 76</span>  <span class="k">end;</span>
<span class="linenos"> 77</span><span class="k">end;</span>
<span class="linenos"> 78</span>
<span class="linenos"> 79</span><span class="k">var_interp</span> EEulerstock_interp EEulerbondh_interp EEulerbondn_interp EEulerf_interp Evh_interp Evn_interp EPD_interp EPD_square_interp;
<span class="linenos"> 80</span>initial EEulerstock_interp shock_trans*reshape(Eulerstock,<span class="k">shock_num</span>,[]);
<span class="linenos"> 81</span>initial EEulerbondh_interp shock_trans*reshape(Eulerbondh,<span class="k">shock_num</span>,[]);
<span class="linenos"> 82</span>initial EEulerbondn_interp shock_trans*reshape(Eulerbondn,<span class="k">shock_num</span>,[]);
<span class="linenos"> 83</span>initial EEulerf_interp shock_trans*reshape(Eulerf,<span class="k">shock_num</span>,[]);
<span class="linenos"> 84</span>initial Evh_interp shock_trans*reshape(vhpow,<span class="k">shock_num</span>,[]);
<span class="linenos"> 85</span>initial Evn_interp shock_trans*reshape(vnpow,<span class="k">shock_num</span>,[]);
<span class="linenos"> 86</span>initial EPD_interp shock_trans*reshape(Div,<span class="k">shock_num</span>,[]);
<span class="linenos"> 87</span>initial EPD_square_interp shock_trans*reshape(Div.^2,<span class="k">shock_num</span>,[]) / varianceScale;
<span class="linenos"> 88</span>
<span class="linenos"> 89</span>EEulerstock_interp = <span class="k">shock_trans</span>*Eulerstock;
<span class="linenos"> 90</span>EEulerbondh_interp = <span class="k">shock_trans</span>*Eulerbondh;
<span class="linenos"> 91</span>EEulerbondn_interp = <span class="k">shock_trans</span>*Eulerbondn;
<span class="linenos"> 92</span>EEulerf_interp = <span class="k">shock_trans</span>*Eulerf;
<span class="linenos"> 93</span>Evh_interp = <span class="k">shock_trans</span>*vhpow;
<span class="linenos"> 94</span>Evn_interp = <span class="k">shock_trans</span>*vnpow;
<span class="linenos"> 95</span>EPD_interp = <span class="k">shock_trans</span>*(Ps+Div);
<span class="linenos"> 96</span>EPD_square_interp = <span class="k">shock_trans</span>*(Ps+Div).^2 / varianceScale;
<span class="linenos"> 97</span>
<span class="linenos"> 98</span>% Endogenous variables, bounds, and <span class="k">initial</span> values
<span class="linenos"> 99</span><span class="k">var_policy</span> c_h c_n Ps Pf Inv bn_shr_next lambdah lambdan;
<span class="linenos">100</span>
<span class="linenos">101</span><span class="k">inbound</span> c_h 1e-3 10;
<span class="linenos">102</span><span class="k">inbound</span> c_n 1e-3 10;
<span class="linenos">103</span><span class="k">inbound</span> Ps 1e-3 500;
<span class="linenos">104</span><span class="k">inbound</span> Pf 1e-3 10;
<span class="linenos">105</span><span class="k">inbound</span> Inv 1e-9 10;
<span class="linenos">106</span><span class="k">inbound</span> bn_shr_next bn_shr_lb bn_shr_ub;
<span class="linenos">107</span><span class="k">inbound</span> lambdah 0 2;
<span class="linenos">108</span><span class="k">inbound</span> lambdan 0 2;
<span class="linenos">109</span>
<span class="linenos">110</span><span class="c">% Other equilibrium variables</span>
<span class="linenos">111</span><span class="k">var_aux</span> Y W b_h b_n Div dIdKp Eulerstock Eulerbondh Eulerbondn dIdK Eulerf vhpow vnpow omega PDratio Rs R_ep vh vn Knext std_ExcessR SharpeRatio;
<span class="linenos">112</span>
<span class="linenos">113</span><span class="k">model;</span>
<span class="linenos">114</span>  Y = Z*(K^theta);              <span class="c">% output</span>
<span class="linenos">115</span>  W = (1-theta)*Z*(K^theta);    <span class="c">% Wage = F_l</span>
<span class="linenos">116</span>  Div = Y - W - Inv - (1-Pf)*chi*Kss;            <span class="c">% dividends</span>
<span class="linenos">117</span>
<span class="linenos">118</span>  Knext = (1-delta)*K + (a1*((Inv/K)^((xsi-1)/xsi))+a2)*K;
<span class="linenos">119</span>  dIdKp = (1/a1)*(xsi/(xsi-1))*(Inv/(K*((1/a1)*((Knext/K)-(1-delta)-a2))));
<span class="linenos">120</span>
<span class="linenos">121</span>  b_h = (1-bn_shr)*chi*Kss/mu;
<span class="linenos">122</span>  b_n = bn_shr*chi*Kss/(1-mu);
<span class="linenos">123</span>    
<span class="linenos">124</span>  [EEulerstock_future,EEulerbondh_future,EEulerbondn_future,EEulerf_future,Evh_future,Evn_future,EPD_future,EPD_square_future] = <span class="k">GDSGE_INTERP_VEC</span>(shock,Knext,bn_shr_next);
<span class="linenos">125</span>  EPD_square_future = EPD_square_future*varianceScale;
<span class="linenos">126</span>  
<span class="linenos">127</span>  vh =  ((1-beta)*(c_h^(1-rhoh)) + beta*(Evh_future^((1-rhoh)/(1-alpha))))^(1/(1-rhoh));
<span class="linenos">128</span>  vn =  ((1-beta)*(c_n^(1-rhon)) + beta*(Evn_future^((1-rhon)/(1-alpha))))^(1/(1-rhon));
<span class="linenos">129</span>
<span class="linenos">130</span>  Eulerstock = (vh^(rhoh-alpha))*(c_h^-rhoh)*(Ps + Div);
<span class="linenos">131</span>  Eulerbondh = (vh^(rhoh-alpha))*(c_h^-rhoh);
<span class="linenos">132</span>  Eulerbondn = (vn^(rhon-alpha))*(c_n^-rhon);
<span class="linenos">133</span>  
<span class="linenos">134</span>  dIdK = (Inv/K) - (1/a1)*(xsi/(xsi-1))*(Inv/(K*((1/a1)*((Knext/K)-(1-delta)-a2))))*(Knext/K);
<span class="linenos">135</span>  Eulerf = (vh^(rhoh-alpha))*(c_h^-rhoh)*(theta*Z*(K^(theta-1)) - dIdK);
<span class="linenos">136</span>
<span class="linenos">137</span>  vhpow = vh^(1-alpha);
<span class="linenos">138</span>  vnpow = vn^(1-alpha);
<span class="linenos">139</span>
<span class="linenos">140</span>  omega = (Ps+Div+ mu*b_h)/(Ps+Div+chi*Kss);
<span class="linenos">141</span>  PDratio = Ps/Div;
<span class="linenos">142</span>  Rs = EPD_future/Ps;
<span class="linenos">143</span>  R_ep = Rs - 1/Pf;
<span class="linenos">144</span>  <span class="c">% The following inline implements </span>
<span class="linenos">145</span>  % std_ExcessR = (<span class="k">GDSGE_EXPECT</span>{(PD_future&#39;/Ps - Rs)^2})^0.5;
<span class="linenos">146</span>  std_ExcessR = (EPD_square_future/(Ps^2) + Rs^2 - 2*EPD_future*Rs/Ps)^0.5;
<span class="linenos">147</span>  SharpeRatio = R_ep/std_ExcessR;
<span class="linenos">148</span>
<span class="linenos">149</span>  <span class="c">% Equations:</span>
<span class="linenos">150</span>  err_bdgt_h = 1 - (W + (Div/mu) + b_h - Pf*(chi*Kss*(1-bn_shr_next)/mu))/c_h; <span class="c">% these are individual consumptions</span>
<span class="linenos">151</span>  err_bdgt_n = 1 - (W + b_n - Pf*(bn_shr_next*chi*Kss/(1-mu)))/c_n;
<span class="linenos">152</span>  foc_stock = 1 - (beta*EEulerstock_future*(Evh_future^((alpha-rhoh)/(1-alpha))))/((c_h^(-rhoh))*Ps);
<span class="linenos">153</span>  foc_bondh = 1 - (beta*EEulerbondh_future*(Evh_future^((alpha-rhoh)/(1-alpha))) + lambdah)/((c_h^(-rhoh))*Pf);
<span class="linenos">154</span>  foc_bondn = 1 - (beta*EEulerbondn_future*(Evn_future^((alpha-rhon)/(1-alpha))) + lambdan)/((c_n^-rhon)*Pf);
<span class="linenos">155</span>  foc_f = 1 - (beta*EEulerf_future*(Evh_future^((alpha-rhoh)/(1-alpha))))/((c_h^(-rhoh))*dIdKp);
<span class="linenos">156</span>  
<span class="linenos">157</span>  slack_bn = lambdan*(bn_shr_next - bn_shr_lb);    <span class="c">%mun_lw*bn_shr_next;</span>
<span class="linenos">158</span>  slack_bh = lambdah*(bn_shr_ub - bn_shr_next);    <span class="c">%mun_up*(1-bn_shr_next);</span>
<span class="linenos">159</span>
<span class="linenos">160</span>  <span class="k">equations;</span>
<span class="linenos">161</span>    err_bdgt_h;
<span class="linenos">162</span>    err_bdgt_n;
<span class="linenos">163</span>    foc_stock;
<span class="linenos">164</span>    foc_bondh;
<span class="linenos">165</span>    foc_bondn;
<span class="linenos">166</span>    foc_f;
<span class="linenos">167</span>    slack_bn;
<span class="linenos">168</span>    slack_bh;
<span class="linenos">169</span>  <span class="k">end;</span>
<span class="linenos">170</span>
<span class="linenos">171</span><span class="k">end;</span>
<span class="linenos">172</span>
<span class="linenos">173</span><span class="k">simulate;</span>
<span class="linenos">174</span>  <span class="k">num_periods</span> = 10000;
<span class="linenos">175</span>  <span class="k">num_samples</span> = 100;
<span class="linenos">176</span>  
<span class="linenos">177</span>  <span class="k">initial</span> K Kss;
<span class="linenos">178</span>  <span class="k">initial</span> bn_shr 0.5;  
<span class="linenos">179</span>  <span class="k">initial</span> shock 2;
<span class="linenos">180</span>  
<span class="linenos">181</span>  <span class="k">var_simu</span> Y c_h c_n Inv Ps Div Pf bn_shr_next Knext omega PDratio Rs R_ep SharpeRatio std_ExcessR;
<span class="linenos">182</span>
<span class="linenos">183</span>  K&#39; = Knext;
<span class="linenos">184</span>  bn_shr&#39; = bn_shr_next;
<span class="linenos">185</span><span class="k">end;</span>
</pre></div>
</div>
<p>The implementation uses the exact parameterization and specification (number of grid points, domains of endogenous state variables,
number of discretized exogenous shocks, the cubic spline approximation, etc.) in <a class="reference external" href="https://onlinelibrary.wiley.com/doi/abs/10.3982/ECTA6658">Guvenen (2009)</a>. However, the algorithm differs from his. His is based on the algorithm
in <a class="reference external" href="https://www.journals.uchicago.edu/doi/abs/10.1086/250034">Krusell and Smith (1998)</a>: starting from a conjectured law of motion for state-variables and pricing functions,
he solves the agents’ Bellman equation and the agents’ policy functions using standard value function iterations.
Then he uses these policy functions and temporary market clearing conditions to obtain a new law of motions
and new pricing functions. The current algorithm, like other examples, utilizes the fact that agents’ optimization is concave,
replaces the agent’s optimization with first order and complementarity conditions, and solves the agents’ optimization problem
together with the market clearing conditions.</p>
<p>Since both state variables <span class="math notranslate nohighlight">\(K_t\)</span> and <span class="math notranslate nohighlight">\(B_t^n\)</span> are predetermined,
the expectation of future variables (e.g., the marginal utility entering the bond’s Euler equation,
or the price and dividend entering the equity’s Euler equation) can be calculated before-hand conditional on current
exogenous states. For example, for the bond’s Euler equation</p>
<div class="math notranslate nohighlight">
\[P_{t}^{f}=\beta\left(1+\lambda_{i,t}\right)\mathbb{E}_{t}\left(\frac{\Lambda_{i,t+1}}{\Lambda_{i,t}}\right),\text{ }\forall i=h,n.\]</div>
<p>we can define function</p>
<div class="math notranslate nohighlight">
\[\tilde{\Lambda}(z,K',B') \equiv E[\Lambda(z',K',B')|z]\]</div>
<p>and approximate <span class="math notranslate nohighlight">\(\tilde{\Lambda}(z,K',B')\)</span> instead of <span class="math notranslate nohighlight">\(\Lambda(z',K',B')\)</span>. This is made possible by that
<span class="math notranslate nohighlight">\((K,B)\)</span> are predetermined in that the transition of the two states do not depend on <span class="math notranslate nohighlight">\(z'\)</span> (this is not true when
the endogenous state follows an implicit state transition function that depends on the realization of <span class="math notranslate nohighlight">\(z'\)</span>, such as
wealth share and consumption share). When a projection method or spline is used to approximate
<span class="math notranslate nohighlight">\(\tilde{\Lambda}(z,K,B)\)</span>, the integration becomes quite simple, since projection is
a linear operator and therefore the projection of an expectation equals to the expectation of the projection.</p>
<p>Once <span class="math notranslate nohighlight">\(\tilde{\Lambda}(z,K',B')\)</span> is approximated beforehand, then one only
needs to evaluate <span class="math notranslate nohighlight">\(\tilde{\Lambda}\)</span> once for the current exogenous shock (<span class="math notranslate nohighlight">\(z\)</span>) in each evaluation of the system of equations.
If instead one is to work with <span class="math notranslate nohighlight">\(\Lambda(z',K',B')\)</span>, <span class="math notranslate nohighlight">\(\Lambda\)</span> needs to be evaluated for each <span class="math notranslate nohighlight">\(z'\)</span> and
integrated using the transition matrix. This is why integrating <span class="math notranslate nohighlight">\(\Lambda(z',K',B')\)</span> beforehand is more computation-efficient,
especially when the size of exogenous shocks is large.</p>
<p>In particular, the parameterized expectation is implemented by declaring the expectation of relevant variables in <em>var_interp</em> in</p>
<div class="highlight-GDSGE notranslate"><div class="highlight"><pre><span></span><span class="linenos">79</span><span class="k">var_interp</span> EEulerstock_interp EEulerbondh_interp EEulerbondn_interp EEulerf_interp Evh_interp Evn_interp EPD_interp EPD_square_interp;
</pre></div>
</div>
<p>specifying the updating of <em>var_interp</em> by integrating the corresponding variables using the transition matrix</p>
<div class="highlight-GDSGE notranslate"><div class="highlight"><pre><span></span><span class="linenos">89</span>EEulerstock_interp = <span class="k">shock_trans</span>*Eulerstock;
<span class="linenos">90</span>EEulerbondh_interp = <span class="k">shock_trans</span>*Eulerbondh;
<span class="linenos">91</span>EEulerbondn_interp = <span class="k">shock_trans</span>*Eulerbondn;
<span class="linenos">92</span>EEulerf_interp = <span class="k">shock_trans</span>*Eulerf;
<span class="linenos">93</span>Evh_interp = <span class="k">shock_trans</span>*vhpow;
<span class="linenos">94</span>Evn_interp = <span class="k">shock_trans</span>*vnpow;
<span class="linenos">95</span>EPD_interp = <span class="k">shock_trans</span>*(Ps+Div);
<span class="linenos">96</span>EPD_square_interp = <span class="k">shock_trans</span>*(Ps+Div).^2 / varianceScale;
</pre></div>
</div>
<p>and evaluating the approximation at the current <em>shock</em> only when evaluating the system of equations</p>
<div class="highlight-GDSGE notranslate"><div class="highlight"><pre><span></span><span class="linenos">124</span>  [EEulerstock_future,EEulerbondh_future,EEulerbondn_future,EEulerf_future,Evh_future,Evn_future,EPD_future,EPD_square_future] = <span class="k">GDSGE_INTERP_VEC</span>(shock,Knext,bn_shr_next);
</pre></div>
</div>
<p>where the <em>GDSGE_INTERP_VEC</em> takes the first argument <em>shock</em>, a reserved keyword referring
to the index of the current exogenous shock.</p>
<p>After processed by the <a class="reference external" href="http://www.gdsge.com">online compiler</a>, we can run the returned file to run policy iterations:</p>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">struct</span><span class="p">;</span><span class="w"></span>
<span class="n">options</span><span class="p">.</span><span class="n">MaxIter</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">500</span><span class="p">;</span><span class="w"></span>
<span class="n">IterRslt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">iter_guvenen2009</span><span class="p">(</span><span class="n">options</span><span class="p">);</span><span class="w"></span>

<span class="n">Iter</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="n">Metric</span><span class="p">:</span><span class="mf">0.512539</span><span class="p">,</span><span class="w"> </span><span class="n">maxF</span><span class="p">:</span><span class="mf">8.65033e-09</span><span class="w"></span>
<span class="n">Elapsed</span><span class="w"> </span><span class="s">time</span><span class="w"> </span><span class="s">is</span><span class="w"> </span><span class="s">8.272149</span><span class="w"> </span><span class="s">seconds.</span><span class="w"></span>
<span class="n">Iter</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="n">Metric</span><span class="p">:</span><span class="mf">0.285722</span><span class="p">,</span><span class="w"> </span><span class="n">maxF</span><span class="p">:</span><span class="mf">9.39891e-09</span><span class="w"></span>
<span class="n">Elapsed</span><span class="w"> </span><span class="s">time</span><span class="w"> </span><span class="s">is</span><span class="w"> </span><span class="s">7.549686</span><span class="w"> </span><span class="s">seconds.</span><span class="w"></span>
<span class="n">Iter</span><span class="p">:</span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="n">Metric</span><span class="p">:</span><span class="mf">0.174423</span><span class="p">,</span><span class="w"> </span><span class="n">maxF</span><span class="p">:</span><span class="mf">9.01752e-09</span><span class="w"></span>
<span class="n">Elapsed</span><span class="w"> </span><span class="s">time</span><span class="w"> </span><span class="s">is</span><span class="w"> </span><span class="s">7.250628</span><span class="w"> </span><span class="s">seconds.</span><span class="w"></span>
<span class="n">Iter</span><span class="p">:</span><span class="mi">400</span><span class="p">,</span><span class="w"> </span><span class="n">Metric</span><span class="p">:</span><span class="mf">0.113139</span><span class="p">,</span><span class="w"> </span><span class="n">maxF</span><span class="p">:</span><span class="mf">8.89712e-09</span><span class="w"></span>
<span class="n">Elapsed</span><span class="w"> </span><span class="s">time</span><span class="w"> </span><span class="s">is</span><span class="w"> </span><span class="s">6.938417</span><span class="w"> </span><span class="s">seconds.</span><span class="w"></span>
<span class="n">Iter</span><span class="p">:</span><span class="mi">500</span><span class="p">,</span><span class="w"> </span><span class="n">Metric</span><span class="p">:</span><span class="mf">0.0763611</span><span class="p">,</span><span class="w"> </span><span class="n">maxF</span><span class="p">:</span><span class="mf">8.61954e-09</span><span class="w"></span>
<span class="n">Elapsed</span><span class="w"> </span><span class="s">time</span><span class="w"> </span><span class="s">is</span><span class="w"> </span><span class="s">6.762700</span><span class="w"> </span><span class="s">seconds.</span><span class="w"></span>
</pre></div>
</div>
<p>We first solve a simple version of the problem as a warm-up. This simple problem has a lower aggregate net supply of bond
(<span class="math notranslate nohighlight">\(\chi=0.005\)</span>) and a tighter borrowing constraint (<span class="math notranslate nohighlight">\(\bar{B}\)</span>). This ensures that starting from a last period solution
the equilibrium exists, which is also noted in <a class="reference external" href="https://onlinelibrary.wiley.com/doi/abs/10.3982/ECTA6658">Guvenen (2009)</a>.</p>
<p>Starting with the warm-up solution, we now change the parameters, increase <span class="math notranslate nohighlight">\(\chi\)</span> to <span class="math notranslate nohighlight">\(0.15\)</span>,
its value in the paper, and specify a much more relaxed borrowing constraint (<span class="math notranslate nohighlight">\(\bar{B}\)</span>). This can be done very conveniently with
the toolbox by specifying the new parameters into a structure, and the warm-up solution as a field named <em>WarmUp</em> into the structure.</p>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="nb">beta</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.9967</span><span class="p">;</span><span class="w">      </span><span class="c">% discount factor</span><span class="w"></span>
<span class="n">theta</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">.3</span><span class="p">;</span><span class="w">         </span><span class="c">% capital share</span><span class="w"></span>
<span class="n">delta</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">.0066</span><span class="p">;</span><span class="w">      </span><span class="c">% depreciation rate</span><span class="w"></span>
<span class="n">mu</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">.2</span><span class="p">;</span><span class="w">            </span><span class="c">% participation rate</span><span class="w"></span>
<span class="n">Kss</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="nb">beta</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="n">delta</span><span class="p">)</span><span class="o">/</span><span class="n">theta</span><span class="p">)</span>^<span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">theta</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span><span class="w"></span>
<span class="n">chi</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.15</span><span class="p">;</span><span class="w"></span>
<span class="n">Bbar</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">Kss</span>^<span class="n">theta</span><span class="p">;</span><span class="w"></span>
<span class="n">bn_shr_lb</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">mu</span><span class="p">)</span><span class="o">*</span><span class="n">Bbar</span><span class="o">/</span><span class="p">(</span><span class="n">chi</span><span class="o">*</span><span class="n">Kss</span><span class="p">);</span><span class="w"></span>
<span class="n">bn_shr_ub</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">chi</span><span class="o">*</span><span class="n">Kss</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mu</span><span class="o">*</span><span class="n">Bbar</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">chi</span><span class="o">*</span><span class="n">Kss</span><span class="p">);</span><span class="w"></span>
<span class="n">b_pts</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">30</span><span class="p">;</span><span class="w"></span>

<span class="n">options</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">struct</span><span class="p">;</span><span class="w"></span>
<span class="n">options</span><span class="p">.</span><span class="n">chi</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">chi</span><span class="p">;</span><span class="w"></span>
<span class="n">options</span><span class="p">.</span><span class="n">Bbar</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Bbar</span><span class="p">;</span><span class="w"> </span><span class="c">%borrowing constraint</span><span class="w"></span>
<span class="n">options</span><span class="p">.</span><span class="n">bn_shr_lb</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">bn_shr_lb</span><span class="p">;</span><span class="w"></span>
<span class="n">options</span><span class="p">.</span><span class="n">bn_shr_ub</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">bn_shr_ub</span><span class="p">;</span><span class="w"></span>
<span class="n">options</span><span class="p">.</span><span class="n">bn_shr</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">linspace</span><span class="p">(</span><span class="n">bn_shr_lb</span><span class="p">,</span><span class="n">bn_shr_ub</span><span class="p">,</span><span class="n">b_pts</span><span class="p">);</span><span class="w"></span>

<span class="n">options</span><span class="p">.</span><span class="n">WarmUp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">IterRslt</span><span class="p">;</span><span class="w"></span>
<span class="n">options</span><span class="p">.</span><span class="n">SkipModelInit</span><span class="p">=</span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>We can now call the routine with the option structure as an argument</p>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">IterRslt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">iter_guvenen2009</span><span class="p">(</span><span class="n">options</span><span class="p">);</span><span class="w"></span>

<span class="n">Iter</span><span class="p">:</span><span class="mi">600</span><span class="p">,</span><span class="w"> </span><span class="n">Metric</span><span class="p">:</span><span class="mf">0.0605821</span><span class="p">,</span><span class="w"> </span><span class="n">maxF</span><span class="p">:</span><span class="mf">9.85466e-09</span><span class="w"></span>
<span class="n">Elapsed</span><span class="w"> </span><span class="s">time</span><span class="w"> </span><span class="s">is</span><span class="w"> </span><span class="s">6.361178</span><span class="w"> </span><span class="s">seconds.</span><span class="w"></span>

<span class="k">...</span><span class="w"></span>

<span class="n">Iter</span><span class="p">:</span><span class="mi">2490</span><span class="p">,</span><span class="w"> </span><span class="n">Metric</span><span class="p">:</span><span class="mf">9.99635e-05</span><span class="p">,</span><span class="w"> </span><span class="n">maxF</span><span class="p">:</span><span class="mf">9.29708e-09</span><span class="w"></span>
<span class="n">Elapsed</span><span class="w"> </span><span class="s">time</span><span class="w"> </span><span class="s">is</span><span class="w"> </span><span class="s">5.205234</span><span class="w"> </span><span class="s">seconds.</span><span class="w"></span>
</pre></div>
</div>
<p>The policy iteration continues from where the warm-up solution ends, toward convergence.</p>
<p>We can inspect the policy functions at convergence by calling in MATLAB:</p>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="nb">figure</span><span class="p">;</span><span class="w"> </span><span class="nb">clf</span><span class="p">;</span><span class="w"></span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="nb">surf</span><span class="p">(</span><span class="n">KMesh</span><span class="p">,</span><span class="n">BMesh</span><span class="p">,</span><span class="nb">squeeze</span><span class="p">(</span><span class="n">var_aux</span><span class="p">.</span><span class="n">R_ep</span><span class="p">(</span><span class="n">z1</span><span class="p">,:,:))</span><span class="o">*</span><span class="mi">12</span><span class="p">);</span><span class="w"></span>
<span class="nb">title</span><span class="p">(</span><span class="s">&#39;Equity Premium&#39;</span><span class="p">);</span><span class="w"></span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;$K$&#39;</span><span class="p">,</span><span class="s">&#39;Interpreter&#39;</span><span class="p">,</span><span class="s">&#39;Latex&#39;</span><span class="p">);</span><span class="w"></span>
<span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;$B_n$&#39;</span><span class="p">,</span><span class="s">&#39;Interpreter&#39;</span><span class="p">,</span><span class="s">&#39;Latex&#39;</span><span class="p">);</span><span class="w"></span>
<span class="nb">set</span><span class="p">(</span><span class="nb">gca</span><span class="p">,</span><span class="s">&#39;FontSize&#39;</span><span class="p">,</span><span class="mi">15</span><span class="p">);</span><span class="w"></span>

<span class="nb">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span><span class="w"></span>
<span class="nb">surf</span><span class="p">(</span><span class="n">KMesh</span><span class="p">,</span><span class="n">BMesh</span><span class="p">,</span><span class="nb">squeeze</span><span class="p">((</span><span class="mi">1</span><span class="o">./</span><span class="n">var_policy</span><span class="p">.</span><span class="n">Pf</span><span class="p">(</span><span class="n">z1</span><span class="p">,:,:))</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">12</span><span class="p">);</span><span class="w"></span>
<span class="nb">title</span><span class="p">(</span><span class="s">&#39;Interest Rate&#39;</span><span class="p">);</span><span class="w"></span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;$K$&#39;</span><span class="p">,</span><span class="s">&#39;Interpreter&#39;</span><span class="p">,</span><span class="s">&#39;Latex&#39;</span><span class="p">);</span><span class="w"></span>
<span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;$B_n$&#39;</span><span class="p">,</span><span class="s">&#39;Interpreter&#39;</span><span class="p">,</span><span class="s">&#39;Latex&#39;</span><span class="p">);</span><span class="w"></span>
<span class="nb">set</span><span class="p">(</span><span class="nb">gca</span><span class="p">,</span><span class="s">&#39;FontSize&#39;</span><span class="p">,</span><span class="mi">15</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/policy_guv.png"><img alt="../../_images/policy_guv.png" src="../../_images/policy_guv.png" style="width: 585.2px; height: 250.0px;" /></a>
<p>As shown, given capital, as the bond holding of non-stock holders increases, the demand for bond increases and for stock decreases,
which results in a lower interest rate,  lower stock price and lower equity premium.</p>
<p>We can then simulate the economy</p>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">SimuRslt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">simulate_guvenen2009</span><span class="p">(</span><span class="n">IterRslt</span><span class="p">);</span><span class="w"></span>
<span class="n">Periods</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="w"></span>
<span class="n">shock</span><span class="w">       </span><span class="s">K</span><span class="w">  </span><span class="s">bn_shr</span><span class="w">       </span><span class="s">Y</span><span class="w">     </span><span class="s">c_h</span><span class="w">     </span><span class="s">c_n</span><span class="w">     </span><span class="s">Inv</span><span class="w">      </span><span class="s">Ps</span><span class="w">     </span><span class="s">Div</span><span class="w">      </span><span class="s">Pfbn_shr_next</span><span class="w">   </span><span class="s">Knext</span><span class="w">   </span><span class="s">omega</span><span class="w"> </span><span class="s">PDratio</span><span class="w">      </span><span class="s">Rs</span><span class="w">    </span><span class="s">R_epSharpeRatio</span><span class="w"></span>
<span class="w">    </span><span class="mi">8</span><span class="w">   </span><span class="mf">126.1</span><span class="w">  </span><span class="mf">0.3264</span><span class="w">   </span><span class="mf">4.267</span><span class="w">   </span><span class="mf">5.103</span><span class="w">   </span><span class="mf">3.003</span><span class="w">  </span><span class="mf">0.8448</span><span class="w">   </span><span class="mf">111.7</span><span class="w">  </span><span class="mf">0.3939</span><span class="w">  </span><span class="mf">0.9978</span><span class="w">  </span><span class="mf">0.3265</span><span class="w">   </span><span class="mf">126.1</span><span class="w">  </span><span class="mf">0.9521</span><span class="w">   </span><span class="mf">283.7</span><span class="w">   </span><span class="mf">1.0040</span><span class="p">.</span><span class="mi">002244</span><span class="w"> </span><span class="mf">0.04976</span><span class="w"></span>
<span class="n">Elapsed</span><span class="w"> </span><span class="s">time</span><span class="w"> </span><span class="s">is</span><span class="w"> </span><span class="s">28.379607</span><span class="w"> </span><span class="s">seconds.</span><span class="w"></span>
<span class="n">Periods</span><span class="p">:</span><span class="w"> </span><span class="mi">2000</span><span class="w"></span>
<span class="n">shock</span><span class="w">       </span><span class="s">K</span><span class="w">  </span><span class="s">bn_shr</span><span class="w">       </span><span class="s">Y</span><span class="w">     </span><span class="s">c_h</span><span class="w">     </span><span class="s">c_n</span><span class="w">     </span><span class="s">Inv</span><span class="w">      </span><span class="s">Ps</span><span class="w">     </span><span class="s">Div</span><span class="w">      </span><span class="s">Pfbn_shr_next</span><span class="w">   </span><span class="s">Knext</span><span class="w">   </span><span class="s">omega</span><span class="w"> </span><span class="s">PDratio</span><span class="w">      </span><span class="s">Rs</span><span class="w">    </span><span class="s">R_epSharpeRatio</span><span class="w"></span>
<span class="w">    </span><span class="mi">9</span><span class="w">   </span><span class="mf">127.3</span><span class="w">  </span><span class="mf">0.3652</span><span class="w">   </span><span class="mf">4.341</span><span class="w">   </span><span class="mf">5.197</span><span class="w">    </span><span class="mf">3.04</span><span class="w">   </span><span class="mf">0.869</span><span class="w">   </span><span class="mf">119.3</span><span class="w">  </span><span class="mf">0.4121</span><span class="w">  </span><span class="mf">0.9989</span><span class="w">  </span><span class="mf">0.3655</span><span class="w">   </span><span class="mf">127.3</span><span class="w">  </span><span class="mf">0.9493</span><span class="w">   </span><span class="mf">289.5</span><span class="w">   </span><span class="mf">1.003</span><span class="w"> </span><span class="mf">0.00224</span><span class="w"> </span><span class="mf">0.05007</span><span class="w"></span>
<span class="n">Elapsed</span><span class="w"> </span><span class="s">time</span><span class="w"> </span><span class="s">is</span><span class="w"> </span><span class="s">25.144899</span><span class="w"> </span><span class="s">seconds.</span><span class="w"></span>
<span class="n">Periods</span><span class="p">:</span><span class="w"> </span><span class="mi">3000</span><span class="w"></span>
<span class="n">shock</span><span class="w">       </span><span class="s">K</span><span class="w">  </span><span class="s">bn_shr</span><span class="w">       </span><span class="s">Y</span><span class="w">     </span><span class="s">c_h</span><span class="w">     </span><span class="s">c_n</span><span class="w">     </span><span class="s">Inv</span><span class="w">      </span><span class="s">Ps</span><span class="w">     </span><span class="s">Div</span><span class="w">      </span><span class="s">Pfbn_shr_next</span><span class="w">   </span><span class="s">Knext</span><span class="w">   </span><span class="s">omega</span><span class="w"> </span><span class="s">PDratio</span><span class="w">      </span><span class="s">Rs</span><span class="w">    </span><span class="s">R_epSharpeRatio</span><span class="w"></span>
<span class="w">    </span><span class="mi">11</span><span class="w">   </span><span class="mf">135.2</span><span class="w">  </span><span class="mf">0.5826</span><span class="w">   </span><span class="mf">4.547</span><span class="w">   </span><span class="mf">5.381</span><span class="w">   </span><span class="mf">3.158</span><span class="w">  </span><span class="mf">0.9444</span><span class="w">   </span><span class="mf">136.5</span><span class="w">  </span><span class="mf">0.4421</span><span class="w">   </span><span class="mf">1.001</span><span class="w">  </span><span class="mf">0.5829</span><span class="w">   </span><span class="mf">135.3</span><span class="w">   </span><span class="mf">0.928</span><span class="w">   </span><span class="mf">308.7</span><span class="w">   </span><span class="mf">1.0010</span><span class="p">.</span><span class="mi">002332</span><span class="w"> </span><span class="mf">0.05232</span><span class="w"></span>
<span class="n">Elapsed</span><span class="w"> </span><span class="s">time</span><span class="w"> </span><span class="s">is</span><span class="w"> </span><span class="s">14.973382</span><span class="w"> </span><span class="s">seconds.</span><span class="w"></span>
</pre></div>
</div>
<p>and inspect the distribution of state variables in the ergodic set</p>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="n">startPeriods</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">500</span><span class="p">;</span><span class="w"></span>
<span class="n">Kss</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">IterRslt</span><span class="p">.</span><span class="n">params</span><span class="p">.</span><span class="n">Kss</span><span class="p">;</span><span class="w"></span>
<span class="n">K</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">SimuRslt</span><span class="p">.</span><span class="n">K</span><span class="p">(:,</span><span class="n">startPeriods</span><span class="p">:</span><span class="k">end</span><span class="p">);</span><span class="w"></span>
<span class="n">omega</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">SimuRslt</span><span class="p">.</span><span class="n">omega</span><span class="p">(:,</span><span class="n">startPeriods</span><span class="p">:</span><span class="k">end</span><span class="p">);</span><span class="w"></span>

<span class="nb">figure</span><span class="p">;</span><span class="w"> </span><span class="nb">clf</span><span class="p">;</span><span class="w"></span>
<span class="nb">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="nb">histogram</span><span class="p">(</span><span class="n">K</span><span class="o">/</span><span class="n">Kss</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="s">&#39;Normalization&#39;</span><span class="p">,</span><span class="s">&#39;probability&#39;</span><span class="p">);</span><span class="c">%,&#39;BinLimits&#39;,[0.5,0.75]);</span><span class="w"></span>
<span class="nb">title</span><span class="p">(</span><span class="s">&#39;Distribution of $K$&#39;</span><span class="p">,</span><span class="s">&#39;Interpreter&#39;</span><span class="p">,</span><span class="s">&#39;Latex&#39;</span><span class="p">);</span><span class="w"></span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;$K/K^{ss}$&#39;</span><span class="p">,</span><span class="s">&#39;Interpreter&#39;</span><span class="p">,</span><span class="s">&#39;Latex&#39;</span><span class="p">);</span><span class="w"></span>
<span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;Fractions&#39;</span><span class="p">);</span><span class="w"></span>
<span class="nb">set</span><span class="p">(</span><span class="nb">gca</span><span class="p">,</span><span class="s">&#39;FontSize&#39;</span><span class="p">,</span><span class="mi">15</span><span class="p">);</span><span class="w"></span>

<span class="nb">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span><span class="w"></span>
<span class="nb">histogram</span><span class="p">(</span><span class="n">omega</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="s">&#39;Normalization&#39;</span><span class="p">,</span><span class="s">&#39;probability&#39;</span><span class="p">);</span><span class="c">%,&#39;BinLimits&#39;,[0.5,0.75]);</span><span class="w"></span>
<span class="nb">title</span><span class="p">(</span><span class="s">&#39;Wealth Share Distribution&#39;</span><span class="p">,</span><span class="s">&#39;Interpreter&#39;</span><span class="p">,</span><span class="s">&#39;Latex&#39;</span><span class="p">);</span><span class="w"></span>
<span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;Wealth of Stockholders&#39;</span><span class="p">,</span><span class="s">&#39;Interpreter&#39;</span><span class="p">,</span><span class="s">&#39;Latex&#39;</span><span class="p">);</span><span class="w"></span>
<span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;Fractions&#39;</span><span class="p">);</span><span class="w"></span>
<span class="nb">set</span><span class="p">(</span><span class="nb">gca</span><span class="p">,</span><span class="s">&#39;FontSize&#39;</span><span class="p">,</span><span class="mi">15</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/dist_guv.png"><img alt="../../_images/dist_guv.png" src="../../_images/dist_guv.png" style="width: 618.0px; height: 378.8px;" /></a>
</section>
<section id="what-s-next">
<h2>What’s Next?<a class="headerlink" href="#what-s-next" title="Permalink to this heading"></a></h2>
<p>This example illustrates how to work with parameterized expectation with the toolbox, which greatly reduces computation cost
for models that can be solved with predetermined endogenous state variables.
The finite-agent asset pricing model is an important class in the Macro and Macro-finance literature.
Since the framework of the toolbox solves allocations and prices jointly respecting the optimality and market clearing conditions,
it is able to deal with setups which are
traditionally regarded as ill-conditioned, such as models with very high risk aversion levels (see example
<a class="reference internal" href="../safe_assets/safe_assets.html#barro2017"><span class="std std-ref">Barro et al. (2017)</span></a>) or models with equilibrium asset returns that are close to collinear such as <a class="reference external" href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3552189">Cao, Evans, and Luo (2020)</a>.</p>
<p>Or you can directly proceed to <a class="reference internal" href="../../usage/functions.html#toolbox-api"><span class="std std-ref">Toolbox API</span></a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../HL1996/HL1996.html" class="btn btn-neutral float-left" title="Heaton and Lucas (1996): Incomplete Markets with Portfolio Choices" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../Bianchi2011/Bianchi2011.html" class="btn btn-neutral float-right" title="Bianchi (2011): Sudden Stops in Open Economies" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Dan Cao, Wenlan Luo, and Guangyu Nie.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>