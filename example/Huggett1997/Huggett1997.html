<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Huggett (1997): Steady States and Transition Paths in Heterogeneous Agent Models &mdash; GDSGE Homepage</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Krusell and Smith (1998): Heterogeneous Agent Models with Aggregate Uncertainty" href="../KS1998/KS1998.html" />
    <link rel="prev" title="Additional Examples" href="../AdditionalExamples.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> GDSGE
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../lectures.html">Lectures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rbc/rbc.html">Getting Started - A Simple RBC Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../simple_zlb/simple_zlb.html">Comparison with OccBin: A Simple Model with an Occasionally Binding Interest Rate ZLB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rbc/rbcIrr.html">An RBC Model with Irreversible Investment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../HL1996/HL1996.html">Heaton and Lucas (1996): Incomplete Markets with Portfolio Choices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Guvenen2009/Guvenen2009.html">Guvenen (2009): Asset Pricing with Heterogeneous IES</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Bianchi2011/Bianchi2011.html">Bianchi (2011): Sudden Stops in Open Economies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../safe_assets/safe_assets.html">Barro et al. (2017): Safe Assets with Rare Disasters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pandemic/GLSW2020.html">Guerrieri et al. (2022): Negative Supply Shocks That Cause Demand Shortages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../multi_country_rbc/multi_country_rbc.html">A Multi-country Business Cycle Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ZLB/zlb.html">A New-Keynesian Model with an Occasionally Binding Interest Rate Zero Lower Bound</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/functions.html">Toolbox API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../AdditionalExamples.html">Additional Examples</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Huggett (1997): Steady States and Transition Paths in Heterogeneous Agent Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-model">The Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-gmod-file-and-matlab-file">The gmod File and MATLAB File</a></li>
<li class="toctree-l3"><a class="reference internal" href="#output">Output</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../KS1998/KS1998.html">Krusell and Smith (1998): Heterogeneous Agent Models with Aggregate Uncertainty</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Mendoza2010/Mendoza2010.html">Mendoza (2010): Sudden Stops with Asset Price Deflation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../KM1997/CaoNie2017.html">Cao and Nie (2017): Amplification and Asymmetry without Collateral Constraint</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Cao2018/Cao2018.html">Cao (2018): Speculation and Wealth Distribution under Beliefs Heterogeneity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Cao2020/Cao2020.html">Cao (2020): Continuum versus Finite Agents in Krusell and Smith (1998)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ContributedExamples.html">Contributed Examples</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">GDSGE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../AdditionalExamples.html">Additional Examples</a> &raquo;</li>
      <li>Huggett (1997): Steady States and Transition Paths in Heterogeneous Agent Models</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="huggett-1997-steady-states-and-transition-paths-in-heterogeneous-agent-models">
<h1>Huggett (1997): Steady States and Transition Paths in Heterogeneous Agent Models<a class="headerlink" href="#huggett-1997-steady-states-and-transition-paths-in-heterogeneous-agent-models" title="Permalink to this heading"></a></h1>
<section id="the-model">
<h2>The Model<a class="headerlink" href="#the-model" title="Permalink to this heading"></a></h2>
<p>We use the seminal work <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S0304393297000251">Huggett (1997)</a> to illustrate
how the toolbox can be used to solve steady states and transition paths of a heterogeneous-agent model.
The example also demonstrates how to conduct non-stochastic simulations using the toolbox,
by keeping track of the distribution function over a refined grid of individual state variables.</p>
<p>Though the toolbox is not designed for solving the equilibrium of this type of model directly,
since the decision problem is characterized by an equation system (the Euler equation</p>
<div class="math notranslate nohighlight">
\[u'(c_t) = \beta \mathbb{E}_t[(1+r_{t+1})u'(c_{t+1})] + \lambda_t,\]</div>
<p>where <span class="math notranslate nohighlight">\(\lambda_t\)</span> is the Lagrange multiplier on the borrowing constraint, and the complementary-slackness condition, <span class="math notranslate nohighlight">\(\lambda_t k_{t+1}=0\)</span>) with state transition functions, it readily fits in the toolbox’s general framework.
One just needs an extra fixed-point loop to update the aggregate equilibrium object, which can be coded in MATLAB.
For the one-sector model studied by <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S0304393297000251">Huggett (1997)</a>, the steady state aggregate equilibrium object is the aggregate capital stock; the transition path aggregate equilibrium object is the time sequence
of the aggregate capital stock.</p>
<p>We directly define the equilibrium, which covers all the ingredients we need for computing the model. For the full description of the model,
see <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S0304393297000251">Huggett (1997)</a> .</p>
<p>A sequential equilibrium is a time sequence of (1) policy functions <span class="math notranslate nohighlight">\(c_{t}(k,e)\)</span>, <span class="math notranslate nohighlight">\(\lambda_t(k,e)\)</span>, <span class="math notranslate nohighlight">\(k'_t(k,e)\)</span>; (2) measures over individual states <span class="math notranslate nohighlight">\(\phi_t\)</span>;
(3) aggregate prices and quantities <span class="math notranslate nohighlight">\(w_t, r_t, K_t\)</span>, s.t.</p>
<ol class="arabic simple">
<li><p><span class="math notranslate nohighlight">\(c_t(k,e), \lambda_t(k,e), k_t'(k,e)\)</span> satisfy individuals’ optimality conditions. That is, they solve</p></li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}c_t(k,e)^{-\sigma}=\beta(1+r_{t+1})E[c_{t+1}(k_t'(k,e),e')^{-\sigma} | e] + \lambda_t(k,e),
\\
k_t'(k,e)\lambda_t(k,e)=0, \quad \lambda_t(k,e)\geq0, \quad k_t'(k,e)\geq0,
\\
c_t(k,e)+k_t'(k,e)=k(1+r_t)+w_te.\end{split}\]</div>
<ol class="arabic simple" start="2">
<li><p>Prices are competitively determined and markets clearing:</p></li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}r_t = \alpha K_t^{\alpha-1}-\delta
\\
w_t = (1-\alpha) K_t^{\alpha}
\\
K_t = \int k \  \phi_t(dk,de)\end{split}\]</div>
<ol class="arabic simple" start="3">
<li><p><span class="math notranslate nohighlight">\(\phi_t\)</span> are consistent with the transitions implied by policy functions and exogenous shocks.</p></li>
</ol>
<p>A steady-state equilibrium is a sequential equilibrium with time-invariant equilibrium objects.</p>
<p>Notice we have transformed the individual’s optimization problem into first order conditions and complementarity slackness conditions,
which enable us to solve the decision problem with the toolbox.</p>
</section>
<section id="the-gmod-file-and-matlab-file">
<h2>The gmod File and MATLAB File<a class="headerlink" href="#the-gmod-file-and-matlab-file" title="Permalink to this heading"></a></h2>
<p><a class="reference download internal" download="" href="../../_downloads/c7178ae59f2f7f1709910c83b9c6a185/huggett1997.gmod"><code class="xref download docutils literal notranslate"><span class="pre">huggett1997.gmod</span></code></a></p>
<div class="highlight-GDSGE notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c">% Toolbox options</span>
<span class="linenos"> 2</span>INTERP_ORDER = 4; ExtrapOrder = 4;
<span class="linenos"> 3</span>SIMU_RESOLVE = 0; SIMU_INTERP = 1;
<span class="linenos"> 4</span>SaveFreq = inf; PrintFreq = 100;
<span class="linenos"> 5</span>TolEq = 1e-6;
<span class="linenos"> 6</span><span class="c">% Parameters</span>
<span class="linenos"> 7</span><span class="k">parameters</span> beta sigma kMin r w;
<span class="linenos"> 8</span>beta = 0.96;    <span class="c">% discount factor</span>
<span class="linenos"> 9</span>sigma = 1.5;    <span class="c">% CRRA coefficient</span>
<span class="linenos">10</span>alpha = 0.36;   <span class="c">% capital share in production</span>
<span class="linenos">11</span>delta = 0.1;    <span class="c">% depreciation rate</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="c">% States</span>
<span class="linenos">14</span><span class="k">var_state</span> k;
<span class="linenos">15</span>kPts = 100;
<span class="linenos">16</span>kMin = 0;
<span class="linenos">17</span>kMax = 20;
<span class="linenos">18</span>kShift = 1e-3;
<span class="linenos">19</span>k = exp(linspace(log(kMin+1e-3),log(kMax+1e-3),kPts)) - 1e-3;
<span class="linenos">20</span>
<span class="linenos">21</span><span class="c">% Shock process in Huggett (1997)</span>
<span class="linenos">22</span><span class="k">var_shock</span> e;
<span class="linenos">23</span>e = [0.8, 1.2];
<span class="linenos">24</span><span class="k">shock_num</span> = 2;
<span class="linenos">25</span><span class="k">shock_trans</span> = [0.5,0.5;0.5,0.5];
<span class="linenos">26</span>
<span class="linenos">27</span><span class="c">% Representative-agent steady state</span>
<span class="linenos">28</span>kSs = ( (1/beta+delta-1) / alpha )^(1/(alpha-1));
<span class="linenos">29</span><span class="c">% Initial prices</span>
<span class="linenos">30</span>r = alpha*kSs^(alpha-1) - delta;
<span class="linenos">31</span>w = (1-alpha)*kSs^alpha;
<span class="linenos">32</span>
<span class="linenos">33</span><span class="c">% State transition functions</span>
<span class="linenos">34</span><span class="k">var_interp</span> Evp_interp;
<span class="linenos">35</span><span class="k">initial</span> Evp_interp (k.*(1+r)+e.*w).^(-sigma);
<span class="linenos">36</span><span class="c">% Update</span>
<span class="linenos">37</span>Evp_interp = <span class="k">shock_trans</span>*vp;
<span class="linenos">38</span>
<span class="linenos">39</span><span class="c">% Endogenous variables</span>
<span class="linenos">40</span><span class="k">var_policy</span> k_next lambda;
<span class="linenos">41</span><span class="k">inbound</span> k_next kMin k.*(1+r)+e.*w;
<span class="linenos">42</span><span class="k">inbound</span> lambda 0 1.0;
<span class="linenos">43</span>
<span class="linenos">44</span><span class="c">% Other variables</span>
<span class="linenos">45</span><span class="k">var_aux</span> c vp;
<span class="linenos">46</span><span class="c">% Used in simulation</span>
<span class="linenos">47</span><span class="k">var_output</span> c k_next;
<span class="linenos">48</span>var_others kSs alpha delta output_interp_t;
<span class="linenos">49</span>
<span class="linenos">50</span>TASK = &#39;ss&#39;;    <span class="c">% Default task, need overwritten</span>
<span class="linenos">51</span>output_interp_t = {};      <span class="c">% Default transition path;</span>
<span class="linenos">52</span>pre_iter;
<span class="linenos">53</span>  <span class="c">% The pre_iter block will be called at the beginning of every policy iteration</span>
<span class="linenos">54</span>  switch TASK
<span class="linenos">55</span>    case &#39;ss&#39;
<span class="linenos">56</span>    case &#39;transition&#39;
<span class="linenos">57</span>      t = T - GDSGE_Iter + 1;  <span class="c">% Convert forward to backward</span>
<span class="linenos">58</span>      r = r_t(t);
<span class="linenos">59</span>      w = w_t(t);
<span class="linenos">60</span>  end
<span class="linenos">61</span><span class="k">end;</span>
<span class="linenos">62</span>
<span class="linenos">63</span><span class="k">model;</span>
<span class="linenos">64</span>  budget = k*(1+r) + e*w;
<span class="linenos">65</span>  c = budget - k_next;
<span class="linenos">66</span>  up = c^(-sigma);
<span class="linenos">67</span>  [Evp_future] = <span class="k">GDSGE_INTERP_VEC</span>(shock,k_next);
<span class="linenos">68</span>  euler_residual = -1 + beta*Evp_future/up + lambda;
<span class="linenos">69</span>  vp = up*(1+r);    <span class="c">% Envelope theorem</span>
<span class="linenos">70</span>  
<span class="linenos">71</span>  <span class="k">equations;</span>
<span class="linenos">72</span>    euler_residual;
<span class="linenos">73</span>    lambda*(k_next-kMin);
<span class="linenos">74</span>  <span class="k">end;</span>
<span class="linenos">75</span><span class="k">end;</span>
<span class="linenos">76</span>
<span class="linenos">77</span>post_iter;
<span class="linenos">78</span>  <span class="c">% The post_iter block will be called at the end of every policy iteration</span>
<span class="linenos">79</span>  switch TASK
<span class="linenos">80</span>    case &#39;transition&#39;
<span class="linenos">81</span>      <span class="c">% The following code constructs function approximation for  var_output</span>
<span class="linenos">82</span>      <span class="c">% and stores in IterRslt.output_interp</span>
<span class="linenos">83</span>      OUTPUT_CONSTRUCT_CODE;
<span class="linenos">84</span>      <span class="c">% Store the period-t equilbrium object</span>
<span class="linenos">85</span>      output_interp_t{t} = IterRslt.output_interp;
<span class="linenos">86</span>  end
<span class="linenos">87</span><span class="k">end;</span>
<span class="linenos">88</span>
<span class="linenos">89</span><span class="k">simulate;</span>
<span class="linenos">90</span>  <span class="k">num_periods</span> = 1;
<span class="linenos">91</span>  <span class="k">num_samples</span> = 10000;
<span class="linenos">92</span>  initial k kSs;    <span class="c">% A place holder</span>
<span class="linenos">93</span>  initial shock 1;  <span class="c">% A place holder</span>
<span class="linenos">94</span>  <span class="k">var_simu</span> c;
<span class="linenos">95</span>  k&#39; = k_next;
<span class="linenos">96</span><span class="k">end;</span>
</pre></div>
</div>
<p>The MATLAB file that calls the toolbox codes and manually update equilibrium objects <a class="reference download internal" download="" href="../../_downloads/9ca12385f064010e7a678766057c5df7/main.m"><code class="xref download docutils literal notranslate"><span class="pre">main.m</span></code></a></p>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="c">%% Solve a WarmUp problem</span><span class="w"></span>
<span class="linenos">  2</span><span class="n">IterRslt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">iter_huggett1997</span><span class="p">;</span><span class="w"></span>
<span class="linenos">  3</span>
<span class="linenos">  4</span><span class="c">%% A fixed-point loop to solve the initial steady state</span><span class="w"></span>
<span class="linenos">  5</span><span class="n">tolEq</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">1e-5</span><span class="p">;</span><span class="w"> </span><span class="n">metric</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">inf</span><span class="p">;</span><span class="w"> </span><span class="n">iter</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="linenos">  6</span><span class="n">UPDATE_SPEED</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.01</span><span class="p">;</span><span class="w"></span>
<span class="linenos">  7</span><span class="n">K</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">IterRslt</span><span class="p">.</span><span class="n">var_others</span><span class="p">.</span><span class="n">kSs</span><span class="p">;</span><span class="w"></span>
<span class="linenos">  8</span><span class="nb">alpha</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">IterRslt</span><span class="p">.</span><span class="n">var_others</span><span class="p">.</span><span class="n">alpha</span><span class="p">;</span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">IterRslt</span><span class="p">.</span><span class="n">var_others</span><span class="p">.</span><span class="n">delta</span><span class="p">;</span><span class="w"></span>
<span class="linenos">  9</span><span class="c">% Non-stochastic simulation, prepare distribution grid</span><span class="w"></span>
<span class="linenos"> 10</span><span class="n">kFinePts</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="w"> </span><span class="n">shockPts</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">IterRslt</span><span class="p">.</span><span class="n">shock_num</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 11</span><span class="n">kFine</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">IterRslt</span><span class="p">.</span><span class="n">var_state</span><span class="p">.</span><span class="n">k</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">IterRslt</span><span class="p">.</span><span class="n">var_state</span><span class="p">.</span><span class="n">k</span><span class="p">),</span><span class="n">kFinePts</span><span class="p">)</span><span class="o">&#39;</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 12</span><span class="n">kFineRight</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">kFine</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">);</span><span class="n">inf</span><span class="p">];</span><span class="w"></span>
<span class="linenos"> 13</span><span class="p">[</span><span class="n">kFineGrid</span><span class="p">,</span><span class="n">shockGrid</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">ndgrid</span><span class="p">(</span><span class="n">kFine</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">shockPts</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 14</span><span class="c">% Parameters to simulate only one step</span><span class="w"></span>
<span class="linenos"> 15</span><span class="n">simuOptions</span><span class="p">.</span><span class="n">num_periods</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 16</span><span class="n">simuOptions</span><span class="p">.</span><span class="n">num_samples</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">numel</span><span class="p">(</span><span class="n">kFineGrid</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 17</span><span class="n">simuOptions</span><span class="p">.</span><span class="n">init</span><span class="p">.</span><span class="n">k</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">kFineGrid</span><span class="p">(:);</span><span class="w"></span>
<span class="linenos"> 18</span><span class="n">simuOptions</span><span class="p">.</span><span class="n">init</span><span class="p">.</span><span class="n">shock</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">shockGrid</span><span class="p">(:);</span><span class="w"></span>
<span class="linenos"> 19</span><span class="k">while</span><span class="w"> </span><span class="n">metric</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">tolEq</span><span class="w"></span>
<span class="linenos"> 20</span><span class="w">    </span><span class="c">% Solve at prices implied by current K</span><span class="w"></span>
<span class="linenos"> 21</span><span class="w">    </span><span class="n">options</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">struct</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 22</span><span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="n">TASK</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;ss&#39;</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 23</span><span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="n">r</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">alpha</span><span class="o">*</span><span class="n">K</span>^<span class="p">(</span><span class="nb">alpha</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">delta</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 24</span><span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="n">w</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nb">alpha</span><span class="p">)</span><span class="o">*</span><span class="n">K</span>^<span class="nb">alpha</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 25</span><span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="n">WarmUp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">IterRslt</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 26</span><span class="w">    </span><span class="n">IterRslt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">iter_huggett1997</span><span class="p">(</span><span class="n">options</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 27</span><span class="w"> </span>
<span class="linenos"> 28</span><span class="w">    </span><span class="c">% Non-stochastic simulation. Simulate one-step to get the state transition</span><span class="w"></span>
<span class="linenos"> 29</span><span class="w">    </span><span class="c">% functions over kFine</span><span class="w"></span>
<span class="linenos"> 30</span><span class="w">    </span><span class="n">SimuRslt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">simulate_huggett1997</span><span class="p">(</span><span class="n">IterRslt</span><span class="p">,</span><span class="n">simuOptions</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 31</span><span class="w">    </span><span class="c">% Construct the Markov transition implied by policy functions</span><span class="w"></span>
<span class="linenos"> 32</span><span class="w">    </span><span class="n">kp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">SimuRslt</span><span class="p">.</span><span class="n">k</span><span class="p">(:,</span><span class="mi">2</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 33</span><span class="w">    </span><span class="p">[</span><span class="o">~</span><span class="p">,</span><span class="n">kpCell</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">histc</span><span class="p">(</span><span class="n">kp</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">kFine</span><span class="p">;</span><span class="n">inf</span><span class="p">]);</span><span class="w"></span>
<span class="linenos"> 34</span><span class="w">    </span><span class="n">leftWeights</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">kFineRight</span><span class="p">(</span><span class="n">kpCell</span><span class="p">)</span><span class="o">-</span><span class="n">kp</span><span class="p">)</span><span class="w"> </span><span class="o">./</span><span class="w"> </span><span class="p">(</span><span class="n">kFineRight</span><span class="p">(</span><span class="n">kpCell</span><span class="p">)</span><span class="o">-</span><span class="n">kFine</span><span class="p">(</span><span class="n">kpCell</span><span class="p">));</span><span class="w"></span>
<span class="linenos"> 35</span><span class="w">    </span><span class="n">leftWeights</span><span class="p">(</span><span class="n">kpCell</span><span class="o">&gt;=</span><span class="n">kFinePts</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 36</span><span class="w">    </span><span class="n">rowVec</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">shockPts</span><span class="o">*</span><span class="n">kFinePts</span><span class="p">]</span><span class="o">&#39;</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 37</span><span class="w">    </span><span class="n">transToKp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">sparse</span><span class="p">(</span><span class="n">rowVec</span><span class="p">,</span><span class="n">kpCell</span><span class="p">,</span><span class="n">leftWeights</span><span class="p">,</span><span class="n">shockPts</span><span class="o">*</span><span class="n">kFinePts</span><span class="p">,</span><span class="n">kFinePts</span><span class="p">)</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="linenos"> 38</span><span class="w">        </span><span class="o">+</span><span class="w"> </span><span class="nb">sparse</span><span class="p">(</span><span class="n">rowVec</span><span class="p">(</span><span class="n">kpCell</span><span class="o">&lt;</span><span class="n">kFinePts</span><span class="p">),</span><span class="n">kpCell</span><span class="p">(</span><span class="n">kpCell</span><span class="o">&lt;</span><span class="n">kFinePts</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">leftWeights</span><span class="p">(</span><span class="n">kpCell</span><span class="o">&lt;</span><span class="n">kFinePts</span><span class="p">),</span><span class="k">...</span><span class="w"></span>
<span class="linenos"> 39</span><span class="w">        </span><span class="n">shockPts</span><span class="o">*</span><span class="n">kFinePts</span><span class="p">,</span><span class="n">kFinePts</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 40</span><span class="w">    </span><span class="c">% Accomodate the exogenous transition</span><span class="w"></span>
<span class="linenos"> 41</span><span class="w">    </span><span class="n">transFull</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">repmat</span><span class="p">(</span><span class="n">transToKp</span><span class="p">,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 42</span><span class="w">    </span><span class="c">% Simulate</span><span class="w"></span>
<span class="linenos"> 43</span><span class="w">    </span><span class="p">[</span><span class="n">stationaryDist</span><span class="p">,</span><span class="o">~</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">eigs</span><span class="p">(</span><span class="n">transFull</span><span class="o">&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 44</span><span class="w">    </span><span class="n">stationaryDist</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">reshape</span><span class="p">(</span><span class="n">stationaryDist</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">sum</span><span class="p">(</span><span class="n">stationaryDist</span><span class="p">(:)),[</span><span class="n">kFinePts</span><span class="p">,</span><span class="n">shockPts</span><span class="p">]);</span><span class="w"></span>
<span class="linenos"> 45</span><span class="w">    </span><span class="c">% Statistics</span><span class="w"></span>
<span class="linenos"> 46</span><span class="w">    </span><span class="n">K_new</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">sum</span><span class="p">(</span><span class="nb">reshape</span><span class="p">(</span><span class="n">stationaryDist</span><span class="o">.*</span><span class="nb">reshape</span><span class="p">(</span><span class="n">kFine</span><span class="p">,[</span><span class="n">kFinePts</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span><span class="w"> </span><span class="p">[],</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span><span class="w"></span>
<span class="linenos"> 47</span>
<span class="linenos"> 48</span><span class="w">    </span><span class="c">% Update</span><span class="w"></span>
<span class="linenos"> 49</span><span class="w">    </span><span class="n">metric</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="nb">log</span><span class="p">(</span><span class="n">K</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">log</span><span class="p">(</span><span class="n">K_new</span><span class="p">));</span><span class="w"></span>
<span class="linenos"> 50</span><span class="w">    </span><span class="n">iter</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">iter</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 51</span><span class="w">    </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;Steady-state iterations: %d, %g\n&#39;</span><span class="p">,</span><span class="n">iter</span><span class="p">,</span><span class="w"> </span><span class="n">metric</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 52</span><span class="w">    </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;===============================\n&#39;</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 53</span><span class="w">    </span><span class="n">K</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">K_new</span><span class="o">*</span><span class="n">UPDATE_SPEED</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">K</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">UPDATE_SPEED</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 54</span><span class="k">end</span><span class="w"></span>
<span class="linenos"> 55</span>
<span class="linenos"> 56</span><span class="c">%% Solve the transition path</span><span class="w"></span>
<span class="linenos"> 57</span><span class="n">T</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 58</span><span class="n">K_t</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">K</span><span class="o">*</span><span class="nb">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 59</span><span class="n">K_t_new</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">K</span><span class="o">*</span><span class="nb">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 60</span><span class="n">tolEq</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">1e-3</span><span class="p">;</span><span class="w"> </span><span class="n">metric</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">inf</span><span class="p">;</span><span class="w"> </span><span class="n">iter</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 61</span><span class="n">UPDATE_SPEED</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.01</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 62</span><span class="c">% Initial distribution in Huggett (1997)</span><span class="w"></span>
<span class="linenos"> 63</span><span class="n">dist0</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">stationaryDist</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 64</span><span class="n">dist0</span><span class="p">(</span><span class="mi">1</span><span class="p">,:)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.2</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 65</span><span class="n">kBar</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">K</span><span class="o">/</span><span class="mf">0.8</span><span class="o">*</span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 66</span><span class="n">kBarIndex</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">kFine</span><span class="o">&gt;</span><span class="n">kBar</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 67</span><span class="n">dist0</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="n">kBarIndex</span><span class="p">,:)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.8</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">numel</span><span class="p">(</span><span class="n">dist0</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="n">kBarIndex</span><span class="p">,:));</span><span class="w"></span>
<span class="linenos"> 68</span><span class="n">dist0</span><span class="p">(</span><span class="n">kBarIndex</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="k">end</span><span class="p">,:)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 69</span><span class="k">while</span><span class="w"> </span><span class="n">metric</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">tolEq</span><span class="w"></span>
<span class="linenos"> 70</span><span class="w">    </span><span class="c">% Backward loop</span><span class="w"></span>
<span class="linenos"> 71</span><span class="w">    </span><span class="n">options</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">struct</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 72</span><span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="n">TASK</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;transition&#39;</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 73</span><span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="n">PrintFreq</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">inf</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 74</span><span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="n">MaxIter</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">T</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 75</span><span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="n">T</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">T</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 76</span><span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="n">TolEq</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">  </span><span class="c">% Do not check TolEq</span><span class="w"></span>
<span class="linenos"> 77</span><span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="n">r_t</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">alpha</span><span class="o">*</span><span class="n">K_t</span><span class="o">.^</span><span class="p">(</span><span class="nb">alpha</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">delta</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 78</span><span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="n">w_t</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nb">alpha</span><span class="p">)</span><span class="o">*</span><span class="n">K_t</span><span class="o">.^</span><span class="nb">alpha</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 79</span><span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="n">WarmUp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">IterRslt</span><span class="p">;</span><span class="w">  </span><span class="c">% Start from steady state</span><span class="w"></span>
<span class="linenos"> 80</span><span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="n">WarmUp</span><span class="p">.</span><span class="n">Iter</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">    </span><span class="c">% Start with iter 0;</span><span class="w"></span>
<span class="linenos"> 81</span><span class="w">    </span><span class="n">IterRslt_t</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">iter_huggett1997</span><span class="p">(</span><span class="n">options</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 82</span>
<span class="linenos"> 83</span><span class="w">    </span><span class="c">% Forward simulation</span><span class="w"></span>
<span class="linenos"> 84</span><span class="w">    </span><span class="n">dist</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dist0</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 85</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">t</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="n">T</span><span class="w"></span>
<span class="linenos"> 86</span><span class="w">        </span><span class="n">K_t_new</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">sum</span><span class="p">(</span><span class="nb">reshape</span><span class="p">(</span><span class="n">dist</span><span class="o">.*</span><span class="nb">reshape</span><span class="p">(</span><span class="n">kFine</span><span class="p">,[</span><span class="n">kFinePts</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span><span class="w"> </span><span class="p">[],</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span><span class="w"></span>
<span class="linenos"> 87</span><span class="w">        </span><span class="c">% Simulate using period-t policies</span><span class="w"></span>
<span class="linenos"> 88</span><span class="w">        </span><span class="n">IterRslt</span><span class="p">.</span><span class="n">output_interp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">IterRslt_t</span><span class="p">.</span><span class="n">var_others</span><span class="p">.</span><span class="n">output_interp_t</span><span class="p">{</span><span class="n">t</span><span class="p">};</span><span class="w"></span>
<span class="linenos"> 89</span><span class="w">        </span><span class="n">SimuRslt_t</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">simulate_huggett1997</span><span class="p">(</span><span class="n">IterRslt</span><span class="p">,</span><span class="n">simuOptions</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 90</span><span class="w">        </span><span class="c">% Construct the Markov transition implied by policy functions</span><span class="w"></span>
<span class="linenos"> 91</span><span class="w">        </span><span class="n">kp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">SimuRslt_t</span><span class="p">.</span><span class="n">k</span><span class="p">(:,</span><span class="mi">2</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 92</span><span class="w">        </span><span class="p">[</span><span class="o">~</span><span class="p">,</span><span class="n">kpCell</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">histc</span><span class="p">(</span><span class="n">kp</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">kFine</span><span class="p">;</span><span class="n">inf</span><span class="p">]);</span><span class="w"></span>
<span class="linenos"> 93</span><span class="w">        </span><span class="n">leftWeights</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">kFineRight</span><span class="p">(</span><span class="n">kpCell</span><span class="p">)</span><span class="o">-</span><span class="n">kp</span><span class="p">)</span><span class="w"> </span><span class="o">./</span><span class="w"> </span><span class="p">(</span><span class="n">kFineRight</span><span class="p">(</span><span class="n">kpCell</span><span class="p">)</span><span class="o">-</span><span class="n">kFine</span><span class="p">(</span><span class="n">kpCell</span><span class="p">));</span><span class="w"></span>
<span class="linenos"> 94</span><span class="w">        </span><span class="n">leftWeights</span><span class="p">(</span><span class="n">kpCell</span><span class="o">&gt;=</span><span class="n">kFinePts</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 95</span><span class="w">        </span><span class="n">rowVec</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">shockPts</span><span class="o">*</span><span class="n">kFinePts</span><span class="p">]</span><span class="o">&#39;</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 96</span><span class="w">        </span><span class="n">transToKp</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">sparse</span><span class="p">(</span><span class="n">rowVec</span><span class="p">,</span><span class="n">kpCell</span><span class="p">,</span><span class="n">leftWeights</span><span class="p">,</span><span class="n">shockPts</span><span class="o">*</span><span class="n">kFinePts</span><span class="p">,</span><span class="n">kFinePts</span><span class="p">)</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="linenos"> 97</span><span class="w">            </span><span class="o">+</span><span class="w"> </span><span class="nb">sparse</span><span class="p">(</span><span class="n">rowVec</span><span class="p">(</span><span class="n">kpCell</span><span class="o">&lt;</span><span class="n">kFinePts</span><span class="p">),</span><span class="n">kpCell</span><span class="p">(</span><span class="n">kpCell</span><span class="o">&lt;</span><span class="n">kFinePts</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">leftWeights</span><span class="p">(</span><span class="n">kpCell</span><span class="o">&lt;</span><span class="n">kFinePts</span><span class="p">),</span><span class="k">...</span><span class="w"></span>
<span class="linenos"> 98</span><span class="w">            </span><span class="n">shockPts</span><span class="o">*</span><span class="n">kFinePts</span><span class="p">,</span><span class="n">kFinePts</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 99</span><span class="w">        </span><span class="c">% Accomodate the exogenous transition</span><span class="w"></span>
<span class="linenos">100</span><span class="w">        </span><span class="n">transFull</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">transToKp</span><span class="p">,</span><span class="n">transToKp</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5</span><span class="p">;</span><span class="w"></span>
<span class="linenos">101</span><span class="w">        </span><span class="n">dist</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">reshape</span><span class="p">(</span><span class="n">dist</span><span class="p">(:)</span><span class="o">&#39;*</span><span class="n">transFull</span><span class="p">,[</span><span class="n">kFinePts</span><span class="p">,</span><span class="n">shockPts</span><span class="p">]);</span><span class="w"></span>
<span class="linenos">102</span><span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="linenos">103</span><span class="w">    </span>
<span class="linenos">104</span><span class="w">    </span><span class="c">% Update K_t</span><span class="w"></span>
<span class="linenos">105</span><span class="w">    </span><span class="n">metric</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="nb">log</span><span class="p">(</span><span class="n">K_t</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">log</span><span class="p">(</span><span class="n">K_t_new</span><span class="p">)));</span><span class="w"></span>
<span class="linenos">106</span><span class="w">    </span><span class="n">iter</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">iter</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="linenos">107</span><span class="w">    </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;Transition path iterations: %d, %g\n&#39;</span><span class="p">,</span><span class="n">iter</span><span class="p">,</span><span class="w"> </span><span class="n">metric</span><span class="p">);</span><span class="w"></span>
<span class="linenos">108</span><span class="w">    </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;==================================\n&#39;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">109</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">metric</span><span class="o">&lt;</span><span class="mf">2e-2</span><span class="w"></span>
<span class="linenos">110</span><span class="w">        </span><span class="n">UPDATE_SPEED</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.03</span><span class="p">;</span><span class="w"></span>
<span class="linenos">111</span><span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="linenos">112</span><span class="w">    </span><span class="n">K_t</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">K_t_new</span><span class="o">*</span><span class="n">UPDATE_SPEED</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">K_t</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">UPDATE_SPEED</span><span class="p">);</span><span class="w"></span>
<span class="linenos">113</span><span class="k">end</span><span class="w"></span>
<span class="linenos">114</span>
<span class="linenos">115</span><span class="c">%% Plot</span><span class="w"></span>
<span class="linenos">116</span><span class="nb">figure</span><span class="p">;</span><span class="w"> </span><span class="n">hold</span><span class="w"> </span><span class="s">on</span><span class="p">;</span><span class="w"></span>
<span class="linenos">117</span><span class="nb">plot</span><span class="p">(</span><span class="n">K_t</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">500</span><span class="p">),</span><span class="s">&#39;LineWidth&#39;</span><span class="p">,</span><span class="mf">1.5</span><span class="p">);</span><span class="w"></span>
<span class="linenos">118</span><span class="nb">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">500</span><span class="p">],[</span><span class="n">K</span><span class="p">,</span><span class="n">K</span><span class="p">],</span><span class="s">&#39;--&#39;</span><span class="p">,</span><span class="s">&#39;LineWidth&#39;</span><span class="p">,</span><span class="mf">1.5</span><span class="p">);</span><span class="w"></span>
<span class="linenos">119</span><span class="nb">title</span><span class="p">(</span><span class="s">&#39;Transition Path&#39;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">120</span><span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;TIME&#39;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">121</span><span class="nb">legend</span><span class="p">({</span><span class="s">&#39;Equilibrium Path&#39;</span><span class="p">,</span><span class="s">&#39;Steady State Path&#39;</span><span class="p">});</span><span class="w"></span>
<span class="linenos">122</span><span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;Aggregate Capital Stock&#39;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">123</span><span class="nb">print</span><span class="p">(</span><span class="s">&#39;transition_path.png&#39;</span><span class="p">,</span><span class="s">&#39;-dpng&#39;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">124</span>
<span class="linenos">125</span><span class="nb">figure</span><span class="p">;</span><span class="w"> </span><span class="n">hold</span><span class="w"> </span><span class="s">on</span><span class="p">;</span><span class="w"></span>
<span class="linenos">126</span><span class="nb">plot</span><span class="p">(</span><span class="n">kFine</span><span class="p">,</span><span class="n">stationaryDist</span><span class="p">,</span><span class="s">&#39;LineWidth&#39;</span><span class="p">,</span><span class="mf">1.5</span><span class="p">);</span><span class="w"></span>
<span class="linenos">127</span><span class="nb">title</span><span class="p">(</span><span class="s">&#39;Stationary Distribution&#39;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">128</span><span class="nb">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">]);</span><span class="w"></span>
<span class="linenos">129</span><span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;Capital&#39;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">130</span><span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;Fractions&#39;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">131</span><span class="nb">print</span><span class="p">(</span><span class="s">&#39;stationary_dist.png&#39;</span><span class="p">,</span><span class="s">&#39;-dpng&#39;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">132</span>
<span class="linenos">133</span><span class="nb">figure</span><span class="p">;</span><span class="w"> </span><span class="n">hold</span><span class="w"> </span><span class="s">on</span><span class="p">;</span><span class="w"></span>
<span class="linenos">134</span><span class="nb">plot</span><span class="p">(</span><span class="n">IterRslt</span><span class="p">.</span><span class="n">var_state</span><span class="p">.</span><span class="n">k</span><span class="p">,</span><span class="n">IterRslt</span><span class="p">.</span><span class="n">var_policy</span><span class="p">.</span><span class="n">k_next</span><span class="p">,</span><span class="s">&#39;LineWidth&#39;</span><span class="p">,</span><span class="mf">1.0</span><span class="p">);</span><span class="w"></span>
<span class="linenos">135</span><span class="nb">plot</span><span class="p">(</span><span class="n">IterRslt</span><span class="p">.</span><span class="n">var_state</span><span class="p">.</span><span class="n">k</span><span class="p">,</span><span class="n">IterRslt</span><span class="p">.</span><span class="n">var_state</span><span class="p">.</span><span class="n">k</span><span class="p">,</span><span class="s">&#39;k-&#39;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">136</span><span class="nb">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">]);</span><span class="w"></span>
<span class="linenos">137</span><span class="nb">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">]);</span><span class="w"></span>
<span class="linenos">138</span><span class="nb">legend</span><span class="p">(</span><span class="s">&#39;a&#39;&#39;(k,0.8)&#39;</span><span class="p">,</span><span class="s">&#39;a&#39;&#39;(k,1.2)&#39;</span><span class="p">,</span><span class="s">&#39;45 Degreee Line&#39;</span><span class="p">,</span><span class="s">&#39;Location&#39;</span><span class="p">,</span><span class="s">&#39;SouthEast&#39;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">139</span><span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;Capital&#39;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">140</span><span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;Capital Next Period&#39;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">141</span><span class="nb">title</span><span class="p">(</span><span class="s">&#39;Decision Rules for Saving&#39;</span><span class="p">);</span><span class="w"></span>
<span class="linenos">142</span><span class="nb">print</span><span class="p">(</span><span class="s">&#39;policy_function_kp.png&#39;</span><span class="p">,</span><span class="s">&#39;-dpng&#39;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="output">
<h2>Output<a class="headerlink" href="#output" title="Permalink to this heading"></a></h2>
<p>The code produces the stationary distribution</p>
<a class="reference internal image-reference" href="../../_images/stationary_dist.png"><img alt="../../_images/stationary_dist.png" src="../../_images/stationary_dist.png" style="width: 437.5px; height: 328.0px;" /></a>
<p>the transition path starting from an equal wealth distribution (see the MATLAB file for how the initial distribution is constructed)</p>
<a class="reference internal image-reference" href="../../_images/transition_path.png"><img alt="../../_images/transition_path.png" src="../../_images/transition_path.png" style="width: 437.5px; height: 328.0px;" /></a>
<p>and the policy functions at the steady state.</p>
<a class="reference internal image-reference" href="../../_images/policy_function_kp.png"><img alt="../../_images/policy_function_kp.png" src="../../_images/policy_function_kp.png" style="width: 437.5px; height: 328.0px;" /></a>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../AdditionalExamples.html" class="btn btn-neutral float-left" title="Additional Examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../KS1998/KS1998.html" class="btn btn-neutral float-right" title="Krusell and Smith (1998): Heterogeneous Agent Models with Aggregate Uncertainty" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Dan Cao, Wenlan Luo, and Guangyu Nie.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>