

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Heaton and Lucas (1996): Incomplete Markets with Portfolio Choices &mdash; GDSGE Homepage</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Guvenen (2009): Asset Pricing with Heterogeneous IES" href="../Guvenen2009/Guvenen2009.html" />
    <link rel="prev" title="A RBC Model with Irreversible Investment" href="../rbc/rbcIrr.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> GDSGE
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rbc/rbc.html">Getting Started - A Simple RBC Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rbc/rbcIrr.html">A RBC Model with Irreversible Investment</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Heaton and Lucas (1996): Incomplete Markets with Portfolio Choices</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#the-model">The Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#wealth-share-as-endogenous-state">Wealth Share as Endogenous State</a></li>
<li class="toctree-l2"><a class="reference internal" href="#consumption-share-as-endogenous-state">Consumption Share as Endogenous State</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-s-next">What’s Next?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Guvenen2009/Guvenen2009.html">Guvenen (2009): Asset Pricing with Heterogeneous IES</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Bianchi2011/Bianchi2011.html">Bianchi (2011): Sudden Stops in Open Economies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../safe_assets/safe_assets.html">Barro et al. (2017): Safe Assets with Rare Disasters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/functions.html">Toolbox API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AdditionalExamples.html">Additional Examples</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">GDSGE</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Heaton and Lucas (1996): Incomplete Markets with Portfolio Choices</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="heaton-and-lucas-1996-incomplete-markets-with-portfolio-choices">
<h1>Heaton and Lucas (1996): Incomplete Markets with Portfolio Choices<a class="headerlink" href="#heaton-and-lucas-1996-incomplete-markets-with-portfolio-choices" title="Permalink to this headline">¶</a></h1>
<p>The benchmark model in <a class="reference external" href="https://www.journals.uchicago.edu/doi/10.1086/262030">Heaton and Lucas (1996)</a> is a good starting point to
demonstrate the capability of the current framework in dealing with endogenous state variables with implicit law of motions.
The model encompasses many ingredients that appear in recent macroeconomic studies, such as
incomplete markets, portfolio choices, occasionally binding constraint, non-stationary shock process, and asset pricing with non-trivial market-clearing conditions.
We show how the model can be solved with wealth share or consumption share as the endogenous state, which are the two prominent approaches in the literature
and naturally fit in our toolbox framework.</p>
<div class="section" id="the-model">
<h2>The Model<a class="headerlink" href="#the-model" title="Permalink to this headline">¶</a></h2>
<p>This is an incomplete-markets model with two representative agents <span class="math notranslate nohighlight">\(i\in\mathcal{I}=\{1,2\}\)</span> who trade in equity shares and bonds.
The aggregate state <span class="math notranslate nohighlight">\(z\in\boldsymbol{Z}\)</span>, which consists of capital income share, agents’ income share, and aggregate endowment growth,
follows a first-order Markov process. <span class="math notranslate nohighlight">\(p_{t}^{s}(z^t)\)</span> and <span class="math notranslate nohighlight">\(p_{t}^{b}(z^t)\)</span>
denote share price and bond price at time <span class="math notranslate nohighlight">\(t\)</span> and in shock history <span class="math notranslate nohighlight">\(z^t=\{z_0,z_1,\dots,z_t\}\)</span>. To simplify the notations, we omit the explicit dependence on shock history.</p>
<p>Agent <span class="math notranslate nohighlight">\(i\)</span> takes the share and bond prices as given and maximizes her inter-temporal expected utility</p>
<div class="math notranslate nohighlight">
\[\mathcal{U}_{t}^{i}=\mathbb{E}_{t}\left[\sum_{\tau=0}^{\infty}\beta^{\tau}\frac{\left(c_{t+\tau}^{i}\right)^{1-\gamma}}{1-\gamma}\right]\]</div>
<p>subject to</p>
<div class="math notranslate nohighlight">
\[c_{t}^{i}+p_{t}^{s}s_{t+1}^{i}+p_{t}^{b}b_{t+1}^{i}\leq(p_{t}^{s}+d_{t})s_{t}^{i}+b_{t}^{i}+Y_{t}^{i}\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[\begin{split}s_{t+1}^{i} &amp; \geq0, \\
b_{t+1}^{i} &amp; \geq K^b_t,\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(Y^a_t\)</span> denotes the aggregate income. <span class="math notranslate nohighlight">\(d_t = \delta_t Y^a_t\)</span> is total dividend (capital income) and
<span class="math notranslate nohighlight">\(Y^i_t = \eta^i_t Y^a_t\)</span> is labor income of agent <span class="math notranslate nohighlight">\(i\)</span>. Aggregate income grows at a stochastic rate <span class="math notranslate nohighlight">\(\gamma^a_t = \frac{Y^a_t}{Y^a_{t-1}}\)</span>. <span class="math notranslate nohighlight">\(z_t = \{\gamma^a_t,\delta_t,\eta^1_t\}\)</span>
follows a first-order Markov process estimated using U.S. data. The borrowing limit is set to be a constant fraction of per capita income, i.e.,
<span class="math notranslate nohighlight">\(K^b_t = \bar{K}^b Y^a_t\)</span>.</p>
<p>In equilibrium, prices are determined such that markets clear in each
shock history:</p>
<div class="math notranslate nohighlight">
\[\begin{split}&amp; s_{t}^{1}+s_{t}^{2}=1,\\
&amp; b_{t}^{1}+b_{t}^{2}=0.\end{split}\]</div>
<p>We use the financial wealth share</p>
<div class="math notranslate nohighlight">
\[\omega_{t}^{i}=\frac{(p_{t}^{s}+d_{t})s_{t}^{i}+b_{t}^{i}}{p_{t}^{s}+d_{t}}\]</div>
<p>as an endogenous state variable. In equilibrium, the market clearing conditions imply that <span class="math notranslate nohighlight">\(\omega^1_t + \omega^2_t = 1\)</span>.</p>
<p>For any variable <span class="math notranslate nohighlight">\(x_t\)</span>,
let <span class="math notranslate nohighlight">\(\hat{x}_t\)</span> denote the normalized variable: <span class="math notranslate nohighlight">\(\hat{x}_t=\frac{x_t}{Y^a_t}\)</span>
(except <span class="math notranslate nohighlight">\(b^i_t\)</span> for which <span class="math notranslate nohighlight">\(\hat{b}^i_t = \frac{b^i_t}{Y^a_{t-1}}\)</span>). Using this normalization, agent i’s budget constraint can be rewritten as</p>
<div class="math notranslate nohighlight">
\[\hat{c}_{t}^{i}+\hat{p}_{t}^{s}s_{t+1}^{i}+p_{t}^{b}\hat{b}_{t+1}^{i}\leq\left(\hat{p}_{t}^{s}+\hat{d}_{t}\right)\omega_{t}^{i}+\hat{Y}_{t}^{i}.\]</div>
<p>The wealth share is rewritten as</p>
<div class="math notranslate nohighlight">
\[\omega_{t}^{i}=\frac{(\hat{p}_{t}^{s}+\hat{d}_{t})s_{t}^{i}+\frac{\hat{b}_{t}^{i}}{\gamma^a_t}}{\hat{p}_{t}^{s}+\hat{d}_{t}}.\]</div>
<p>The optimality of agent i’s consumption and asset choices is captured by
the first-order conditions in <span class="math notranslate nohighlight">\(s^i_{t+1}\)</span> and <span class="math notranslate nohighlight">\(b^i_{t+1}\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}1&amp; =\beta\mathbb{E}_{t}\left[\left(\frac{\hat{c}_{t+1}^{i}}{\hat{c}^i_t}\right)^{-\gamma}\left(\gamma_{t+1}^{a}\right)^{1-\gamma}\frac{\hat{p}_{t+1}^{s}+\hat{d}_{t+1}}{\hat{p}_{t}^{s}}\right]+\hat{\mu}^{i,s}_t\\
1&amp; =\beta\mathbb{E}_{t}\left[\left(\frac{\hat{c}_{t+1}^{i}}{c^i_t}\right)^{-\gamma}\left(\gamma_{t+1}^{a}\right)^{-\gamma}\frac{1}{p_{t}^{b}}\right]+\hat{\mu}^{i,b}_t,\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\hat{\mu}^{i,s}_t\)</span> and <span class="math notranslate nohighlight">\(\mu^{i,b}_t\)</span> are the Lagrangian multipliers on agent i’s no short sale constraint and borrowing constraint, respectively.
The multipliers and portfolio choices satisfy the complementary-slackness conditions:</p>
<div class="math notranslate nohighlight">
\[\begin{split}0 &amp; =  \hat{\mu}^{i,s}_t s^i_{t+1}, \\
0 &amp; = \hat{\mu}^{i,b}_t (\hat{b}^i_{t+1} - \bar{K}^b).\end{split}\]</div>
</div>
<div class="section" id="wealth-share-as-endogenous-state">
<h2>Wealth Share as Endogenous State<a class="headerlink" href="#wealth-share-as-endogenous-state" title="Permalink to this headline">¶</a></h2>
<p>We define a recursive equilibrium with the wealth share <span class="math notranslate nohighlight">\(\omega_t\)</span> defined before. A recursive equilibrium is
<span class="math notranslate nohighlight">\(\hat{c}^i(z,\omega), {s^i}', {\hat{b}^i}', \hat{\mu}^{i,s}, \hat{\mu}^{b,i}, p^s, p^b, \omega'(z';z,\omega)\)</span> that satisfy the agents’ optimization conditions
and market clearing conditions stated above.</p>
<p>We omit the explicit dependence on state <span class="math notranslate nohighlight">\((z,\omega)\)</span> except the first variable, and highlight that the
state transition function <span class="math notranslate nohighlight">\(\omega'\)</span> characterizes the implicit law of motion that should hold for each of the future exogenous state <span class="math notranslate nohighlight">\(z'\)</span>.
It should be clear at this moment that the key feature of our framework that enables to cast the equilibrium system as a single equation system,
despite the non-trivial state-transition functions, is to include the implicit transition <span class="math notranslate nohighlight">\(\omega'(z')\)</span> for each <span class="math notranslate nohighlight">\(z'\)</span> as unknowns.</p>
<p>The system can be implemented by the following <a class="reference download internal" download="" href="../../_downloads/b4c2de61fde5cef714e41ea9964e2901/HL1996.gmod"><code class="xref download docutils literal notranslate"><span class="pre">HL1996.gmod</span></code></a> code</p>
<div class="highlight-GDSGE notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">% Parameters</span>
<span class="k">parameters</span> beta gamma Kb;
beta = 0.95;  <span class="c">% discount factor</span>
gamma = 1.5;  <span class="c">% CRRA coefficient</span>
Kb = -0.05;   <span class="c">% borrowing limit in ratio of aggregate output</span>
<span class="c">% Shock variables</span>
<span class="k">var_shock</span> g d eta1;
<span class="c">% Shocks and transition matrix</span>
<span class="k">shock_num</span> = 8;
g = [.9904 1.0470 .9904 1.0470 .9904 1.0470 .9904 1.0470];
d = [.1402 .1437 .1561 .1599 .1402 .1437 .1561 .1599];
eta1 = [.3772 .3772 .3772 .3772 .6228 .6228 .6228 .6228];
<span class="k">shock_trans</span> = [
  0.3932 0.2245 0.0793 0.0453 0.1365 0.0779 0.0275 0.0157
  0.3044 0.3470 0.0425 0.0484 0.1057 0.1205 0.0147 0.0168
  0.0484 0.0425 0.3470 0.3044 0.0168 0.0147 0.1205 0.1057
  0.0453 0.0793 0.2245 0.3932 0.0157 0.0275 0.0779 0.1365
  0.1365 0.0779 0.0275 0.0157 0.3932 0.2245 0.0793 0.0453
  0.1057 0.1205 0.0147 0.0168 0.3044 0.3470 0.0425 0.0484
  0.0168 0.0147 0.1205 0.1057 0.0484 0.0425 0.3470 0.3044
  0.0157 0.0275 0.0779 0.1365 0.0453 0.0793 0.2245 0.3932
  ];
shock_trans = shock_trans ./ sum(<span class="k">shock_trans</span>,2);
<span class="c">% State variables</span>
<span class="k">var_state</span> w1;  % wealth share
w1 = linspace(-0.05,1.05,201);
<span class="c">% Endogenous variables and bounds</span>
<span class="k">var_policy</span> c1 c2 s1p nb1p nb2p ms1 ms2 mb1 mb2 ps pb w1n[8];
<span class="k">inbound</span> c1 1e-12 1;
<span class="k">inbound</span> c2 1e-12 1;
<span class="k">inbound</span> s1p 0.0 1.0;
<span class="k">inbound</span> nb1p 0.0 1.0;   % nb1p=b1p-Kb
<span class="k">inbound</span> nb2p 0.0 1.0;   
<span class="k">inbound</span> ms1 0 1;        % Multilier for constraints
<span class="k">inbound</span> ms2 0 1;
<span class="k">inbound</span> mb1 0 1;
<span class="k">inbound</span> mb2 0 1;
inbound ps 0 3 <span class="k">adaptive</span>(1.5);
inbound pb 0 3 <span class="k">adaptive</span>(1.5);
<span class="k">inbound</span> w1n -0.5 1.5;
<span class="c">% Extra output variables</span>
<span class="k">var_aux</span> equity_premium;
<span class="c">% Interpolation objects</span>
<span class="k">var_interp</span> ps_future pb_future c1_future c2_future;
<span class="k">initial</span> ps_future 0.0;
<span class="k">initial</span> pb_future 0.0;
<span class="k">initial</span> c1_future w1.*d+eta1;
<span class="k">initial</span> c2_future (1-w1).*d+1-eta1;
ps_future = ps;
pb_future = pb;
c1_future = c1;
c2_future = c2;
<span class="c">% Variables to be used in simulation if SIMU_RESOLVE=1</span>
<span class="k">var_output</span> c1 c2 ps pb equity_premium w1n;

<span class="k">model;</span>
  <span class="c">% Interpolation</span>
  [psn&#39;,pbn&#39;,c1n&#39;,c2n&#39;] = <span class="k">GNDSGE_INTERP_VEC</span>&#39;(w1n&#39;);
  <span class="c">% Expectations in Euler Equations</span>
  es1 = GNDSGE_EXPECT{g&#39;^(1-gamma)*(c1n&#39;/c1)^(-gamma)*(psn&#39;+d&#39;)/ps};
  es2 = GNDSGE_EXPECT{g&#39;^(1-gamma)*(c2n&#39;/c2)^(-gamma)*(psn&#39;+d&#39;)/ps};
  eb1 = GNDSGE_EXPECT{g&#39;^(-gamma)*(c1n&#39;/c1)^(-gamma)/pb};
  eb2 = GNDSGE_EXPECT{g&#39;^(-gamma)*(c2n&#39;/c2)^(-gamma)/pb};
  <span class="c">% b transformation</span>
  b1p = nb1p + Kb;  <span class="c">% Transform bond back</span>
  b2p = nb2p + Kb;  
  s2p = 1-s1p;      <span class="c">% Market clear of shares</span>
  <span class="c">% Budget constraint</span>
  budget_1 = w1*(ps+d)+eta1 - c1 - ps*s1p - pb*b1p;
  budget_2 = (1-w1)*(ps+d)+(1-eta1) - c2 - ps*s2p - pb*b2p;
  <span class="c">% Consistency</span>
  w1_consis&#39; = (s1p*(psn&#39;+d&#39;) + b1p/g&#39;)/(psn&#39;+d&#39;) - w1n&#39;;
  <span class="c">% Extra output</span>
  equity_premium = GNDSGE_EXPECT{(psn&#39;+d&#39;)/ps*g&#39;} - 1/pb;
  <span class="k">equations;</span>
    -1+beta*es1+ms1;
    -1+beta*es2+ms2;
    -1+beta*eb1+mb1;
    -1+beta*eb2+mb2;
    ms1*s1p;
    ms2*s2p;
    mb1*nb1p;
    mb2*nb2p;
    b1p+b2p;
    budget_1;
    budget_2;
    w1_consis&#39;;
  <span class="k">end;</span>
<span class="k">end;</span>

<span class="k">simulate;</span>
  <span class="k">num_periods</span> = 10000;
  <span class="k">num_samples</span> = 24;
  <span class="k">initial</span> w1 0.5;
  <span class="k">initial</span> shock 1;
  <span class="k">var_simu</span> c1 c2 ps pb equity_premium;
  w1&#39; = w1n&#39;;
<span class="k">end;</span>
</pre></div>
</td></tr></table></div>
<p>As can be seen, the implicit law of motion is captured by the consistency equation</p>
<div class="highlight-GDSGE notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>72</pre></div></td><td class="code"><div class="highlight"><pre><span></span>  w1_consis&#39; = (s1p*(psn&#39;+d&#39;) + b1p/g&#39;)/(psn&#39;+d&#39;) - w1n&#39;;
</pre></div>
</td></tr></table></div>
<p>which says that the induced <span class="math notranslate nohighlight">\(\omega'\)</span> by current decisions of stock and bond holdings should be consistent with the
unknowns for each of the future exogenous states state by state. Notice that the unknowns <span class="math notranslate nohighlight">\(\omega\)</span> are inputs in the
state transition functions to forecast future consumption and prices, which are required to formulate the recursive system, in</p>
<div class="highlight-GDSGE notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>58</pre></div></td><td class="code"><div class="highlight"><pre><span></span>  [psn&#39;,pbn&#39;,c1n&#39;,c2n&#39;] = <span class="k">GNDSGE_INTERP_VEC</span>&#39;(w1n&#39;);
</pre></div>
</td></tr></table></div>
<p>Accordingly, <span class="math notranslate nohighlight">\(\omega'\)</span> is declared to a be a vector of unknowns in</p>
<div class="highlight-GDSGE notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>28</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">var_policy</span> c1 c2 s1p nb1p nb2p ms1 ms2 mb1 mb2 ps pb w1n[8];
</pre></div>
</td></tr></table></div>
<p>and the consistency equations are declared to be part of the equation system in</p>
<div class="highlight-GDSGE notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>87</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    w1_consis&#39;;
</pre></div>
</td></tr></table></div>
<p>Since now the transition of endogenous state involves realizations of future exogenous states,
in the simulation, we need to specify the transition depending on future realization as</p>
<div class="highlight-GDSGE notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>97</pre></div></td><td class="code"><div class="highlight"><pre><span></span>  w1&#39; = w1n&#39;;
</pre></div>
</td></tr></table></div>
<p>Notice the prime operator in <em>w1n’</em>, which is the syntax to specify the transition’s dependence on the
realization of future exogenous states (recall, <em>w1n</em> is a vector solved as part of the <em>var_policy</em>).</p>
<p>Now we discuss several tricks that facilitate casting the recursive system to the toolbox, which are commonly
used for this class of problems.</p>
<p>Since the original problem’s borrowing constraint is proportational to aggregate endowment, we can use a transformation
to simplify the constraint</p>
<div class="highlight-GDSGE notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>65
66</pre></div></td><td class="code"><div class="highlight"><pre><span></span>  b1p = nb1p + Kb;  <span class="c">% Transform bond back</span>
  b2p = nb2p + Kb;  
</pre></div>
</td></tr></table></div>
<p>where <em>Kb</em> is the parameter governing the  borrowing constraint in fraction of aggregate endowment (<span class="math notranslate nohighlight">\(b^i \geq Kb * Y^a\)</span>), and <em>nb1p</em> is the unknown defined as
<span class="math notranslate nohighlight">\(nb^i=\hat{b}^i+Kb\)</span> which is required to be positive. Such transformation
remains trivial in the current problem, but becomes crucial when the borrowing constraint depends on an asset price, which makes the constraint
not necessarily a box constraint. See example <a class="reference internal" href="../CaoNie2017/CaoNie2017.html#caonie2017"><span class="std std-ref">Cao and Nie (2017)</span></a>, which provides a global solution to a <a class="reference external" href="https://www.journals.uchicago.edu/doi/abs/10.1086/262072">Kiyotaki-Moore</a> type model, where
the borrowing constraint is tied to the price of an asset in fixed supply.</p>
<p>Some built-in functions of the toolbox are used in this example.</p>
<div class="highlight-GDSGE notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>58</pre></div></td><td class="code"><div class="highlight"><pre><span></span>  [psn&#39;,pbn&#39;,c1n&#39;,c2n&#39;] = <span class="k">GNDSGE_INTERP_VEC</span>&#39;(w1n&#39;);
</pre></div>
</td></tr></table></div>
<p><em>GNDSGE_INTERP_VEC</em> is a built-in function that evaluates function approximations for implicit state transition functions
defined in <em>var_interp</em> once for all. The results are returned in the order of variables defined in <em>var_interp</em>.
The prime operator following <em>GNDSGE_INTERP_VEC</em> indicates that the approximation is done for each of the exogenous states.
Accordingly, the returned values are vectors (of length 8 in the current example) corresponding to each of the future exogenous states.
This step can be replaced by</p>
<div class="highlight-GDSGE notranslate"><div class="highlight"><pre><span></span>psn&#39; = ps_future&#39;(w1n&#39;);
pbn&#39; = pb_future&#39;(w1n&#39;);
c1n&#39; = c1_future&#39;(w1n&#39;);
c2n&#39; = c2_future&#39;(w1n&#39;);
</pre></div>
</div>
<p>although at a lower speed since <em>GNDSGE_INTERP_VEC</em> evaluates function approximations with vectorization. (This is particular relevant
when using the adaptive sparse grid method as the coefficients are stored in a table with each entry represents
the coefficients across all vector dimensions. Therefore, using <em>GNDSGE_INTERP_VEC</em> instead of individual evaluations
not only enables vectorization but also allows searching the hash table only once). <em>GNDSGE_INTERP_VEC</em> can be also used to skip
certain variables in <em>var_interp</em> when some of them are not necessary, and can be used without the prime operator but
explicitly specifying the exogenous state that the approximation should be evaluated. This is particularly relevant when
expectation can be calculated before evaluating the equation system, so the evaluation is conditional on the current state.
See the <a class="reference internal" href="../../usage/functions.html#toolbox-api"><span class="std std-ref">Toolbox API</span></a> for details.</p>
<p>After the gmod file is parsed and compiled by a local or remote compiler, first call the iter file in matlab, which produces
results as follows</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt;&gt; IterRslt = iter_HL1996;
Iter:10, Metric:0.133835, maxF:7.07521e-09
Elapsed time is 8.338626 seconds.

...

Iter:209, Metric:9.56568e-07, maxF:8.69762e-09
Elapsed time is 0.443740 seconds.
</pre></div>
</div>
<p>We can inspect the policy functions (e.g., for the equity premium defined in Line 74 and included in <em>var_output</em> in Line 54):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt;&gt; figure;
plot(IterRslt_wealth.var_state.w1, IterRslt_wealth.var_aux.equity_premium*100,&#39;LineWidth&#39;,1.5);
title(&#39;Equity Premium&#39;);
xlabel(&#39;Wealth Share of Agent 1&#39;);
ylabel(&#39;%&#39;);
</pre></div>
</div>
<p>which produces</p>
<a class="reference internal image-reference" href="../../_images/policy_equity_premium1.png"><img alt="../../_images/policy_equity_premium1.png" src="../../_images/policy_equity_premium1.png" style="width: 389.6px; height: 325.6px;" /></a>
<p>The policy functions demonstrate the non-linear and non-monotone properties of the model. These non-linear regions appear with
positive probability in the model’s ergodic set as shown below.</p>
<p>We can simulate the model using the converged policy functions contained in <em>IterRslt</em>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt;&gt; SimuRslt = simulate_HL1996(IterRslt);
Periods: 1000
shock      w1      c1      c2      ps      pbequity_premium
    1  0.7879  0.6058  0.5344    2.48  0.93240.001541
Elapsed time is 2.077381 seconds.
Periods: 2000
shock      w1      c1      c2      ps      pbequity_premium
    1  0.7147  0.5925  0.5477   2.469  0.93220.001442
Elapsed time is 1.478454 seconds.

...

Periods: 10000
shock      w1      c1      c2      ps      pbequity_premium
    3  0.2948  0.5243  0.6318   2.553  0.92950.001643
Elapsed time is 1.488598 seconds.
</pre></div>
</div>
<p>And inspect the simulation results:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt;&gt; figure;
histogram(SimuRslt.w1(:,1000:end),50,&#39;Normalization&#39;,&#39;probability&#39;);
title(&#39;Histogram of Wealth Share in the Ergodic Distribution&#39;);
xlabel(&#39;Wealth Share of Agent 1&#39;);
ylabel(&#39;Fractions&#39;);
</pre></div>
</div>
<p>which produces</p>
<a class="reference internal image-reference" href="../../_images/histogram_w11.png"><img alt="../../_images/histogram_w11.png" src="../../_images/histogram_w11.png" style="width: 614.8000000000001px; height: 500.40000000000003px;" /></a>
<p>The spikes in the ergodic distribution of wealth share at the two ends imply that the constraints are occasionally binding.</p>
</div>
<div class="section" id="consumption-share-as-endogenous-state">
<h2>Consumption Share as Endogenous State<a class="headerlink" href="#consumption-share-as-endogenous-state" title="Permalink to this headline">¶</a></h2>
<p>The model can be solved using consumption share as the endogenous state. In this case, the budget constraint</p>
<div class="math notranslate nohighlight">
\[\hat{c}_{t+1}^i=s_{t+1}^i (\hat{p}_{t+1}^s + \hat{d}_{t+1})+ \frac{\hat{b}_{t+1}^i  }{g_{t+1}}+
\underbrace{\eta_{t+1}^i - \hat{p}_{t+1}^s s_{t+2}^i-p_{t+1}^b \hat{b}_{t+2}^i}_{\text{Financial Wealth}_{t+1}}\]</div>
<p>is a natural consistency equation for the transition of consumption share <span class="math notranslate nohighlight">\(\hat{c}^1\)</span>. Specifically, with consumption share,
the recursive equilibrium can be defined as <span class="math notranslate nohighlight">\({s^i}'(z,\hat{c}^1),{\hat{b}^i}'(z,\hat{c}^1), \hat{p}^s(z,\hat{c}^1),p^b(z,\hat{c}^1), {\hat{c}^1}'(z';z,\hat{c}^1)\)</span> such that</p>
<div class="math notranslate nohighlight">
\[\begin{split}-1+\beta  \mathbb{E}_t
\Big[\gamma^{1-\gamma}_{t+1}\frac{[\hat{c}_{t+1}^i]^{-\gamma}}{[\hat{c}_t^i]^{-\gamma} }  \frac{\hat{p}_{t+1}^s + \hat{d}_{t+1}}{\hat{p}_t^s}] + \hat{\mu}^{i,s}_t=0, \forall i=1,2
\\
-1+\beta  \mathbb{E}_t
\Big[\gamma_{t+1}^{-\gamma}\frac{[\hat{c}_{t+1}^i]^{-\gamma}}{[\hat{c}_t^i]^{-\gamma} }  \frac{1}{{p}_t^b}\Big] + \hat{\mu}^{i,b}_t=0, \forall i=1,2
\\
\hat{b}_{t+1}^1+\hat{b}_{t+1}^2=0
\\
s_{t+1}^1+s_{t+1}^2=1
\\
\hat{c}^1_{t+1}=s_{t+1}^i (\hat{p}_{t+1}^s + \hat{d}_{t+1})+ \frac{\hat{b}_{t+1}^i  }{\gamma_{t+1}}+
\underbrace{\eta_{t+1}^i - \hat{p}_{t+1}^s s_{t+2}^i-p_{t+1}^b \hat{b}_{t+2}^i}_{\text{Financial Wealth}_{t+1}}, \forall z_{t+1}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\hat{c}^2\)</span> (and <span class="math notranslate nohighlight">\((\hat{c}^2)'\)</span>) can be trivially inferred from the goods market clearing condition <span class="math notranslate nohighlight">\(\hat{c}^1+\hat{c}^2=1 +\hat{d}\)</span>, and, hence does not
need to be defined as extra unknowns when evaluating the equation system.  The “Financial Wealth” is a function of future endogenous states, and can be part of the implicit
state transition functions.</p>
<p>The gmod file that implements the recursive system is (<a class="reference download internal" download="" href="../../_downloads/db3ca1822fafc3a469b7bc3158511822/HL1996_consumption_share.gmod"><code class="xref download docutils literal notranslate"><span class="pre">HL1996_consumption_share.gmod</span></code></a>)</p>
<div class="highlight-GDSGE notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">% Parameters</span>
<span class="k">parameters</span> beta gamma Kb;
beta = 0.95;  <span class="c">% discount factor</span>
gamma = 1.5;  <span class="c">% CRRA coefficient</span>
Kb = -0.05;   <span class="c">% borrowing limit in ratio of aggregate output</span>
<span class="c">% Shock variables</span>
<span class="k">var_shock</span> g d eta1;
<span class="c">% Shocks and transition matrix</span>
<span class="k">shock_num</span> = 8;
g = [.9904 1.0470 .9904 1.0470 .9904 1.0470 .9904 1.0470];
d = [.1402 .1437 .1561 .1599 .1402 .1437 .1561 .1599];
eta1 = [.3772 .3772 .3772 .3772 .6228 .6228 .6228 .6228];
<span class="k">shock_trans</span> = [
  0.3932 0.2245 0.0793 0.0453 0.1365 0.0779 0.0275 0.0157
  0.3044 0.3470 0.0425 0.0484 0.1057 0.1205 0.0147 0.0168
  0.0484 0.0425 0.3470 0.3044 0.0168 0.0147 0.1205 0.1057
  0.0453 0.0793 0.2245 0.3932 0.0157 0.0275 0.0779 0.1365
  0.1365 0.0779 0.0275 0.0157 0.3932 0.2245 0.0793 0.0453
  0.1057 0.1205 0.0147 0.0168 0.3044 0.3470 0.0425 0.0484
  0.0168 0.0147 0.1205 0.1057 0.0484 0.0425 0.3470 0.3044
  0.0157 0.0275 0.0779 0.1365 0.0453 0.0793 0.2245 0.3932
  ];
shock_trans = shock_trans ./ sum(<span class="k">shock_trans</span>,2); % Normalize
<span class="c">% State variables</span>
<span class="k">var_state</span> c1;  % wealth share
c1 = linspace(0.2,0.8,101);
<span class="c">% Endogenous variables and bounds</span>
<span class="k">var_policy</span> s1p nb1p nb2p ms1 ms2 mb1 mb2 ps pb c1n[8];
<span class="k">inbound</span> s1p 0.0 1.0;
<span class="k">inbound</span> nb1p 0.0 1.0;   % nb1p=b1p-Kb
<span class="k">inbound</span> nb2p 0.0 1.0;   
<span class="k">inbound</span> ms1 0 1;        % Multilier for constraints
<span class="k">inbound</span> ms2 0 1;
<span class="k">inbound</span> mb1 0 1;
<span class="k">inbound</span> mb2 0 1;
inbound ps 0 3 <span class="k">adaptive</span>(1.5);
inbound pb 0 3 <span class="k">adaptive</span>(1.5);
<span class="k">inbound</span> c1n 0.0 1.0;
<span class="c">% Extra output variables</span>
<span class="k">var_aux</span> equity_premium c2 w1 flow;
<span class="c">% Interpolation objects</span>
<span class="k">var_interp</span> ps_future pb_future flow_future;
<span class="k">initial</span> ps_future 0.0;
<span class="k">initial</span> pb_future 0.0;
<span class="k">initial</span> flow_future eta1;
ps_future = ps;
pb_future = pb;
flow_future = flow;
<span class="c">% Variables to be used in simulation</span>
<span class="k">var_output</span> c2 w1 ps pb equity_premium c1n;

<span class="k">model;</span>
  <span class="c">% Interpolation</span>
  [psn&#39;,pbn&#39;,flow_future&#39;] = <span class="k">GNDSGE_INTERP_VEC</span>&#39;(c1n&#39;);
  <span class="c">% Goods market clear</span>
  c2n&#39; = 1+d&#39;-c1n&#39;;
  c2 = 1+d-c1;
  
  <span class="c">% Expectations in Euler Equations</span>
  es1 = GNDSGE_EXPECT{g&#39;^(1-gamma)*(c1n&#39;/c1)^(-gamma)*(psn&#39;+d&#39;)/ps};
  es2 = GNDSGE_EXPECT{g&#39;^(1-gamma)*(c2n&#39;/c2)^(-gamma)*(psn&#39;+d&#39;)/ps};
  eb1 = GNDSGE_EXPECT{g&#39;^(-gamma)*(c1n&#39;/c1)^(-gamma)/pb};
  eb2 = GNDSGE_EXPECT{g&#39;^(-gamma)*(c2n&#39;/c2)^(-gamma)/pb};
  <span class="c">% b transformation</span>
  b1p = nb1p + Kb;  <span class="c">% Transform bond back</span>
  b2p = nb2p + Kb;  
  s2p = 1-s1p;      <span class="c">% Market clear of shares</span>
  <span class="c">% Budget constraint</span>
  budget_1 = w1*(ps+d)+eta1 - c1 - ps*s1p - pb*b1p;
  budget_2 = (1-w1)*(ps+d)+(1-eta1) - c2 - ps*s2p - pb*b2p;
  <span class="c">% Consistency</span>
  c1_consis&#39; = s1p*(psn&#39;+d&#39;) + b1p/g&#39; + flow_future&#39; - c1n&#39;;
  <span class="c">% Calculate w1, from the individual budget constraint</span>
  w1 = (c1 + ps*s1p + pb*b1p - eta1) / (ps + d);
  
  <span class="c">% Extra output</span>
  flow = eta1 - ps*s1p - pb*b1p;
  equity_premium = GNDSGE_EXPECT{(psn&#39;+d&#39;)/ps*g&#39;} - 1/pb;
  <span class="k">equations;</span>
    -1+beta*es1+ms1;
    -1+beta*es2+ms2;
    -1+beta*eb1+mb1;
    -1+beta*eb2+mb2;
    ms1*s1p;
    ms2*s2p;
    mb1*nb1p;
    mb2*nb2p;
    b1p+b2p;
    c1_consis&#39;;
  <span class="k">end;</span>
<span class="k">end;</span>

<span class="k">simulate;</span>
  <span class="k">num_periods</span> = 10000;
  <span class="k">num_samples</span> = 24;
  <span class="k">initial</span> c1 0.5;
  <span class="k">initial</span> shock 1;
  <span class="k">var_simu</span> w1 c2 ps pb equity_premium;
  c1&#39; = c1n&#39;;
<span class="k">end;</span>
</pre></div>
</td></tr></table></div>
<p>As shown, compared to the one with wealth share as the endogenous state,
the new implementation is made possible by declaring <span class="math notranslate nohighlight">\({\hat{c}_1}'(z')\)</span> to be <em>c1n</em> in</p>
<div class="highlight-GDSGE notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>28</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">var_policy</span> s1p nb1p nb2p ms1 ms2 mb1 mb2 ps pb c1n[8];
</pre></div>
</td></tr></table></div>
<p>by defining the “Financial Wealth” by <em>flow</em> as <em>var_interp</em></p>
<div class="highlight-GDSGE notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>42</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">var_interp</span> ps_future pb_future flow_future;
</pre></div>
</td></tr></table></div>
<p>by defining the consistency equations for <span class="math notranslate nohighlight">\(\hat{c}_1\)</span> in</p>
<div class="highlight-GDSGE notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>72</pre></div></td><td class="code"><div class="highlight"><pre><span></span>  c1_consis&#39; = s1p*(psn&#39;+d&#39;) + b1p/g&#39; + flow_future&#39; - c1n&#39;;
</pre></div>
</td></tr></table></div>
<p>and including them as part of the equation system.</p>
<p>Finally we compare the solutions solved with wealth share as the endogenous state and consumption share as the endogenous state.
This can be done by projecting the solutions to the same endogenous state. For example</p>
<div class="highlight-GDSGE notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>74</pre></div></td><td class="code"><div class="highlight"><pre><span></span>  w1 = (c1 + ps*s1p + pb*b1p - eta1) / (ps + d);
</pre></div>
</td></tr></table></div>
<p>constructs the wealth share from the budget constraint following the definition.</p>
<a class="reference internal image-reference" href="../../_images/policy_premium_overlapped.png"><img alt="../../_images/policy_premium_overlapped.png" src="../../_images/policy_premium_overlapped.png" style="width: 387.20000000000005px; height: 325.6px;" /></a>
<p>As shown, the two solutions (solid lines for wealth share as endogenous state and markers “X” for consumption share as endogenous state) are not visually
distinguishable.</p>
</div>
<div class="section" id="what-s-next">
<h2>What’s Next?<a class="headerlink" href="#what-s-next" title="Permalink to this headline">¶</a></h2>
<p>Through this simple example, you understand the power of the toolbox and all the essential ingredients to solve
a modern macro model.</p>
<p>For the time-iteration algorithm to work robustly, a crucial step is to define the starting point of the iteration
properly. A candidate that delivers good theoretical property and proves to be numerically stable is to start from a last-period problem,
so the algorithm can be viewed as taking the limit of the solution from finite-horizon iterations (<a class="reference external" href="https://www.jstor.org/stable/2951731">Duffie et al (1994)</a>; <a class="reference external" href="https://www.jstor.org/stable/2951735">Magill and Quinzi (1994)</a>; <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S0022053119301255">Cao (2020)</a>).</p>
<p>The last-period problem has been so far trivial in the <a class="reference internal" href="../rbc/rbc.html#getting-started-a-simple-rbc-model"><span class="std std-ref">RBC model</span></a> and <a class="reference external" href="https://www.journals.uchicago.edu/doi/10.1086/262030">Heaton and Lucas (1996)</a> examples,
but could turn out to be more complex
and requires to define a different system of equations than the main <em>model;</em> block. Also, at the boundary of the state space,
the equilibrium may be characterized by a different system of equations, and such boundary conditions turn out to be necessary to solve
many models robustly (for example, consumption might be exactly zero at the boundary, violating the Inada condition). To see how these issues are addressed very conveniently in the toolbox, see example
<a class="reference internal" href="../CaoNie2017/CaoNie2017.html#caonie2017"><span class="std std-ref">Cao and Nie (2017)</span></a>.</p>
<p>Or you can directly proceed to <a class="reference internal" href="../../usage/functions.html#toolbox-api"><span class="std std-ref">the toolbox’s API</span></a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../Guvenen2009/Guvenen2009.html" class="btn btn-neutral float-right" title="Guvenen (2009): Asset Pricing with Heterogeneous IES" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../rbc/rbcIrr.html" class="btn btn-neutral float-left" title="A RBC Model with Irreversible Investment" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Dan Cao, Wenlan Luo, and Guangyu Nie

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>