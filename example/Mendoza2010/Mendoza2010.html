

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Mendoza (2010): Sudden Stops with Asset Price Deflation &mdash; GDSGE Homepage</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Cao and Nie (2017): Amplification and Asymmetry without Collateral Constraint" href="../CaoNie2017/CaoNie2017.html" />
    <link rel="prev" title="Krusell and Smith (1998): Heterogeneous-agent Models with Aggregate Uncertainty" href="../KS1998/KS1998.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> GDSGE
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rbc/rbc.html">Getting Started - A Simple RBC Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rbc/rbcIrr.html">A RBC Model with Irreversible Investment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../HL1996/HL1996.html">Heaton and Lucas (1996): Incomplete Markets with Portfolio Choices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Guvenen2009/Guvenen2009.html">Guvenen (2009): Asset Pricing with Heterogeneous IES</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Bianchi2011/Bianchi2011.html">Bianchi (2011): Sudden Stops in Open Economies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../safe_assets/safe_assets.html">Barro et al. (2017): Safe Assets with Rare Disasters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pandemic/GLSW2020.html">Guerrieri et al. (2020): Negative Supply Shocks That Cause Demand Shortages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/functions.html">Toolbox API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../AdditionalExamples.html">Additional Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../Huggett1997/Huggett1997.html">Huggett (1997): Steady States and Transition Paths in Heterogeneous-agent Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../KS1998/KS1998.html">Krusell and Smith (1998): Heterogeneous-agent Models with Aggregate Uncertainty</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Mendoza (2010): Sudden Stops with Asset Price Deflation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-model">The Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#state-space-transformation">State Space Transformation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-gmod-file">The gmod File</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-s-next">What’s Next?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../CaoNie2017/CaoNie2017.html">Cao and Nie (2017): Amplification and Asymmetry without Collateral Constraint</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Cao2018/Cao2018.html">Cao (2018): Speculation and Wealth Distribution under Beliefs Heterogeneity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Cao2020/Cao2020.html">Cao (2020): Continuum versus Finite Agents in Krusell and Smith (1998)</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">GDSGE</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../AdditionalExamples.html">Additional Examples</a> &raquo;</li>
        
      <li>Mendoza (2010): Sudden Stops with Asset Price Deflation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="mendoza-2010-sudden-stops-with-asset-price-deflation">
<h1>Mendoza (2010): Sudden Stops with Asset Price Deflation<a class="headerlink" href="#mendoza-2010-sudden-stops-with-asset-price-deflation" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://www.aeaweb.org/articles?id=10.1257/aer.100.5.1941">Mendoza (2010)</a>  studies an open economy model with
a borrowing constraint tied to the capital price. A negative shock that lowers the capital price
tightens the collateral constraint, leading to deleveraging and reductions in financing for both investment and working capital, so the effect of the shock gets amplified.
The model generates financial crises with current account reversals resembling those experienced by many emerging economies.
The collateral constraints are occasionally binding in the ergodic set.
The equilibrium policy and state transition functions are highly nonlinear. The model has two endogenous states, capital and bond, and can be solved
using the toolbox very easily (in 200 lines of GDSGE code and within a minute on a regular laptop).</p>
<p>Though the model can be directly solved over the natural state space (capital, bond) using the toolbox, practically it is sometimes difficult
to determine the feasible state space over which an equilibrium exists. For example,  in the current context, given capital stock, an economy too much in debt
may not be able to find feasible allocations. This suggests that the lower bound of bond depends on the capital stock
and the feasible region of the state space is not a simple box (rectangle). We demonstrate how such a model can solved with state transformation and implicit
state transition functions, without the hassle of determining the feasible region ex-ante.</p>
<div class="section" id="the-model">
<h2>The Model<a class="headerlink" href="#the-model" title="Permalink to this headline">¶</a></h2>
<p>There is a single consumption good. The inter-temporal expected utility is given by</p>
<div class="math notranslate nohighlight">
\[\mathbb E_{0}
\sum_{t=0}^{\infty}  \beta^t[ u\left(c_{t}-N\left(L_{t}\right)\right)]\]</div>
<p>where <span class="math notranslate nohighlight">\(\beta\)</span> is the discount factor, <span class="math notranslate nohighlight">\(c_t\)</span> is consumption, <span class="math notranslate nohighlight">\(L_t\)</span> is labor supply. <span class="math notranslate nohighlight">\(u(\cdot)\)</span> is the utility function.</p>
<p>The production function is</p>
<div class="math notranslate nohighlight">
\[A_tF(k_t,L_t,v_t),\]</div>
<p>where <span class="math notranslate nohighlight">\(A_t\)</span> is productivity which follows an exogenous Markov process. <span class="math notranslate nohighlight">\(F\)</span> is a constant-return-to-scale production function. <span class="math notranslate nohighlight">\(k_t\)</span> is capital, <span class="math notranslate nohighlight">\(L_t\)</span> is labor, and <span class="math notranslate nohighlight">\(v_t\)</span> is intermediate goods used.</p>
<p><span class="math notranslate nohighlight">\(\phi\)</span> fraction of the cost of hiring <span class="math notranslate nohighlight">\(L_t\)</span> and <span class="math notranslate nohighlight">\(v_t\)</span> needs to be financed externally, at a (world) gross interest rate <span class="math notranslate nohighlight">\(R_t\)</span> that follows an exogenous process.
The economy can trade a state non-contingent bond <span class="math notranslate nohighlight">\(b_{t+1}\)</span> (who negative values imply borrowing) with the world, but borrowing is subject to the following constraint</p>
<div class="math notranslate nohighlight">
\[q_{t}^{b} b_{t+1}-\phi R_{t}\left(w_{t} L_{t}+p_{t} v_{t}\right) \geq-\kappa q_{t} k_{t+1},\]</div>
<p>which says that the borrowing plus the finance for working capital cannot exceed <span class="math notranslate nohighlight">\(\kappa\)</span> fraction of the value of the next period capital <span class="math notranslate nohighlight">\(k_{t+1}\)</span>,
where <span class="math notranslate nohighlight">\(p_t\)</span> is intermediate goods price following an exogenous process,
<span class="math notranslate nohighlight">\(w_t\)</span> is wage and <span class="math notranslate nohighlight">\(q_t\)</span> is the endogenous asset price of the next period capital determined below.
It should be clear that the binding collateral constraint will affect the financing of working capital.</p>
<p>Investment is subject to a convex adjustment cost</p>
<div class="math notranslate nohighlight">
\[i_{t}=k_{t+1} - (1-\delta)k_t+\frac{1}{2} a \frac{(k_{t+1}-k_t)^{2}}{k_t},\]</div>
<p>where <span class="math notranslate nohighlight">\(a\)</span> is a parameter determining the level of adjustment cost. The next period capital price is competitively determined as</p>
<div class="math notranslate nohighlight">
\[q_t=\frac{\partial i_t}{\partial k_{t+1}}=1+a\frac{k_{t+1}-k_t}{k_t}.\]</div>
<p>We also write down the shadow price of current capital</p>
<div class="math notranslate nohighlight">
\[\begin{split}q_t+d_t &amp; \equiv A_tF_1(k_t,L_t,v_t)-\frac{\partial i_t}{\partial k_{t}}\\
&amp;=A_tF_1(k_t,L_t,v_t)-  (1-\delta) -a\frac{k_{t+1}-k_t}{k_t}- \frac{a}{2}\frac{(k_{t+1}-k_t)^{2}}{k_t^2}.\end{split}\]</div>
<p>Under the competitive equilibrium, the agent maximizes the inter-temporal expected utility subject to</p>
<div class="math notranslate nohighlight">
\[\begin{split}(1+\tau)c_{t}+i_{t}=A_t F\left(k_{t}, L_{t}, v_{t}\right)-p_{t} v_{t}-\phi\left(R_{t}-1\right)\left(w_{t} L_{t}+p_{t} v_{t}\right)-q_{t}^{b} b_{t+1}+b_{t},
\\
q_{t}^{b} b_{t+1}-\phi R_{t}\left(w_{t} L_{t}+p_{t} v_{t}\right) \geq-\kappa q_{t} k_{t+1},
\\
i_{t}=k_{t+1} - (1-\delta)k_t+\frac{1}{2} a^2 \frac{(k_{t+1}-k_t)^{2}}{k_t},\end{split}\]</div>
<p>taking exogenous processes <span class="math notranslate nohighlight">\(A_t,R_t,p_t\)</span> and <span class="math notranslate nohighlight">\(q_t^b(=1/R_t)\)</span>, and equilibrium prices <span class="math notranslate nohighlight">\(w_t\)</span> and <span class="math notranslate nohighlight">\(q_t\)</span> as given. Denote <span class="math notranslate nohighlight">\(\lambda_t\)</span> as the multiplier for the budget constraint and <span class="math notranslate nohighlight">\(\mu_t\)</span> as the multiplier for the collateral constraint, the first order conditions and complementarity slackness conditions read:</p>
<div class="math notranslate nohighlight">
\[\begin{split}&amp; \{b_{t+1}\}:
-q_t^b\lambda_t+\mu_tq_t^b+\beta \mathbb{E}_t \lambda_{t+1}=0
\\
&amp; \{k_{t+1}\}: \beta \mathbb{E}_t \lambda_{t+1}A_{t+1}F_1(k_{t+1},L_{t+1},v_{t+1}) - \beta \mathbb{E}_t\lambda_{t+1} \frac{\partial i_{t+1}}{\partial k_{t+1}} - \lambda_t q_t +\mu_t \kappa q_t=0
\\
&amp; \{\mu_t\}: [q_{t}^{b} b_{t+1}-\phi R_{t}\left(w_{t} L_{t}+p_{t} v_{t}\right) +\kappa q_{t} k_{t+1}]{\mu}_t=0
\\
&amp; \{L_t\}: A_{t}F_2(k_t,L_t,v_t)=w_t (1+\phi(R_t-1)+\frac{\mu_t}{\lambda_t} \phi R_t); \ w_t=N'(L_{t})(1+\tau)
\\
&amp; \{v_t\}: A_{t}F_3(k_t,L_t,v_t)=p_{t}(1+\phi(R_t-1)+\frac{\mu_t}{\lambda_t} \phi R_t)
\\
&amp; \{c_t\}: u'(c_t-N(L_t)) = \lambda_t(1+\tau)\end{split}\]</div>
<p>The exogenous states are <span class="math notranslate nohighlight">\(z=(A,R,p)\)</span>. The natural endogenous states are <span class="math notranslate nohighlight">\((k,b)\)</span>. A recursive equilibrium  is functions <span class="math notranslate nohighlight">\(b'(z,k,b), k',\mu,L,v,c,\lambda,q,w\)</span> that satisfy the above equations. The system can be further simplified. Before doing so, we introduce the state transformation to ensure the
feasible state space is square.</p>
</div>
<div class="section" id="state-space-transformation">
<h2>State Space Transformation<a class="headerlink" href="#state-space-transformation" title="Permalink to this headline">¶</a></h2>
<p>If the economy is too indebted, it may never be able to finance positive consumption subject to the current collateral constraint, and the equilibrium does not exist.
Therefore, the lower bound of the bond holding of the feasible region in the state space depends on the exogenous shocks and capital, rendering the feasible state space non-rectangle.
This non-rectangle feasible region also cannot be determined ex-ante, since the collateral constraint depends on the endogenous capital price.
This is a well-known challenge encountered by many researchers studying models with a borrowing constraint tied to an asset price.
The challenge can be solved by noticing the exact boundary condition of the initial problem:
the boundary of the feasible region is such that consumption (more precisely, the GHH consumption-labor bundle) is zero.
Therefore, if we transform the state space to consumption and capital, then the feasible region will be a simple rectangle.</p>
<p>Define the GHH consumption-labor bundle as</p>
<div class="math notranslate nohighlight">
\[\tilde{c}_t \equiv c_t-N(L_t).\]</div>
<p>With such state transformation, we write down the minimum recursive system that represents the equilibrium. A recursive equilibrium is functions <span class="math notranslate nohighlight">\(k'(z,\tilde{c},k)\)</span>,
<span class="math notranslate nohighlight">\(b'(z,\tilde{c},k)\)</span>, <span class="math notranslate nohighlight">\(L(z,\tilde{c},k)\)</span>, <span class="math notranslate nohighlight">\(v(z,\tilde{c},k)\)</span>,
<span class="math notranslate nohighlight">\(\mu(z,\tilde{c},k)\)</span>, <span class="math notranslate nohighlight">\(\tilde{c}'(z';z,\tilde{c},k)\)</span> such that (omitting the dependence on <span class="math notranslate nohighlight">\((z,\tilde{c},k)\)</span> when there is no confusion)</p>
<div class="math notranslate nohighlight">
\[\begin{split}&amp; -q^b\lambda+\mu q^b+\beta \mathbb{E} [\lambda'(z',\tilde{c}'(z'),k')|z]=0
\\
&amp; \beta \mathbb{E}[ \lambda'(z',\tilde{c}'(z'),k')\{d'(z',\tilde{c}'(z'),k')+q'(z',\tilde{c}'(z'),k')\}|z ]- \lambda q +\mu \kappa q=0
\\
&amp; AF_2(k,L,v)=w (1+\phi(R-1)+\frac{\mu}{\lambda} \phi R)
\\
&amp; AF_3(k,L,v)=p(1+\phi(R-1)+\frac{\mu}{\lambda} \phi R)
\\
&amp; (1+\tau)\tilde{c}'(z')=B'(z',\tilde{c}'(z'),k') +b', \forall z'\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\lambda,w,q,\lambda'\)</span> are intermediate variables and can be evaluated according to</p>
<div class="math notranslate nohighlight">
\[\begin{split}&amp; \lambda = u'(\tilde{c})
\\
&amp; w= N'(L)
\\
&amp; q=1+a\frac{k'-k}{k}
\\
&amp; \lambda'= u'(\tilde{c}'(z'))\end{split}\]</div>
<p>The last equation <span class="math notranslate nohighlight">\((1+\tau)\tilde{c}'(z')=B'(z',\tilde{c}'(z'),k')  +  b'\)</span> specifies the consistency equation for <span class="math notranslate nohighlight">\(\tilde{c}_{t+1}\)</span>, which is simply the period-<span class="math notranslate nohighlight">\((t+1)\)</span> budget constraint:</p>
<div class="math notranslate nohighlight">
\[(1+\tau)\underbrace{[c_{t+1}-N(L_{t+1})]}_{\tilde{c}_{t+1}}=B_{t+1} + b_t,\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\begin{split}B_{t+1}&amp;=&amp;A_{t+1} F\left(k_{t+1}, L_{t+1}, v_{t+1}\right)-p_{t+1} v_{t+1}-\phi\left(R_{t+1}-1\right)\left(w_{t+1} L_{t+1}+p_{t+1} v_{t+1}\right)\\
&amp;&amp;-q_{t+1}^{b} b_{t+2}-i_{t+1}-(1+\tau)N(L_{t+1}).\end{split}\]</div>
<p>Notice, how the budget constraint is decreased by <span class="math notranslate nohighlight">\((1+\tau)N(L_{t+1})\)</span> so that this becomes a consistency equation for <span class="math notranslate nohighlight">\(\tilde{c}_{t+1}\)</span>.</p>
<p>The recursive system is solved by taking <span class="math notranslate nohighlight">\(d'(z,\tilde{c},k),q'(z,\tilde{c},k),B'(z,\tilde{c},k)\)</span> as known at each time iteration step, and updating
these objects following their definitions.</p>
</div>
<div class="section" id="the-gmod-file">
<h2>The gmod File<a class="headerlink" href="#the-gmod-file" title="Permalink to this headline">¶</a></h2>
<p>We use the exact specification and parameterization as in <a class="reference external" href="https://www.aeaweb.org/articles?id=10.1257/aer.100.5.1941">Mendoza (2010)</a>.
In particular, for preference</p>
<div class="math notranslate nohighlight">
\[u(c) = \frac{c^{1-\sigma}}{1-\sigma}\]</div>
<div class="math notranslate nohighlight">
\[N(L) = L^{\omega}/\omega.\]</div>
<p>The production function is Cobb-Douglas:</p>
<div class="math notranslate nohighlight">
\[F(k,L,v) = k^{\gamma}L^{\alpha}v^{\eta}.\]</div>
<p>For parameters, see the gmod file (<a class="reference download internal" download="" href="../../_downloads/da077dc7a91bfeadd9071cd2d6eced6b/mendoza2010.gmod"><code class="xref download docutils literal notranslate"><span class="pre">mendoza2010</span></code></a>) listed below</p>
<div class="highlight-GDSGE notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">% Parameters</span>
<span class="k">parameters</span> gamma sigma omega beta alpha eta delta a phi kappa tau;
<span class="k">parameters</span> flow_scale;

beta    = 0.92;     <span class="c">% Discount factor</span>
sigma   = 2;        <span class="c">% CRRA</span>
omega   = 1.846;    <span class="c">% Labor elasticity</span>
gamma   = 0.306;    <span class="c">% Capital share</span>
alpha   = 0.592;    <span class="c">% Labor share</span>
eta     = 0.102;    <span class="c">% Intermediate share</span>
delta   = 0.088;    <span class="c">% Depreciation rate</span>
a       = 2.75;     <span class="c">% Capital adjustment cost</span>
phi     = 0.26;     <span class="c">% Working capital exernal finance share</span>
kappa   = 0.2;      <span class="c">% Tightness of collateral constraint</span>
tau     = 0.17;     <span class="c">% Consumption tax</span>

flow_scale = 1e4;   <span class="c">% Budget normalization factor</span>

<span class="c">% Toolbox options</span>
PrintFreq = 10; 
SaveFreq = 100;
SIMU_RESOLVE=0; SIMU_INTERP=1; <span class="c">% Use interp for fast simulation</span>

<span class="c">% Shocks</span>
<span class="k">var_shock</span> A R p;
<span class="k">shock_num</span> = 8;
<span class="c">% Markov process of shocks (from Mendoza AER (2010):</span>
<span class="c">% Transition probability matrix</span>
<span class="k">shock_trans</span> =  [0.51363285,	0.16145114,	0.07773228,	0.02443373,	0.16145114,	0.03201937,	0.02443373,	0.00484575;...
                0.03201937,	0.64306463,	0.00484575,	0.09732026,	0.16145114,	0.03201937,	0.02443373,	0.00484575;...
                0.07773228,	0.02443373,	0.51363285,	0.16145114,	0.02443373,	0.00484575,	0.16145114,	0.03201937;...
                0.00484575,	0.09732026,	0.03201937,	0.64306463,	0.02443373,	0.00484575,	0.16145114,	0.03201937;...
                0.03201937,	0.16145114,	0.00484575,	0.02443373,	0.64306463,	0.03201937,	0.09732026,	0.00484575;...
                0.03201937,	0.16145114,	0.00484575,	0.02443373,	0.16145114,	0.51363285,	0.02443373,	0.07773228;...
                0.00484575,	0.02443373,	0.03201937,	0.16145114,	0.09732026,	0.00484575,	0.64306463,	0.03201937;...
                0.00484575,	0.02443373,	0.03201937,	0.16145114,	0.02443373,	0.07773228,	0.16145114,	0.51363285];
<span class="c">% Values of the stochastic process</span>
AMean = 7 <span class="c">% Scale to match average output with SCU preference in Mendoza (2010)</span>
A = AMean*[0.986595988257; 1.013404011625; 0.986595988257; 1.013404011625; 0.986595988257; 1.013404011625; 0.986595988257; 1.013404011625];
R = [1.064449652804; 1.064449652804; 1.064449652804; 1.064449652804; 1.106970405389; 1.106970405389; 1.106970405389; 1.106970405389];
p = [0.993455002946; 0.993455002946; 1.062225686321; 1.062225686321; 0.993455002946; 0.993455002946; 1.062225686321; 1.062225686321];

<span class="c">% State</span>
<span class="k">var_state</span> cTilde k;

cTilde_min = 100;
cTilde_max = 300;
cTilde_shift = 10;
cTilde_pts = 30;
cTilde = linspace(cTilde_min,cTilde_max,cTilde_pts);

k_min = 600;
k_max = 900;
k_shift = 10;
k_pts = 30;
k = linspace(k_min,k_max,k_pts);

<span class="c">% Initial period</span>
<span class="k">var_policy</span>_init L v;
<span class="k">inbound</span>_init L 0 1000;
<span class="k">inbound</span>_init v 0 1000;

<span class="k">var_aux</span>_init flow q d;

<span class="k">model_init;</span>
  <span class="c">% Some trivial equations</span>
  w = L^(omega-1)*(1+tau);
  Y = A* k^gamma * L^alpha * v^eta;
  F_1 = gamma*Y/k;
  F_2 = alpha*Y/L;
  F_3 = eta*Y/v;
  
  NL = L^omega/omega;
  flow = Y - p*v - phi*(R-1)*(w*L+p*v) - NL*(1+tau);
  
  lambda = cTilde^(-sigma);
  q = 1;
  d = F_1-delta;
  
  <span class="k">equations;</span>
    F_2 - w*(1+phi*(R-1));
    F_3 - p*(1+phi*(R-1));
  <span class="k">end;</span>
<span class="k">end;</span>

<span class="c">% Interpolation</span>
<span class="k">var_interp</span> flow_interp q_plus_d_interp;
<span class="c">% Initial</span>
<span class="k">initial</span> flow_interp flow/flow_scale;
<span class="k">initial</span> q_plus_d_interp q + d;
<span class="c">% Transition</span>
flow_interp = flow/flow_scale;
q_plus_d_interp = q + d;

<span class="c">% Policy</span>
ADAPTIVE_FACTOR = 1.5;
<span class="k">var_policy</span> L v mu nbNext kNext cTildeNext[8];
inbound L 0 1000 <span class="k">adaptive</span>(ADAPTIVE_FACTOR);
inbound v 0 1000 <span class="k">adaptive</span>(ADAPTIVE_FACTOR);
<span class="k">inbound</span> mu 0 1;
inbound nbNext 0 2000 <span class="k">adaptive</span>(ADAPTIVE_FACTOR);
inbound kNext 0 1000 <span class="k">adaptive</span>(ADAPTIVE_FACTOR);
inbound cTildeNext 0.0 500 <span class="k">adaptive</span>(ADAPTIVE_FACTOR);

<span class="c">% Extra variables returned</span>
<span class="k">var_aux</span> lambda flow q d c Y bNext b inv nx gdp b_gdp nx_gdp lev wkcptl;
<span class="k">var_output</span> c Y cTildeNext q mu inv kNext bNext b v nx gdp b_gdp nx_gdp lev wkcptl;

<span class="k">model;</span>
  <span class="c">% Output and marginal product</span>
  Y = A* k^gamma * L^alpha * v^eta;
  F_1 = gamma*Y/k;
  F_2 = alpha*Y/L;
  F_3 = eta*Y/v;
  w = L^(omega-1)*(1+tau);
  
  <span class="c">% Some calculations</span>
  lambda = cTilde^(-sigma)/(1+tau);
  inv = kNext - k*(1-delta) + a/2*(kNext-k)^2/k;
  q = 1+a*(kNext-k)/k;
  d = F_1 - delta + a/2*(kNext-k)^2/(k^2);
  qb = 1/R;
  
  <span class="c">% Transform back bNext</span>
  bNext = (nbNext + phi*R*(w*L+p*v) - kappa*q*kNext)/qb;
  
  <span class="c">% Interpolation</span>
  [flow_future&#39;,q_plus_d_future&#39;] = <span class="k">GDSGE_INTERP_VEC&#39;</span>(cTildeNext&#39;,kNext);
  flow_future&#39; = flow_future&#39;*flow_scale;

  <span class="c">% some named equations</span>
  lambda_future&#39; = cTildeNext&#39;^(-sigma)/(1+tau);
  euler_bond_residual = -1 + mu + beta*<span class="k">GDSGE_EXPECT</span>{lambda_future&#39;}/(qb*lambda);
  euler_capital_residual = -1 + kappa*mu + beta*<span class="k">GDSGE_EXPECT</span>{lambda_future&#39;*q_plus_d_future&#39;}/(q*lambda);
  <span class="c">% consistency equation</span>
  cTilde_consis&#39; = flow_future&#39; + bNext - cTildeNext&#39;*(1+tau);
  
  <span class="c">% Extra variables returned</span>
  NL = L^omega/omega;
  flow = Y - p*v - phi*(R-1)*(w*L+p*v) - qb*bNext - inv - NL*(1+tau);
  c = cTilde + NL;
  b = cTilde*(1+tau) - flow;
  gdp = Y-p*v;
  b_gdp = b / gdp;
  nx = qb*bNext - b + phi*(R-1)*(w*L+p*v);
  nx_gdp = nx / gdp;
  lev = (qb*bNext-phi*R*(w*L+p*v)) / (q*kNext);
  wkcptl = phi*(w*L+p*v);
  
  <span class="k">equations;</span>
    euler_bond_residual;
    nbNext*mu;
    euler_capital_residual;
    F_2 - w*(1+phi*(R-1)+mu*phi*R);
    F_3 - p*(1+phi*(R-1)+mu*phi*R);
    cTilde_consis&#39;;
  <span class="k">end;</span>
<span class="k">end;</span>

<span class="k">simulate;</span>
  <span class="k">num_periods</span> = 50000;
  <span class="k">num_samples</span> = 24;
  <span class="k">initial</span> cTilde 200;
  <span class="k">initial</span> k 800;
  initial shock ceil(<span class="k">shock_num</span>/2);
  
  <span class="k">var_simu</span> c Y q inv b mu bNext v nx gdp b_gdp nx_gdp lev wkcptl;
  cTilde&#39; = cTildeNext&#39;;
  k&#39; = kNext;
<span class="k">end;</span>
</pre></div>
</td></tr></table></div>
<p>Most of the gmod codes are straightforward and should be self-explanatory. We do want to highlight that the state transformation and implicit state transition
are implemented by including <span class="math notranslate nohighlight">\(\tilde{c}'(z')\)</span> as unknowns in Line 97</p>
<div class="highlight-GDSGE notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>97</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">var_policy</span> L v mu nbNext kNext cTildeNext[8];
</pre></div>
</td></tr></table></div>
<p>defining the consistency equations in Line 136</p>
<div class="highlight-GDSGE notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>136</pre></div></td><td class="code"><div class="highlight"><pre><span></span>  cTilde_consis&#39; = flow_future&#39; + bNext - cTildeNext&#39;*(1+tau);
</pre></div>
</td></tr></table></div>
<p>and including them in the system of equations in Line 156</p>
<div class="highlight-GDSGE notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>156</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    cTilde_consis&#39;;
</pre></div>
</td></tr></table></div>
<p>We also discuss the necessary transformation when solving the system of equations with potentially non-box constraints
(i.e., the collateral constraint which specifies that borrowing cannot exceed a fraction of the value of capital that depends on the endogenous capital price).
This should be familiar if readers already came from the <a class="reference internal" href="../Bianchi2011/Bianchi2011.html#bianchi2011"><span class="std std-ref">Bianchi (2011)</span></a> or <a class="reference internal" href="../HL1996/HL1996.html#hl1996"><span class="std std-ref">Heaton and Lucas (1996)</span></a> examples.
This is done by defining a variable and including it as unknown</p>
<div class="math notranslate nohighlight">
\[nb_{t+1}=q_{t}^{b} b_{t+1}-\phi R_{t}\left(w_{t} L_{t}+p_{t} v_{t}\right) +\kappa q_{t} k_{t+1}\]</div>
<p>so the collateral constraint becomes <span class="math notranslate nohighlight">\(nb_{t+1} \geq 0\)</span>. And transform <span class="math notranslate nohighlight">\(nb_{t+1}\)</span> back to <span class="math notranslate nohighlight">\(b_{t+1}\)</span> in Line</p>
<div class="highlight-GDSGE notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>125</pre></div></td><td class="code"><div class="highlight"><pre><span></span>  bNext = (nbNext + phi*R*(w*L+p*v) - kappa*q*kNext)/qb;
</pre></div>
</td></tr></table></div>
<p>Another transformation to ensure numerical stability is to normalize each of the equations in the system so they take value in similar scales
(the equation solver handles this automatically to some extent but researchers can do better with prior information).
For example, the Euler equation for bond is written as</p>
<div class="math notranslate nohighlight">
\[-1 +\mu_t / \lambda_t +\beta \mathbb{E}_t \lambda_{t+1} / (\lambda_t q_t^b) = 0\]</div>
<p>so the equation takes value between [0,1]. Accordingly, we have defined the multiplier for the collateral constraint to be normalized by the marginal utility
<span class="math notranslate nohighlight">\(\hat{\mu}_t=\mu_t/\lambda_t\)</span> (<span class="math notranslate nohighlight">\(\mu\)</span> in the code actually corresponds to
<span class="math notranslate nohighlight">\(\hat{\mu}\)</span>), so from the bond Euler equation we know <span class="math notranslate nohighlight">\(\hat{\mu}\)</span> must lie in [0,1], which is specified as the bound for <span class="math notranslate nohighlight">\(\mu\)</span> entering the equation solver.
These procedures are not necessary but are simple and effective ways to solve the system faster and more accurately.</p>
<p>Now let’s run the policy iterations by calling <em>iter_mendoza2010.m</em> returned from a local or remote GDSGE compiler, which produces output</p>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">IterRslt</span> <span class="p">=</span> <span class="n">iter_mendoza2010</span><span class="p">;</span>

<span class="n">Iter</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="n">Metric</span><span class="p">:</span><span class="mf">0.00819545</span><span class="p">,</span> <span class="n">maxF</span><span class="p">:</span><span class="mf">3.83276e-09</span>
<span class="n">Elapsed </span><span class="s">time is 5.885684 seconds.</span><span class="p"></span>
<span class="n">Iter</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="n">Metric</span><span class="p">:</span><span class="mf">0.00329338</span><span class="p">,</span> <span class="n">maxF</span><span class="p">:</span><span class="mf">1.72695e-09</span>
<span class="n">Elapsed </span><span class="s">time is 2.855950 seconds.</span><span class="p"></span>
<span class="n">Iter</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span> <span class="n">Metric</span><span class="p">:</span><span class="mf">0.00139174</span><span class="p">,</span> <span class="n">maxF</span><span class="p">:</span><span class="mf">1.72276e-09</span>
<span class="n">Elapsed </span><span class="s">time is 2.474352 seconds.</span><span class="p"></span>

<span class="c">...</span>

<span class="n">Iter</span><span class="p">:</span><span class="mi">117</span><span class="p">,</span> <span class="n">Metric</span><span class="p">:</span><span class="mf">9.38205e-07</span><span class="p">,</span> <span class="n">maxF</span><span class="p">:</span><span class="mf">1.53505e-09</span>
<span class="n">Elapsed </span><span class="s">time is 1.252342 seconds.</span><span class="p"></span>
</pre></div>
</div>
<p>Notice so far, relatively crude grids for the state space are specified in the gmod file.
We can refine the solution on finer grids starting from a previously converged solutions, by simply
specifying the converged solution as a <em>WarmUp</em>. Here we enlarge the state space to have 80 grid points along both <span class="math notranslate nohighlight">\(\tilde{c}\)</span> and <span class="math notranslate nohighlight">\(k\)</span> space,
increasing the number of (exogenous and endogenous) states
to <span class="math notranslate nohighlight">\(8\times 80\times 80 = 51200\)</span>.</p>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">options</span> <span class="p">=</span> <span class="n">struct</span><span class="p">;</span>
<span class="n">cTilde_pts_fine</span> <span class="p">=</span> <span class="mi">80</span><span class="p">;</span>
<span class="n">options</span><span class="p">.</span><span class="n">cTilde</span> <span class="p">=</span> <span class="nb">linspace</span><span class="p">(</span><span class="n">IterRslt</span><span class="p">.</span><span class="n">var_state</span><span class="p">.</span><span class="n">cTilde</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">IterRslt</span><span class="p">.</span><span class="n">var_state</span><span class="p">.</span><span class="n">cTilde</span><span class="p">(</span><span class="k">end</span><span class="p">),</span><span class="c">...</span>
    <span class="n">cTilde_pts_fine</span><span class="p">);</span>
<span class="n">k_pts_fine</span> <span class="p">=</span> <span class="mi">80</span><span class="p">;</span>
<span class="n">options</span><span class="p">.</span><span class="n">k</span> <span class="p">=</span> <span class="nb">linspace</span><span class="p">(</span><span class="n">IterRslt</span><span class="p">.</span><span class="n">var_state</span><span class="p">.</span><span class="n">k</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">IterRslt</span><span class="p">.</span><span class="n">var_state</span><span class="p">.</span><span class="n">k</span><span class="p">(</span><span class="k">end</span><span class="p">),</span><span class="n">k_pts_fine</span><span class="p">);</span>
<span class="n">options</span><span class="p">.</span><span class="n">WarmUp</span> <span class="p">=</span> <span class="n">IterRslt</span><span class="p">;</span>
<span class="n">IterRslt</span> <span class="p">=</span> <span class="n">iter_mendoza2010</span><span class="p">(</span><span class="n">options</span><span class="p">);</span>

<span class="n">Iter</span><span class="p">:</span><span class="mi">120</span><span class="p">,</span> <span class="n">Metric</span><span class="p">:</span><span class="mf">0.0018683</span><span class="p">,</span> <span class="n">maxF</span><span class="p">:</span><span class="mf">8.3636e-09</span>
<span class="n">Elapsed </span><span class="s">time is 6.149458 seconds.</span><span class="p"></span>
<span class="n">Iter</span><span class="p">:</span><span class="mi">130</span><span class="p">,</span> <span class="n">Metric</span><span class="p">:</span><span class="mf">6.52679e-05</span><span class="p">,</span> <span class="n">maxF</span><span class="p">:</span><span class="mf">8.48362e-09</span>
<span class="n">Elapsed </span><span class="s">time is 16.472054 seconds.</span><span class="p"></span>
<span class="n">Iter</span><span class="p">:</span><span class="mi">140</span><span class="p">,</span> <span class="n">Metric</span><span class="p">:</span><span class="mf">1.57918e-05</span><span class="p">,</span> <span class="n">maxF</span><span class="p">:</span><span class="mf">8.50322e-09</span>
<span class="n">Elapsed </span><span class="s">time is 13.596291 seconds.</span><span class="p"></span>
<span class="n">Iter</span><span class="p">:</span><span class="mi">150</span><span class="p">,</span> <span class="n">Metric</span><span class="p">:</span><span class="mf">4.02934e-06</span><span class="p">,</span> <span class="n">maxF</span><span class="p">:</span><span class="mf">8.41073e-09</span>
<span class="n">Elapsed </span><span class="s">time is 12.792310 seconds.</span><span class="p"></span>
<span class="n">Iter</span><span class="p">:</span><span class="mi">160</span><span class="p">,</span> <span class="n">Metric</span><span class="p">:</span><span class="mf">1.08769e-06</span><span class="p">,</span> <span class="n">maxF</span><span class="p">:</span><span class="mf">7.73757e-09</span>
<span class="n">Elapsed </span><span class="s">time is 11.707143 seconds.</span><span class="p"></span>
<span class="n">Iter</span><span class="p">:</span><span class="mi">161</span><span class="p">,</span> <span class="n">Metric</span><span class="p">:</span><span class="mf">9.56593e-07</span><span class="p">,</span> <span class="n">maxF</span><span class="p">:</span><span class="mf">7.234e-09</span>
<span class="n">Elapsed </span><span class="s">time is 1.134286 seconds.</span><span class="p"></span>
</pre></div>
</div>
<p>The refined iterations continue to converge in another minute. It’s always a good convention to start with some cruder grid to assess the properties
(such as the range of the ergodic set)
of the solution of a model,
and refine it using the crude solution as a WarmUp.</p>
<p>Now we inspect the policy functions. We first come back to our motivation for state space transformation: the feasible region in the natural state space
<span class="math notranslate nohighlight">\((k,b)\)</span> is non-rectangle. This can be verified by projecting the state variable <span class="math notranslate nohighlight">\(\tilde{c}\)</span> onto policy <span class="math notranslate nohighlight">\(b\)</span> and state variable <span class="math notranslate nohighlight">\(k\)</span>.</p>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">figure</span><span class="p">;</span>
<span class="p">[</span><span class="n">cTilde_mesh</span><span class="p">,</span><span class="n">k_mesh</span><span class="p">]</span> <span class="p">=</span> <span class="nb">ndgrid</span><span class="p">(</span><span class="n">IterRslt</span><span class="p">.</span><span class="n">var_state</span><span class="p">.</span><span class="n">cTilde</span><span class="p">,</span><span class="n">IterRslt</span><span class="p">.</span><span class="n">var_state</span><span class="p">.</span><span class="n">k</span><span class="p">);</span>
<span class="n">surf</span><span class="p">(</span><span class="nb">squeeze</span><span class="p">(</span><span class="n">IterRslt</span><span class="p">.</span><span class="n">var_aux</span><span class="p">.</span><span class="n">b</span><span class="p">(</span><span class="mi">1</span><span class="p">,:,:)),</span><span class="n">k_mesh</span><span class="p">,</span><span class="n">cTilde_mesh</span><span class="p">);</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">);</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;k&#39;</span><span class="p">);</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;Feasible Region of Shock Index 1&#39;</span><span class="p">);</span>
<span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mf">0.06</span><span class="p">,</span><span class="mi">90</span><span class="p">);</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/policy_cTilde_feasible.png"><img alt="../../_images/policy_cTilde_feasible.png" src="../../_images/policy_cTilde_feasible.png" style="width: 525.0px; height: 393.59999999999997px;" /></a>
<p>As shown in the figure, the level of bond that gives a same lower bound of consumption (here <span class="math notranslate nohighlight">\(\tilde{c}\)</span> equal to 100) is declining in capital, suggesting that a higher capital allows
the current debt to be higher. However, determining this lower bound of bond level is difficult; but determining the boundary condition for consumption is much easier
(<span class="math notranslate nohighlight">\(\tilde{c}=0\)</span>).</p>
<p>We can inspect the policy functions by projecting them to the natural state space as well. For example, the capital price:</p>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">figure</span><span class="p">;</span>
<span class="p">[</span><span class="n">cTilde_mesh</span><span class="p">,</span><span class="n">k_mesh</span><span class="p">]</span> <span class="p">=</span> <span class="nb">ndgrid</span><span class="p">(</span><span class="n">IterRslt</span><span class="p">.</span><span class="n">var_state</span><span class="p">.</span><span class="n">cTilde</span><span class="p">,</span><span class="n">IterRslt</span><span class="p">.</span><span class="n">var_state</span><span class="p">.</span><span class="n">k</span><span class="p">);</span>
<span class="n">surf</span><span class="p">(</span><span class="nb">squeeze</span><span class="p">(</span><span class="n">IterRslt</span><span class="p">.</span><span class="n">var_aux</span><span class="p">.</span><span class="n">b</span><span class="p">(</span><span class="mi">1</span><span class="p">,:,:)),</span><span class="n">k_mesh</span><span class="p">,</span><span class="nb">squeeze</span><span class="p">(</span><span class="n">IterRslt</span><span class="p">.</span><span class="n">var_aux</span><span class="p">.</span><span class="n">q</span><span class="p">(</span><span class="mi">1</span><span class="p">,:,:)));</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">);</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;k&#39;</span><span class="p">);</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;Capital Price, Shock Index 1&#39;</span><span class="p">);</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/policy_q.png"><img alt="../../_images/policy_q.png" src="../../_images/policy_q.png" style="width: 525.0px; height: 393.59999999999997px;" /></a>
<p>And the multiplier (normalized by marginal utility) for collateral constraint:</p>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">figure</span><span class="p">;</span>
<span class="p">[</span><span class="n">cTilde_mesh</span><span class="p">,</span><span class="n">k_mesh</span><span class="p">]</span> <span class="p">=</span> <span class="nb">ndgrid</span><span class="p">(</span><span class="n">IterRslt</span><span class="p">.</span><span class="n">var_state</span><span class="p">.</span><span class="n">cTilde</span><span class="p">,</span><span class="n">IterRslt</span><span class="p">.</span><span class="n">var_state</span><span class="p">.</span><span class="n">k</span><span class="p">);</span>
<span class="n">surf</span><span class="p">(</span><span class="nb">squeeze</span><span class="p">(</span><span class="n">IterRslt</span><span class="p">.</span><span class="n">var_aux</span><span class="p">.</span><span class="n">b</span><span class="p">(</span><span class="mi">1</span><span class="p">,:,:)),</span><span class="n">k_mesh</span><span class="p">,</span><span class="nb">squeeze</span><span class="p">(</span><span class="n">IterRslt</span><span class="p">.</span><span class="n">var_policy</span><span class="p">.</span><span class="n">mu</span><span class="p">(</span><span class="mi">1</span><span class="p">,:,:)));</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">);</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;k&#39;</span><span class="p">);</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;Multiplier for the Collateral Constraint, Shock Index 1&#39;</span><span class="p">);</span>
<span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">16</span><span class="p">,</span><span class="mi">26</span><span class="p">);</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/policy_mu.png"><img alt="../../_images/policy_mu.png" src="../../_images/policy_mu.png" style="width: 525.0px; height: 393.59999999999997px;" /></a>
<p>These two policy functions show that the collateral constraint tends to bind
when bond is low (borrowing is high).
And capital price falls rapidly in borrowing when the collateral constraint binds.</p>
<p>With the converged policy and state transition functions, we can simulate the economy’s ergodic set.
To remind readers, here we directly interpolate the state transition and policy functions to simulate, which is faster
than resolving the system (the simulation with
24 paths of 50,000 periods completes in less than half a minute on a regular laptop). This is done by specifying in the gmod file</p>
<div class="highlight-GDSGE notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>22</pre></div></td><td class="code"><div class="highlight"><pre><span></span>SIMU_RESOLVE=0; SIMU_INTERP=1; <span class="c">% Use interp for fast simulation</span>
</pre></div>
</td></tr></table></div>
<p>In this case, the variables to be recorded in the simulation need to be explicitly specified in <em>var_output</em></p>
<div class="highlight-GDSGE notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>107</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">var_output</span> c Y cTildeNext q mu inv kNext bNext b v nx gdp b_gdp nx_gdp lev wkcptl;
</pre></div>
</td></tr></table></div>
<p>and can then be included in <em>var_simu</em></p>
<div class="highlight-GDSGE notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>167</pre></div></td><td class="code"><div class="highlight"><pre><span></span>  <span class="k">var_simu</span> c Y q inv b mu bNext v nx gdp b_gdp nx_gdp lev wkcptl;
</pre></div>
</td></tr></table></div>
<p>With implicit state transition functions for <span class="math notranslate nohighlight">\(\tilde{c}\)</span> solved as part of the policy functions,
the transitions need to be specified in the simulate block</p>
<div class="highlight-GDSGE notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>168</pre></div></td><td class="code"><div class="highlight"><pre><span></span>  cTilde&#39; = cTildeNext&#39;;
</pre></div>
</td></tr></table></div>
<p>which means that the next period <em>cTilde</em> should pick policy <em>cTildeNext</em> at a sampled exogenous shock index.</p>
<p>Calling simulate_mnendoza2010 produces the following</p>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">SimuRslt</span> <span class="p">=</span> <span class="n">simulate_mendoza2010</span><span class="p">(</span><span class="n">IterRslt</span><span class="p">);</span>

<span class="n">Periods</span><span class="p">:</span> <span class="mi">1000</span>
<span class="n">shock  </span><span class="s">cTilde       k       c       Y       q     inv       b   bNext       v      nx     gdp   b_gdp  nx_gdp     lev  wkcptl</span><span class="p"></span>
<span class="n">    1   </span><span class="s">166.9   747.1   282.5     429   1.048   78.98   109.7   86.46   43.32  -23.58   385.9  0.2843 -0.06110.0002417   76.13</span><span class="p"></span>

<span class="c">...</span>

<span class="n">Periods</span><span class="p">:</span> <span class="mi">50000</span>
<span class="n">shock  </span><span class="s">cTilde       k       c       Y       q     inv       b   bNext       v      nx     gdp   b_gdp  nx_gdp     lev  wkcptl</span><span class="p"></span>
<span class="n">    5   </span><span class="s">149.8   741.1   262.8   423.8  0.9844   61.04  -33.48  -31.26   42.34   13.19   381.7-0.08769 0.03455 -0.1525    74.4</span><span class="p"></span>
</pre></div>
</div>
<p>We can inspect the histogram of the natural state variables <span class="math notranslate nohighlight">\((k,b)\)</span> by calling in MATLAB:</p>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">figure</span><span class="p">;</span>
<span class="n">hist3</span><span class="p">([</span><span class="n">SimuRslt</span><span class="p">.</span><span class="n">b</span><span class="p">(:),</span><span class="nb">reshape</span><span class="p">(</span><span class="n">SimuRslt</span><span class="p">.</span><span class="n">k</span><span class="p">(:,</span><span class="mi">1</span><span class="p">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">),[],</span><span class="mi">1</span><span class="p">)],[</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">],</span><span class="s">&#39;CDataMode&#39;</span><span class="p">,</span><span class="s">&#39;auto&#39;</span><span class="p">,</span><span class="s">&#39;FaceColor&#39;</span><span class="p">,</span><span class="s">&#39;interp&#39;</span><span class="p">);</span>
<span class="n">view</span><span class="p">([</span><span class="mi">15</span><span class="p">,</span><span class="mi">30</span><span class="p">]);</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Bond&#39;</span><span class="p">);</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Capital&#39;</span><span class="p">);</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;Histogram of Capital and Bond&#39;</span><span class="p">);</span>
<span class="n">print</span><span class="p">(</span><span class="s">&#39;figures/histogram_b_k.png&#39;</span><span class="p">);</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/histogram_b_k.png"><img alt="../../_images/histogram_b_k.png" src="../../_images/histogram_b_k.png" style="width: 525.0px; height: 393.59999999999997px;" /></a>
<p>We are interested in the fraction of time that the economy spends in a crisis, i.e., states with binding collateral constraint:</p>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">muGreaterThanZero</span> <span class="p">=</span> <span class="n">SimuRslt</span><span class="p">.</span><span class="n">mu</span> <span class="o">&gt;</span> <span class="mf">1e-7</span><span class="p">;</span>
<span class="n">fractionCrisis</span> <span class="p">=</span> <span class="n">sum</span><span class="p">(</span><span class="n">muGreaterThanZero</span><span class="p">(:))</span> <span class="o">/</span> <span class="nb">numel</span><span class="p">(</span><span class="n">muGreaterThanZero</span><span class="p">(:));</span>
<span class="n">fprintf</span><span class="p">(</span><span class="s">&#39;The fraction in crisis: %g\n&#39;</span><span class="p">,</span><span class="n">fractionCrisis</span><span class="p">);</span><span class="n"></span>
<span class="n">The </span><span class="s">fraction in crisis: 0.131997</span><span class="p"></span>
</pre></div>
</div>
<p>We can calculate the unconditional moments:</p>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">statsList</span> <span class="p">=</span> <span class="p">{</span><span class="s">&#39;mean&#39;</span><span class="p">,</span><span class="s">&#39;std&#39;</span><span class="p">};</span>
<span class="n">varList</span> <span class="p">=</span> <span class="p">{</span><span class="s">&#39;gdp&#39;</span><span class="p">,</span><span class="s">&#39;c&#39;</span><span class="p">,</span><span class="s">&#39;inv&#39;</span><span class="p">,</span><span class="s">&#39;nx_gdp&#39;</span><span class="p">,</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="s">&#39;b_gdp&#39;</span><span class="p">,</span><span class="s">&#39;q&#39;</span><span class="p">,</span><span class="s">&#39;lev&#39;</span><span class="p">,</span><span class="s">&#39;v&#39;</span><span class="p">,</span><span class="s">&#39;wkcptl&#39;</span><span class="p">};</span>
<span class="n">ratioList</span> <span class="p">=</span> <span class="p">{</span><span class="s">&#39;nx_gdp&#39;</span><span class="p">,</span><span class="s">&#39;b_gdp&#39;</span><span class="p">,</span><span class="s">&#39;lev&#39;</span><span class="p">};</span>
<span class="n">meanStats</span> <span class="p">=</span> <span class="n">struct</span><span class="p">;</span>
<span class="n">stdStats</span> <span class="p">=</span> <span class="n">struct</span><span class="p">;</span>
<span class="n">corrStats</span> <span class="p">=</span> <span class="n">struct</span><span class="p">;</span>
<span class="n">autoCorrStats</span> <span class="p">=</span> <span class="n">struct</span><span class="p">;</span>
<span class="n">startPeriod</span> <span class="p">=</span> <span class="mi">1001</span><span class="p">;</span>
<span class="n">endPeriod</span> <span class="p">=</span> <span class="mi">50000</span><span class="p">;</span><span class="n"></span>
<span class="n">for </span><span class="s">i_var = 1:length(varList)</span><span class="p"></span>
    <span class="n">varName</span> <span class="p">=</span> <span class="n">varList</span><span class="p">{</span><span class="n">i_var</span><span class="p">};</span>
    <span class="n">meanStats</span><span class="p">.(</span><span class="n">varName</span><span class="p">)</span> <span class="p">=</span> <span class="n">mean</span><span class="p">(</span><span class="nb">reshape</span><span class="p">(</span><span class="n">SimuRslt</span><span class="p">.(</span><span class="n">varName</span><span class="p">)(:,</span><span class="n">startPeriod</span><span class="p">:</span><span class="n">endPeriod</span><span class="p">),[],</span><span class="mi">1</span><span class="p">));</span><span class="n"></span>
<span class="n">    if </span><span class="s">max(strcmp(varName,ratioList))==1</span><span class="p"></span>
        <span class="n">stdStats</span><span class="p">.(</span><span class="n">varName</span><span class="p">)</span> <span class="p">=</span> <span class="n">std</span><span class="p">(</span><span class="nb">reshape</span><span class="p">(</span><span class="n">SimuRslt</span><span class="p">.(</span><span class="n">varName</span><span class="p">)(:,</span><span class="n">startPeriod</span><span class="p">:</span><span class="n">endPeriod</span><span class="p">),[],</span><span class="mi">1</span><span class="p">));</span><span class="n"></span>
<span class="n">    else</span>
<span class="n">        </span><span class="s">stdStats.(varName) = std(reshape(SimuRslt.(varName)(:,startPeriod:endPeriod),[],1)) ...</span><span class="p"></span>
            <span class="o">/</span> <span class="n">meanStats</span><span class="p">.(</span><span class="n">varName</span><span class="p">);</span><span class="n"></span>
<span class="n">    end</span>
<span class="n">    </span><span class="s">corrStats.(varName) = corr(reshape(SimuRslt.(varName)(:,startPeriod:endPeriod),[],1), ...</span><span class="p"></span>
        <span class="nb">reshape</span><span class="p">(</span><span class="n">SimuRslt</span><span class="p">.</span><span class="n">gdp</span><span class="p">(:,</span><span class="n">startPeriod</span><span class="p">:</span><span class="n">endPeriod</span><span class="p">),[],</span><span class="mi">1</span><span class="p">));</span>
    <span class="n">autoCorrStats</span><span class="p">.(</span><span class="n">varName</span><span class="p">)</span> <span class="p">=</span> <span class="n">corr</span><span class="p">(</span><span class="nb">reshape</span><span class="p">(</span><span class="n">SimuRslt</span><span class="p">.(</span><span class="n">varName</span><span class="p">)(</span><span class="mi">1</span><span class="p">,</span><span class="n">startPeriod</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">endPeriod</span><span class="p">),[],</span><span class="mi">1</span><span class="p">),</span> <span class="c">...</span>
        <span class="nb">reshape</span><span class="p">(</span><span class="n">SimuRslt</span><span class="p">.(</span><span class="n">varName</span><span class="p">)(</span><span class="mi">1</span><span class="p">,</span><span class="n">startPeriod</span><span class="p">:</span><span class="n">endPeriod</span><span class="o">-</span><span class="mi">1</span><span class="p">),[],</span><span class="mi">1</span><span class="p">));</span><span class="n"></span>
<span class="n">end</span>
</pre></div>
</div>
<table class="docutils align-default" id="id4">
<caption><span class="caption-number">Table 1 </span><span class="caption-text">Unconditional Business Cycle Moments</span><a class="headerlink" href="#id4" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<tbody>
<tr class="row-odd"><td></td>
<td><p>GDSGE</p></td>
<td><p>Mendoza (2010), Table 3, Panel C</p></td>
</tr>
<tr class="row-even"><td><p>Mean</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>gdp</p></td>
<td><p>400.646</p></td>
<td><p>388.339</p></td>
</tr>
<tr class="row-even"><td><p>c</p></td>
<td><p>277.349</p></td>
<td><p>267.857</p></td>
</tr>
<tr class="row-odd"><td><p>inv</p></td>
<td><p>68.838</p></td>
<td><p>65.802</p></td>
</tr>
<tr class="row-even"><td><p>nx/gdp</p></td>
<td><p>0.018</p></td>
<td><p>0.024</p></td>
</tr>
<tr class="row-odd"><td><p>k</p></td>
<td><p>780.598</p></td>
<td><p>747.709</p></td>
</tr>
<tr class="row-even"><td><p>b/gdp</p></td>
<td><p>-0.031</p></td>
<td><p>-0.104</p></td>
</tr>
<tr class="row-odd"><td><p>q</p></td>
<td><p>1.000</p></td>
<td><p>1.000</p></td>
</tr>
<tr class="row-even"><td><p>leverage</p></td>
<td><p>-0.124</p></td>
<td><p>-0.159</p></td>
</tr>
<tr class="row-odd"><td><p>v</p></td>
<td><p>43.268</p></td>
<td><p>41.949</p></td>
</tr>
<tr class="row-even"><td><p>wkcptl</p></td>
<td><p>78.555</p></td>
<td><p>75.455</p></td>
</tr>
<tr class="row-odd"><td><p>Std in percent</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>gdp</p></td>
<td><p>3.88%</p></td>
<td><p>3.85</p></td>
</tr>
<tr class="row-odd"><td><p>c</p></td>
<td><p>3.68%</p></td>
<td><p>3.69</p></td>
</tr>
<tr class="row-even"><td><p>inv</p></td>
<td><p>13.30%</p></td>
<td><p>13.45</p></td>
</tr>
<tr class="row-odd"><td><p>nx/gdp</p></td>
<td><p>2.67%</p></td>
<td><p>2.58</p></td>
</tr>
<tr class="row-even"><td><p>k</p></td>
<td><p>4.32%</p></td>
<td><p>4.31</p></td>
</tr>
<tr class="row-odd"><td><p>b/gdp</p></td>
<td><p>13.97%</p></td>
<td><p>8.9</p></td>
</tr>
<tr class="row-even"><td><p>q</p></td>
<td><p>3.19%</p></td>
<td><p>3.23</p></td>
</tr>
<tr class="row-odd"><td><p>leverage</p></td>
<td><p>6.53%</p></td>
<td><p>4.07</p></td>
</tr>
<tr class="row-even"><td><p>v</p></td>
<td><p>5.85%</p></td>
<td><p>5.84</p></td>
</tr>
<tr class="row-odd"><td><p>wkcptl</p></td>
<td><p>4.30%</p></td>
<td><p>4.26</p></td>
</tr>
<tr class="row-even"><td><p>Corr w/ gdp</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>gdp</p></td>
<td><p>1.000</p></td>
<td><p>1.000</p></td>
</tr>
<tr class="row-even"><td><p>c</p></td>
<td><p>0.898</p></td>
<td><p>0.931</p></td>
</tr>
<tr class="row-odd"><td><p>inv</p></td>
<td><p>0.649</p></td>
<td><p>0.641</p></td>
</tr>
<tr class="row-even"><td><p>nx/gdp</p></td>
<td><p>-0.131</p></td>
<td><p>-0.184</p></td>
</tr>
<tr class="row-odd"><td><p>k</p></td>
<td><p>0.753</p></td>
<td><p>0.744</p></td>
</tr>
<tr class="row-even"><td><p>b/gdp</p></td>
<td><p>-0.187</p></td>
<td><p>-0.298</p></td>
</tr>
<tr class="row-odd"><td><p>q</p></td>
<td><p>0.408</p></td>
<td><p>0.406</p></td>
</tr>
<tr class="row-even"><td><p>leverage</p></td>
<td><p>-0.174</p></td>
<td><p>-0.258</p></td>
</tr>
<tr class="row-odd"><td><p>v</p></td>
<td><p>0.830</p></td>
<td><p>0.823</p></td>
</tr>
<tr class="row-even"><td><p>wkcptl</p></td>
<td><p>0.995</p></td>
<td><p>0.987</p></td>
</tr>
<tr class="row-odd"><td><p>Auto corr</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>gdp</p></td>
<td><p>0.820</p></td>
<td><p>0.815</p></td>
</tr>
<tr class="row-odd"><td><p>c</p></td>
<td><p>0.796</p></td>
<td><p>0.766</p></td>
</tr>
<tr class="row-even"><td><p>inv</p></td>
<td><p>0.506</p></td>
<td><p>0.483</p></td>
</tr>
<tr class="row-odd"><td><p>nx/gdp</p></td>
<td><p>0.514</p></td>
<td><p>0.447</p></td>
</tr>
<tr class="row-even"><td><p>k</p></td>
<td><p>0.963</p></td>
<td><p>0.963</p></td>
</tr>
<tr class="row-odd"><td><p>b/gdp</p></td>
<td><p>0.985</p></td>
<td><p>0.087</p></td>
</tr>
<tr class="row-even"><td><p>q</p></td>
<td><p>0.452</p></td>
<td><p>0.428</p></td>
</tr>
<tr class="row-odd"><td><p>leverage</p></td>
<td><p>0.990</p></td>
<td><p>0.040</p></td>
</tr>
<tr class="row-even"><td><p>v</p></td>
<td><p>0.773</p></td>
<td><p>0.764</p></td>
</tr>
<tr class="row-odd"><td><p>wkcptl</p></td>
<td><p>0.798</p></td>
<td><p>0.777</p></td>
</tr>
</tbody>
</table>
<p>Most statistics are similar to <a class="reference external" href="https://www.aeaweb.org/articles?id=10.1257/aer.100.5.1941">Mendoza (2010)</a> except that <a class="reference external" href="https://www.aeaweb.org/articles?id=10.1257/aer.100.5.1941">Mendoza (2010)</a> uses a Stationary Cardinal Utility (SCU) utility function and
solves the model by solving a quasi social planner’s problem which produces
(1) less persistent leverage and bond, and (2) higher leverage and more
negative bond/gdp ratio. These differences are also noted in <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S1094202520300028">Mendoza and Villalvazo (2020)</a>.</p>
</div>
<div class="section" id="what-s-next">
<h2>What’s Next?<a class="headerlink" href="#what-s-next" title="Permalink to this headline">¶</a></h2>
<p>This example illustrates how to solve a model with two endogenous state variables of which the feasible region may be non-rectangle and hard to determine ex-ante.
The crucial step is to transform the boundary condition to that of an endogenous state variable which makes the feasible region a simple rectangle. In the current example, the
feasible debt level is high so the model can be solved directly over the natural state space—bond and capital. Such transformation
becomes essential for more complex problems, and sometimes the boundary condition needs to be solved using a different equilibrium system. The toolbox accommodates this
by allowing a different system of equations for problems at the boundary. See <a class="reference internal" href="../CaoNie2017/CaoNie2017.html#caonie2017"><span class="std std-ref">Cao and Nie (2017)</span></a> for such an example, in which consumption is zero and the Inada condition is violated at the boundary.</p>
<p>The policy functions in the current example are highly nonlinear. We learned how to start with a crude grid and refine the solution with finer grids. A more effective approach
is to let the toolbox automatically adapt the grids to increase points in regions that are nonlinear.
The example in <a class="reference internal" href="../Bianchi2011/Bianchi2011.html#bianchi2011"><span class="std std-ref">Bianchi (2011)</span></a> shows how to use adaptive grids for a model with a single-dimension endogenous state.
The current model can also be solved with adaptive grids by simply specifying one option in the gmod file, which we leave as an exercise.</p>
<p>Or you can directly proceed to <a class="reference internal" href="../../usage/functions.html#toolbox-api"><span class="std std-ref">Toolbox API</span></a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../CaoNie2017/CaoNie2017.html" class="btn btn-neutral float-right" title="Cao and Nie (2017): Amplification and Asymmetry without Collateral Constraint" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../KS1998/KS1998.html" class="btn btn-neutral float-left" title="Krusell and Smith (1998): Heterogeneous-agent Models with Aggregate Uncertainty" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Dan Cao, Wenlan Luo, and Guangyu Nie

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>