

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Barro et al. (2017): Safe Assets with Rare Disasters &mdash; GDSGE  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Toolbox API" href="../../usage/functions.html" />
    <link rel="prev" title="Bianchi (2011): Sudden Stops in Open Economies" href="../Bianchi2011/Bianchi2011.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> GDSGE
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rbc/rbc.html">Getting Started - A Simple RBC Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rbc/rbcIrr.html">A RBC Model with Irreversible Investment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../HL1996/HL1996.html">Heaton and Lucas (1996): Incomplete Markets with Portfolio Choices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Guvenen2009/Guvenen2009.html">Guvenen (2009): Asset Pricing with Heterogeneous IES</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Bianchi2011/Bianchi2011.html">Bianchi (2011): Sudden Stops in Open Economies</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Barro et al. (2017): Safe Assets with Rare Disasters</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#the-model">The Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-gmod-file">The gmod File</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-s-next">What’s Next?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/functions.html">Toolbox API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AdditionalExamples.html">Additional Examples</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">GDSGE</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Barro et al. (2017): Safe Assets with Rare Disasters</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="barro-et-al-2017-safe-assets-with-rare-disasters">
<h1>Barro et al. (2017): Safe Assets with Rare Disasters<a class="headerlink" href="#barro-et-al-2017-safe-assets-with-rare-disasters" title="Permalink to this headline">¶</a></h1>
<p>The model studies the creation of safe assets (risk-free bonds) between two agents with different
risk aversion levels, in an endowment economy with rare disaster shocks. The model serves as an example to demonstrate how
the toolbox can accommodate general recursive preferences such as <a class="reference external" href="https://www.jstor.org/stable/1913778?seq=1#metadata_info_tab_contents">Epstein and
Zin (1989)</a> -
<a class="reference external" href="https://www.jstor.org/stable/2937817?seq=1#metadata_info_tab_contents">Weil (1990)</a>, which is a common preference specification in the asset pricing and
macro finance literature. The example also demonstrates that the solution method can handle
ill-behaved equilibrium systems robustly: in the context of <a class="reference external" href="https://www.nber.org/papers/w20652">Barro et al. (2017)</a>, when the risk aversion level is set very high
(e.g., with coefficient of relative risk aversion up to 100), the traditional
nested fixed point solution method becomes unstable, since agents’ portfolio choice becomes very sensitive to the pricing function.
Nevertheless, the toolbox, which solves the equilibrium as one single system of equations,
can handle such parameterization fairly easily and uncovers novel theoretical results.</p>
<div class="section" id="the-model">
<h2>The Model<a class="headerlink" href="#the-model" title="Permalink to this headline">¶</a></h2>
<p>There are two groups of agents, <span class="math notranslate nohighlight">\(i=1,2\)</span> in the economy. Agents have
an <a class="reference external" href="https://www.jstor.org/stable/1913778?seq=1#metadata_info_tab_contents">Epstein and
Zin (1989)</a> -
<a class="reference external" href="https://www.jstor.org/stable/2937817?seq=1#metadata_info_tab_contents">Weil (1990)</a> utility function.
The coefficients of risk aversion satisfy <span class="math notranslate nohighlight">\(\gamma_{2}\geq\gamma_{1}&gt;0\)</span>,
i.e., agent 1 is less risk-averse than agent 2. The other parameters
between these two groups are the same. There is a replacement rate
<span class="math notranslate nohighlight">\(\upsilon\)</span> at which each type of agents move to a state that has
a chance of <span class="math notranslate nohighlight">\(\mu_{i}\)</span> of switching into type <span class="math notranslate nohighlight">\(i\)</span>. Taking the potential
type shifting into consideration, their utility function can be written
as</p>
<div class="math notranslate nohighlight">
\[U_{i,t}=\left\{ \frac{\rho+\upsilon}{1+\rho}C_{i,t}^{1-\theta}+\frac{1-\upsilon}{1+\rho}\left[\mathbb{E}_{t}\left(U_{i,t+1}^{1-\gamma_{i}}\right)\right]^{\frac{1-\theta}{1-\gamma_{i}}}\right\} ^{1/\left(1-\theta\right)}.\label{eq:utility SafeAssets}\]</div>
<p>In this economy, there is a Lucas tree generating consumption good
<span class="math notranslate nohighlight">\(Y_{t}\)</span> in period <span class="math notranslate nohighlight">\(t\)</span> consumed by both agents. <span class="math notranslate nohighlight">\(Y_{t}\)</span> is subject
to identically and independently distributed rare-disaster shocks.
With probability <span class="math notranslate nohighlight">\(1-p\)</span>, <span class="math notranslate nohighlight">\(Y_{t}\)</span> grows by the factor <span class="math notranslate nohighlight">\(1+g\)</span>; with
a small probability <span class="math notranslate nohighlight">\(p\)</span>, <span class="math notranslate nohighlight">\(Y_{t}\)</span> grows by the factor <span class="math notranslate nohighlight">\(\left(1+g\right)\left(1-b\right)\)</span>.
Thus the expected growth rate of <span class="math notranslate nohighlight">\(Y_{t}\)</span> in each period is <span class="math notranslate nohighlight">\(g^{*}\approx g-pb.\)</span>
Denote agent <span class="math notranslate nohighlight">\(i\)</span>’s holding of the tree as <span class="math notranslate nohighlight">\(K_{it}\)</span>. The supply of
the Lucas tree is normalized to one, and denote its price as <span class="math notranslate nohighlight">\(P_{t}\)</span>.
The gross return of holding equity is <span class="math notranslate nohighlight">\(R_{t}^{e}=\frac{Y_{t}+P_{t}}{P_{t-1}}\)</span>.
Agents also trade a risk-free bond, <span class="math notranslate nohighlight">\(B_{it}\)</span>, whose net supply is
zero, and the gross interest rate is <span class="math notranslate nohighlight">\(R_{t}^{f}\)</span>.</p>
<p>Denote the beginning-of-period wealth of agent <span class="math notranslate nohighlight">\(i\)</span> by <span class="math notranslate nohighlight">\(A_{it}\)</span>.
Each agent’s budget constraint is</p>
<div class="math notranslate nohighlight">
\[C_{it}+P_{t}K_{it}+B_{it}=A_{it}.\]</div>
<p>Considering the type shifting shock, the law of motion of <span class="math notranslate nohighlight">\(A_{it}\)</span>
is</p>
<div class="math notranslate nohighlight">
\[A_{it}=\left(Y_{t}+P_{t}\right)\left[K_{it-1}-\upsilon\left(K_{it-1}-\mu_{i}\right)\right]+\left(1-\upsilon\right)R_{t}^{f}B_{it-1}.\]</div>
<p>As in <a class="reference external" href="https://academic.oup.com/ej/article/128/614/2258/5230957">Cao (2018, Appendix C.3, Extension 3)</a>, we can normalize the utility <span class="math notranslate nohighlight">\(U_{it}\)</span> and consumption <span class="math notranslate nohighlight">\(C_{it}\)</span> by
<span class="math notranslate nohighlight">\(A_{it}\)</span> and write recursive utility as follows:</p>
<div class="math notranslate nohighlight" id="equation-eq-normalized-utility-safeassets">
<span class="eqno">(2)<a class="headerlink" href="#equation-eq-normalized-utility-safeassets" title="Permalink to this equation">¶</a></span>\[u_{it}^{1-\theta}=\frac{\rho+\upsilon}{1+\rho}c_{i,t}^{1-\theta}+\frac{1-\upsilon}{1+\rho}\left(1-c_{it}\right)^{1-\theta}\left(\mathbb{E}_{t}\left[\left(R_{i,t+1}u_{it+1}\right)^{1-\gamma_{i}}\right]\right)^{\frac{1-\theta}{1-\gamma_{i}}},\]</div>
<p>in which <span class="math notranslate nohighlight">\(u_{it}=U_{it}/A_{it}\)</span>, <span class="math notranslate nohighlight">\(c_{it}=C_{it}/A_{it}\)</span>, and</p>
<div class="math notranslate nohighlight">
\[R_{i,t+1}=x_{it}R_{t+1}^{e}+\left(1-x_{it}\right)R_{t+1}^{f}\]</div>
<p>is the average return of agent <span class="math notranslate nohighlight">\(i\)</span>’s portfolio, and</p>
<div class="math notranslate nohighlight">
\[x_{it}=\frac{P_{t}K_{it}}{P_{t}K_{it}+B_{it}}\]</div>
<p>is the equity share of agent <span class="math notranslate nohighlight">\(i\)</span>’s portfolio holding. The FOCs for
consumption and portfolio choices are</p>
<div class="math notranslate nohighlight" id="equation-eq-euler-equation-safeassets">
<span class="eqno">(3)<a class="headerlink" href="#equation-eq-euler-equation-safeassets" title="Permalink to this equation">¶</a></span>\[\left(\rho+\upsilon\right)c_{i,t}^{-\theta}=\left(1-\upsilon\right)\left(1-c_{it}\right)^{-\theta}\left[\mathbb{E}_{t}\left(R_{i,t+1}u_{it+1}\right)^{1-\gamma_{i}}\right]^{\frac{1-\theta}{1-\gamma_{i}}},\]</div>
<p>and</p>
<div class="math notranslate nohighlight" id="equation-eq-foc-portfolio-choice">
<span class="eqno">(4)<a class="headerlink" href="#equation-eq-foc-portfolio-choice" title="Permalink to this equation">¶</a></span>\[\mathbb{E}_{t}\left[\frac{\left(R_{t+1}^{e}-R_{t+1}^{f}\right)u_{it+1}}{\left(R_{i,t+1}u_{it+1}\right)^{\gamma_{i}}}\right]=0.\]</div>
<p>The choices of <span class="math notranslate nohighlight">\(c_{it}\)</span> and <span class="math notranslate nohighlight">\(x_{it}\)</span> are identical across agents
of the same type <span class="math notranslate nohighlight">\(i\)</span>, and the portfolio choices of agent <span class="math notranslate nohighlight">\(i\)</span> are</p>
<div class="math notranslate nohighlight">
\[\begin{split}K_{it} &amp; =x_{it}\left(1-c_{it}\right)\left(1+p_{t}\right)/p_{t}\omega_{it},\\
b_{it} &amp; =\left(1-x_{it}\right)\left(1-c_{it}\right)\left(1+p_{t}\right)\omega_{it}.\end{split}\]</div>
<p>In equilibrium, prices are determined such that markets clear:</p>
<div class="math notranslate nohighlight" id="equation-eq-mc-goods">
<span class="eqno">(5)<a class="headerlink" href="#equation-eq-mc-goods" title="Permalink to this equation">¶</a></span>\[C_{1t}+C_{2t}  =Y_{t},\]</div>
<div class="math notranslate nohighlight" id="equation-eq-mc-equity">
<span class="eqno">(6)<a class="headerlink" href="#equation-eq-mc-equity" title="Permalink to this equation">¶</a></span>\[K_{1t}+K_{2t}  =1,\]</div>
<div class="math notranslate nohighlight" id="equation-eq-mc-bond">
<span class="eqno">(7)<a class="headerlink" href="#equation-eq-mc-bond" title="Permalink to this equation">¶</a></span>\[B_{1t}+B_{2t}  =0.\]</div>
<p>To achieve stationarity, we normalize <span class="math notranslate nohighlight">\(\left\{ B_{it},P_{t}\right\}\)</span> variables
by <span class="math notranslate nohighlight">\(Y_{t}\)</span>. We define the wealth share of agent <span class="math notranslate nohighlight">\(i\)</span> as</p>
<div class="math notranslate nohighlight" id="equation-eq-consistency-safeassets">
<span class="eqno">(8)<a class="headerlink" href="#equation-eq-consistency-safeassets" title="Permalink to this equation">¶</a></span>\[\omega_{it}=K_{it-1}-\upsilon\left(K_{it-1}-\mu_{i}\right)+\frac{\left(1-\upsilon\right)R_{t}^{f}b_{it-1}}{\left(1+p_{t}\right)\left(1+g_{t}\right)}.\]</div>
<p>We see that given the market clearing conditions <a class="reference internal" href="#equation-eq-mc-equity">(6)</a>
and <a class="reference internal" href="#equation-eq-mc-bond">(7)</a>,</p>
<div class="math notranslate nohighlight">
\[\omega_{1t}+\omega_{2t}=1,\:\forall t.\]</div>
<p>For much of the analysis in <a class="reference external" href="https://www.nber.org/papers/w20652">Barro et al. (2017)</a>, the intertemporal
elasticity of substitution <span class="math notranslate nohighlight">\(\theta\)</span> is set at <span class="math notranslate nohighlight">\(1\)</span>. In this case,
agents consume a constant share of their wealth, and equation <a class="reference internal" href="#equation-eq-euler-equation-safeassets">(3)</a>
is replaced by</p>
<div class="math notranslate nohighlight">
\[c_{it}=\frac{\rho+\upsilon}{1+\rho}.\]</div>
<p>Using this relationship for <span class="math notranslate nohighlight">\(i=1,2\)</span>, and use the market clearing
conditions <a class="reference internal" href="#equation-eq-mc-goods">(5)</a>, <a class="reference internal" href="#equation-eq-mc-equity">(6)</a> and <a class="reference internal" href="#equation-eq-mc-bond">(7)</a>,
we have</p>
<div class="math notranslate nohighlight">
\[p_{t}=\frac{1-\upsilon}{\rho+\upsilon}.\]</div>
<p>The utility function <a class="reference internal" href="#equation-eq-normalized-utility-safeassets">(2)</a> is
replaced by</p>
<div class="math notranslate nohighlight">
\[\begin{split}\log u_{it}= &amp; \frac{\rho+\upsilon}{1+\rho}\log c_{it}+\frac{1-\upsilon}{1+\rho}\log\left(1-c_{it}\right)\\
&amp; +\frac{1-\upsilon}{1+\rho}\frac{1}{1-\gamma_{i}}\log\left[\mathbb{E}_{t}\left(R_{i,t+1}u_{it+1}\right)^{1-\gamma_{i}}\right].\end{split}\]</div>
<p>The state variable is <span class="math notranslate nohighlight">\(\omega_{1t}\)</span>. The unknowns are <span class="math notranslate nohighlight">\(\left\{ x_{1t},x_{2t},R_{t}^{f},\omega_{it+1}\left(z_{t+1}\right)\right\}\)</span>.
We have 4 equations: <a class="reference internal" href="#equation-eq-foc-portfolio-choice">(4)</a> for <span class="math notranslate nohighlight">\(i=1,2\)</span>,
the market clearing condition for bond <a class="reference internal" href="#equation-eq-mc-bond">(7)</a> and the
consistency equation <a class="reference internal" href="#equation-eq-consistency-safeassets">(8)</a> to solve the
unknowns.</p>
</div>
<div class="section" id="the-gmod-file">
<h2>The gmod File<a class="headerlink" href="#the-gmod-file" title="Permalink to this headline">¶</a></h2>
<p>The model is solved with the following <a class="reference download internal" download="" href="../../_downloads/beee5f975b68033eca71549037146234/safe_assets.gmod"><code class="xref download docutils literal notranslate"><span class="pre">safe_assets.gmod</span></code></a> file</p>
<div class="highlight-GDSGE notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">% Parameters</span>
<span class="k">parameters</span> rho nu mu gamma1 gamma2;
period_length=0.25;         <span class="c">% a quarter</span>
rho = 0.02*period_length;   <span class="c">% time preference</span>
nu = 0.02*period_length;    <span class="c">% replacement rate</span>
mu = 0.5;                   <span class="c">% population share of agent 1</span>
P = 1-exp(-.04*period_length);   <span class="c">% disaster probability</span>
B = -log(1-.32);            <span class="c">% disaster size</span>
g = 0.025*period_length;    <span class="c">% growth rate</span>
gamma1 = 3.1;
gamma2 = 50;

<span class="c">% Shocks</span>
<span class="k">var_shock</span> yn;
<span class="k">shock_num</span> = 2;
<span class="k">shock_trans</span> = [1-P,P;
               1-P,P];
yn = exp([g,g-B]);

<span class="c">% States</span>
<span class="k">var_state</span> omega1;
Ngrid = 501;
omega1 = [linspace(0,0.03,200),linspace(0.031,0.94,100),linspace(0.942,0.995,Ngrid-300)];

p = (1-nu)/(rho+nu);
pn = p;
Re_n = (1+pn)*yn/p;
% Endogenous variables, bounds, and <span class="k">initial</span> values
<span class="k">var_policy</span> shr_x1 Rf omega1n[2]
<span class="k">inbound</span> shr_x1 0 1;             % agent 1&#39;s equity share
<span class="k">inbound</span> Rf Re_n(2) Re_n(1);     % risk-free rate
<span class="k">inbound</span> omega1n 0 1.02;         % state next period

<span class="c">% Other equilibrium variables</span>
<span class="k">var_aux</span> x1 x2 K1 b1 c1 c2 log_u1 log_u2 expectedRe;

<span class="c">% Implicit state transition functions</span>
<span class="k">var_interp</span> log_u1future log_u2future;
log_u1future = log_u1;
log_u2future = log_u2;
<span class="k">initial</span> log_u1future (rho+nu)/(1+rho)*log((rho+nu)/(1+rho)) + (1-nu)/(1+rho)*log((1-nu)/(1+rho));
<span class="k">initial</span> log_u2future (rho+nu)/(1+rho)*log((rho+nu)/(1+rho)) + (1-nu)/(1+rho)*log((1-nu)/(1+rho));

<span class="k">model;</span>
  c1 = (rho+nu)/(1+rho);
  c2 = (rho+nu)/(1+rho);
  p = (1-nu)/(rho+nu);
  pn = p;

  log_u1n&#39; = log_u1future&#39;(omega1n&#39;);
  log_u2n&#39; = log_u2future&#39;(omega1n&#39;);
  u1n&#39; = exp(log_u1n&#39;);
  u2n&#39; = exp(log_u2n&#39;);

  Re_n&#39; = (1+pn)*yn&#39;/p;
  x1 = shr_x1*(Rf/(Rf - Re_n(2)));
 
  <span class="c">% Market clearing for bonds:</span>
  b1 = omega1*(1-x1)*(1-c1)*(1+p);
  b2 = -b1;
  x2 = 1 - b2/((1-omega1)*(1-c2)*(1+p));
  K1 = x1*(1-c1)*omega1*(1+p)/p;
  K2 = x2*(1-c2)*(1-omega1)*(1+p)/p;

  R1n&#39; = x1*Re_n&#39; + (1-x1)*Rf;
  R2n&#39; = x2*Re_n&#39; + (1-x2)*Rf;

  <span class="c">% Agent 1&#39;s FOC wrt equity share:</span>
  eq1 = GDSGE_EXPECT{Re_n&#39;*u1n&#39;^(1-gamma1)*R1n&#39;^(-gamma1)} / <span class="k">GDSGE_EXPECT</span>{Rf*u1n&#39;^(1-gamma1)*R1n&#39;^(-gamma1)} - 1;

  <span class="c">% Agent 2&#39;s FOC wrt equity share:</span>
  log_u2n_R2n_gamma&#39; = log_u2n&#39;*(1-gamma2) - log(R2n&#39;)*gamma2;
  min_log_u2n_R2n_gamma = GDSGE_MIN{log_u2n_R2n_gamma&#39;};
  log_u2n_R2n_gamma_shifted&#39; = log_u2n_R2n_gamma&#39; - min_log_u2n_R2n_gamma;
  eq2 = GDSGE_EXPECT{Re_n&#39;*exp(log_u2n_R2n_gamma_shifted&#39;)} / <span class="k">GDSGE_EXPECT</span>{Rf*exp(log_u2n_R2n_gamma_shifted&#39;)} - 1;

  <span class="c">% Consistency for omega:</span>
  omega_future_consis&#39; = K1 - nu*(K1-mu) + (1-nu)*Rf*b1/(yn&#39;*(1+pn)) - omega1n&#39;;

  <span class="c">% Update the utility functions:</span>
  ucons1 = ((rho+nu)/(1+rho))*log(c1) + ((1-nu)/(1+rho))*log(1-c1);
  ucons2 = ((rho+nu)/(1+rho))*log(c2) + ((1-nu)/(1+rho))*log(1-c2);
  log_u1 = ucons1 + (1-nu)/(1+rho)/(1-gamma1)*log(<span class="k">GDSGE_EXPECT</span>{(R1n&#39;*u1n&#39;)^(1-gamma1)});        
  log_u2 = ucons2 + (1-nu)/(1+rho)/(1-gamma2)*( log(<span class="k">GDSGE_EXPECT</span>{R2n&#39;*exp(log_u2n_R2n_gamma_shifted&#39;)}) + min_log_u2n_R2n_gamma );

  expectedRe = <span class="k">GDSGE_EXPECT</span>{Re_n&#39;};
       
  <span class="k">equations;</span>
    eq1;
    eq2;
    omega_future_consis&#39;;
  <span class="k">end;</span>
<span class="k">end;</span>

<span class="k">simulate;</span>
  <span class="k">num_periods</span> = 10000;
  <span class="k">num_samples</span> = 50;
  <span class="k">initial</span> omega1 .67;
  <span class="k">initial</span> shock 1;
  
  <span class="k">var_simu</span> Rf K1 b1 expectedRe;

  omega1&#39; = omega1n&#39;;
<span class="k">end;</span>
</pre></div>
</td></tr></table></div>
<p>There is not too much new about the usage of the toolbox if you already saw examples <a class="reference internal" href="../HL1996/HL1996.html#hl1996"><span class="std std-ref">Heaton and Lucas (1996)</span></a> and
<a class="reference internal" href="../Guvenen2009/Guvenen2009.html#guvenen2009"><span class="std std-ref">Guvenen (2009)</span></a>.
There are some transformations worth mentioning which facilitate solving the model.</p>
<div class="highlight-GDSGE notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>71
72
73
74
75</pre></div></td><td class="code"><div class="highlight"><pre><span></span>  <span class="c">% Agent 2&#39;s FOC wrt equity share:</span>
  log_u2n_R2n_gamma&#39; = log_u2n&#39;*(1-gamma2) - log(R2n&#39;)*gamma2;
  min_log_u2n_R2n_gamma = GDSGE_MIN{log_u2n_R2n_gamma&#39;};
  log_u2n_R2n_gamma_shifted&#39; = log_u2n_R2n_gamma&#39; - min_log_u2n_R2n_gamma;
  eq2 = GDSGE_EXPECT{Re_n&#39;*exp(log_u2n_R2n_gamma_shifted&#39;)} / <span class="k">GDSGE_EXPECT</span>{Rf*exp(log_u2n_R2n_gamma_shifted&#39;)} - 1;
</pre></div>
</td></tr></table></div>
<p>These lines describe how to calculate the Euler Equation residual</p>
<div class="math notranslate nohighlight">
\[\mathbb{E}_{t}\left[\frac{\left(R_{t+1}^{e}-R_{t+1}^{f}\right)u_{it+1}}{\left(R_{i,t+1}u_{it+1}\right)^{\gamma_{i}}}\right]=0\]</div>
<p>when the CRRA coefficient <span class="math notranslate nohighlight">\(\gamma_2\)</span> is very large: by tracking and calculating the log level of utility instead of the level of utility.
This procedure proves to be essential in solving models with <span class="math notranslate nohighlight">\(\gamma_2\)</span> very high, as <span class="math notranslate nohighlight">\(u\)</span> can easily fall below
the smallest number permitted by double precision.</p>
<p>As in previous examples, we can inspect the policy functions and ergodic sets after solving policy iterations and simulations. Here, we focus on
how to construct generalized impulse responses using the model simulations. Since the equilibrium concept involves an ergodic distribution of state, instead of a
deterministic steady state, the proper concepts of impulse responses are sampling responses from the ergodic set, and taking their averages and standard deviations.
The sampling procedure can be done on a sub-population of the ergodic set,  generating conditional impulse responses which will be of particular interests since
the non-linear models may feature different dynamics starting from different part of the state space.</p>
<p>The procedure for constructing generalized impulse responses goes as follows:</p>
<p>1. Simulate an ergodic set, which can be done by simulating one or multiple samples for a long-period of time,
according to the Ergodic theorem.</p>
<p>2. Replicate the ergodic set to get two identical sets. For one of the two, turn the shock to “on”. The exact procedure depends on the model.
In the current example, “on” corresponds to the rare diaster state. For the other set, keep the shock unchanged.</p>
<p>3. Simulate the two sets, keeping the transitions of the exogenous shocks on. This procedure essentially captures the effect of the switching of the shock in the initial period
on subsequent dynamics.</p>
<p>4. Calculate the mean and standard deviation of the differences between simulated time series of the two sets. These arrive at the mean impulse responses and
the standard deviations. Again, the above procedure can be conditional on a sub-population of the ergodic set so as to compute
conditional impulse responses starting from states with certain properties of interests.</p>
<a class="reference internal image-reference" href="../../_images/irf.png"><img alt="../../_images/irf.png" src="../../_images/irf.png" style="width: 512.0px; height: 410.8px;" /></a>
<p>The figure plots the impulse responses after
a one-time disaster using the baseline parameters in <a class="reference external" href="https://www.nber.org/papers/w20652">Barro et al. (2017)</a>.
(For annual data, <span class="math notranslate nohighlight">\(\rho=0.02\)</span>, <span class="math notranslate nohighlight">\(\upsilon=0.02\)</span>, <span class="math notranslate nohighlight">\(\mu=0.5\)</span>, <span class="math notranslate nohighlight">\(\gamma_{1}=3.3\)</span>,
and <span class="math notranslate nohighlight">\(\gamma_{2}=5.6\)</span>. Growth rate in normal times is <span class="math notranslate nohighlight">\(0.025\)</span>. Rare
disaster happens with probability 4%, and once it happens, productivity
drops by 32%. The model period is one quarter.) As shown in the figure, the rare disaster shock redistributes
wealth from the less risk averse agents (Agent 1) to the more risk averse agents (Agent 2). This leads to
more demand for safe asset, and a higher equilibrium quantity and price (lower interest rate) of the safe asset.</p>
<p>A final remark is on the price of safe assets, which exhibits non-monotonicity as the risk aversion of Agent 2
<span class="math notranslate nohighlight">\(\gamma_2\)</span> increases, as shown in the figure below.
This non-monotonicity is usually overlooked in the literature and uncovered by our solution method that can solve models with high <span class="math notranslate nohighlight">\(\gamma_2\)</span> robustly and accurately.</p>
<a class="reference internal image-reference" href="../../_images/figure_Rf.png"><img alt="../../_images/figure_Rf.png" src="../../_images/figure_Rf.png" style="width: 467.0px; height: 414.5px;" /></a>
<p>The mechanism behind the non-monotonicity can be
understood by looking at two opposing forces. First, as <span class="math notranslate nohighlight">\(\gamma_{2}\)</span>
gets larger, agent 2 becomes more risk-averse, and demand for more
of the safe asset (bond). This pushes down <span class="math notranslate nohighlight">\(\bar{R}^{f}\)</span>. Second,
an increase in <span class="math notranslate nohighlight">\(\gamma_{2}\)</span> also leads agent <span class="math notranslate nohighlight">\(1\)</span> to borrow more
and become more leveraged. Since the return of equity is higher than
bond, the average wealth share of agent 1, <span class="math notranslate nohighlight">\(\omega_{1}\)</span> becomes larger.
Larger <span class="math notranslate nohighlight">\(\omega_{1}\)</span> leads to more relative supply of safe asset and
pushes up <span class="math notranslate nohighlight">\(\bar{R}^{f}\)</span>. Whether <span class="math notranslate nohighlight">\(\bar{R}^{f}\)</span> decreases or increases
in <span class="math notranslate nohighlight">\(\gamma_{2}\)</span> depends on which force dominates. The figure
shows that when <span class="math notranslate nohighlight">\(\gamma_{2}\)</span> is below <span class="math notranslate nohighlight">\(8\)</span> the first force dominates
and <span class="math notranslate nohighlight">\(\bar{R}^{f}\)</span> is decreasing in <span class="math notranslate nohighlight">\(\gamma_{2}\)</span> as assumed in <a class="reference external" href="https://www.nber.org/papers/w20652">Barro et al. (2017)</a>.
However, when <span class="math notranslate nohighlight">\(\gamma_{2}\)</span> is larger than <span class="math notranslate nohighlight">\(8\)</span>, the second force
dominates and <span class="math notranslate nohighlight">\(\bar{R}^{f}\)</span> is increasing in <span class="math notranslate nohighlight">\(\gamma_{2}\)</span>. When
<span class="math notranslate nohighlight">\(\gamma_{2}\)</span> is larger than 20, <span class="math notranslate nohighlight">\(\bar{R}^{f}\)</span> is not responsive to
<span class="math notranslate nohighlight">\(\gamma_{2}\)</span>, since the wealth distribution <span class="math notranslate nohighlight">\(\omega_{1}\)</span> is almost
degenerated to its upper limit.</p>
<p>The figure below provides a comparison of two cases: <span class="math notranslate nohighlight">\(\gamma_{2}=8\)</span> versus <span class="math notranslate nohighlight">\(\gamma_{2}=10\)</span>. As <span class="math notranslate nohighlight">\(\gamma_2\)</span> increases, the wealth share of Agent 1 tends to be larger.</p>
<a class="reference internal image-reference" href="../../_images/dist_Rf.png"><img alt="../../_images/dist_Rf.png" src="../../_images/dist_Rf.png" style="width: 465.0px; height: 381.5px;" /></a>
</div>
<div class="section" id="what-s-next">
<h2>What’s Next?<a class="headerlink" href="#what-s-next" title="Permalink to this headline">¶</a></h2>
<p>This example illustrates that the toolbox algorithm is especially effective to solve models where portfolio choices are sensitive to the asset price,
which are traditionally considered ill-behaved problems. In <a class="reference external" href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3552189">Cao, Evans, and Luo (2020)</a>,
we solve another model which is traditionally considered ill-behaved:
a two-country DSGE model with portfolio choices in which
the returns to assets are close to collinear in certain regions of the state space.</p>
<p>Or you can directly proceed to <a class="reference internal" href="../../usage/functions.html#toolbox-api"><span class="std std-ref">Toolbox API</span></a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../usage/functions.html" class="btn btn-neutral float-right" title="Toolbox API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../Bianchi2011/Bianchi2011.html" class="btn btn-neutral float-left" title="Bianchi (2011): Sudden Stops in Open Economies" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Dan Cao, Wenlan Luo, and Guangyu Nie

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>